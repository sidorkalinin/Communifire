(function(a){a.retryAjax=function(b){var d,e=b.timeout,c=b.deferred;b.tryCount=(!b.tryCount)?0:b.tryCount;b.suppressErrors=true;b.success=function(f){c.resolve()};b.error=function(i,h,f){var g=this;this.tryCount++;if(this.tryCount<=this.retryLimit){if(g.tryCount===g.retryLimit){g.error=d;delete g.suppressErrors}if(e>0){setTimeout(function(){a.ajax(g)},e)}else{a.ajax(g)}}};a.ajax(b)}}(jQuery));!(function(e){String.format=function(){var x=arguments[0];for(var v=0;v<arguments.length-1;v++){var w=new RegExp("\\{"+v+"\\}","gm");x=x.replace(w,arguments[v+1])}return x};var f=e||window;var u=window.CF_VD||f.CF_VD,k=f.CF_LOCALE,t=f.CF_THEME,n="generic-dialog",i='<img src="'+u+"/assets/Themes/"+t+'/images/spinner.gif">',j=u+"/assets/Themes/"+t+"/images/spinner.gif",s=$("#spinner-absolute-center"),r="CF_REMOTE_HOST",g=window[r]||f[r]||(u||""),p=g+"/ping-do-not-delete.ico";var m=".axero-community-wrapper";var b=g+"/api";var h="format=json";var l;if(k){l="&locale="+k}else{l=""}var a=function(v){if(k){if(v.indexOf("?")>-1){return String.format("{0}&locale={1}",v,k)}else{return String.format("{0}?locale={1}",v,k)}}else{return v}};var d=function(v){var x,w;if(!v){return v}if(v.indexOf("?")>-1){w="&"}else{w="?"}x=b+v+w+h+l;return x},c=function(w,x,v){if(!w){alert(x);return}if(k){if(w.indexOf("?")>-1){return String.format("{0}{1}{2}&locale={3}",u,v,w,k)}else{return String.format("{0}{1}{2}?locale={3}",u,v,w,k)}}else{return String.format("{0}{1}{2}",u,v,w)}};var o={mainContainer:m,spinnerAbsoluteCenter:s,virtualDirectory:u,loadingImage:i,loadingImageSRC:j,locale:k,theme:t,addLocaleToUrl:a,buildApiUrl:d,buildAjaxUrl:c,buildHTTPHandlersUrl:function(v){return c(v,"Please provide a page name to call","/HTTPHandlers/")},whenConnectedToInternet:function(){var v=$.Deferred();$.retryAjax({url:p+"?d="+(new Date()).toString(),timeout:5000,retryLimit:1,deferred:v,type:"GET"});return v.promise()}};window.Communifire=e;for(var q in o){e[q]=o[q]}})(Communifire);Communifire.namespace=function(b){var d=b.split("."),c=Communifire,a;if(d[0]==="Communifire"){d=d.slice(1)}for(a=0;a<d.length;a+=1){if(typeof c[d[a]]==="undefined"){c[d[a]]={}}c=c[d[a]]}return c};Communifire.GlobalSetting=function(){var a;return{isFileControlEnabled:a}};Communifire.Utilities=function(){var a=100;var k=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);var g=function(A,y){var x=Array.prototype.slice.call(arguments).splice(2);var C=A.split(".");var z=C.pop();for(var B=0;B<C.length;B++){y=y[C[B]]}return y[z].apply(this,x)};var h=function(x){x.find("script").each(function(){$.globalEval(this.text||this.textContent||this.innerHTML||"")})};var c=function(z,x,y){if(!z){return}if(z.indexOf("?")==-1){z=z+"?"+x+"="+y}else{z=z;z=z+"&"+x+"="+y}return z};var w=function(x,A,z){if(x.setSelectionRange){x.focus();x.setSelectionRange(A,z)}else{if(x.createTextRange){var y=x.createTextRange();y.collapse(true);y.moveEnd(keys.character,z);y.moveStart(keys.character,A);y.select()}}};var f="DELETE",t="POST",u="PUT",j="GET",e="Content-Type",l="application/json; charset=utf-8",m="json";var r=function(B,C,y,A,z,x){if(y){$.ajax({url:B,type:C,data:JSON.stringify(y),contentType:l,headers:{contentTypeKey:l},}).success(A).error(z).always(x)}else{$.ajax({url:B,type:C,contentType:l,headers:{contentTypeKey:l},}).success(A).error(z).always(x)}};var o=function(A,z,y,x){$.getJSON(A).success(z).error(y).always(x)};var p=function(B,y,A,z,x){r(B,t,y,A,z,x)};var q=function(B,y,A,z,x){r(B,u,y,A,z,x)};var n=function(A,z,y,x){r(A,f,null,z,y,x)};var i=function(x){var y=$(Communifire.loadingImage).addClass("ajax-loader");x&&y.css(x);return y};var v=function(){$("img.ajax-loader").remove()};var b=function(x,y){$(x).append(i(y))};var d=function(){var z=navigator.userAgent,y,x=z.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(x[1])){y=/\brv[ :]+(\d+)/g.exec(z)||[];return"IE "+(y[1]||"")}if(x[1]==="Chrome"){y=z.match(/\b(OPR|Edge)\/(\d+)/);if(y!=null){return y.slice(1).join(" ").replace("OPR","Opera")}}x=x[2]?[x[1],x[2]]:[navigator.appName,navigator.appVersion,"-?"];if((y=z.match(/version\/(\d+)/i))!=null){x.splice(1,1,y[1])}return x.join(" ")};var s={htmlEncode:function(x){return $("<div/>").text(x).html()},htmlDecode:function(x){return $("<div/>").html(x).text()},urldecode:function(x){return decodeURIComponent((x+"").replace(/\+/g,"%20"))},parseSmileys:function(y){var x=/:[()]/ig;return y.replace(x,function(z,A){if(z==":)"){return'<i class="icon-smile"></i>'}else{if(z==":("){return'<i class="icon-frown"></i>'}else{return z}}})},ie:(function(){var y,z=3,x=document.createElement("div");while(x.innerHTML="<!--[if gt IE "+(++z)+"]><i></i><![endif]-->",x.getElementsByTagName("i")[0]){}return z>4?z:y}()),executeFunctionByName:g,executeScripts:h,appendQueryString:c,getSpinnerImg:i,removeSpinner:v,addSpinner:b,makeWebApiRequest:r,makeWebApiGetRequest:o,makeWebApiPostRequest:p,makeWebApiPutRequest:q,makeWebApiDeleteRequest:n,setCaretToPos:function(x,y){w(x,y,y)},isiOS:function(){return k},parseInt:function(x){return parseInt(x,10)},browserInfo:d,isIE:function(){var x=d();return(x.indexOf("Edge")>-1||x.indexOf("IE")>-1)},ieVersion:function(){var y=-1;if(navigator.appName=="Microsoft Internet Explorer"){var z=navigator.userAgent;var x=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(x.exec(z)!=null){y=parseFloat(RegExp.$1)}}return y},getQueryString:function(x){var z=[];for(var y in x){if(x.hasOwnProperty(y)){var A=x[y];if(A!=undefined){z.push(encodeURIComponent(y)+"="+encodeURIComponent(x[y]))}}}return z.join("&")},scrollToBottom:function(x){if(!x){return}var y=x.scrollHeight;x.scrollTop=y},getArrayIndexForKey:function(x,z,A){for(var y=0;y<x.length;y++){if(x[y][z]==A){return y}}return -1},isRequireModulePresent:function(){return window.require!==undefined},isElectronPresent:function(){return navigator.userAgent.match(/Electron/i)!==null},isDarwinPlatform:function(){return window.process!==undefined&&window.process.platform=="darwin"},isNotificationSoundEnabed:function(){}};return s}();/* Magnific Popup - v1.0.0 - 2015-01-03
* http://dimsemenov.com/plugins/magnific-popup/
* Copyright (c) 2015 Dmitry Semenov; */
!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports?require("jquery"):window.jQuery||window.Zepto)}(function(V){var X,Z,ab,ad,af,ah,aj="Close",al="BeforeClose",an="AfterClose",ap="BeforeAppend",ar="MarkupParse",au="Open",aw="Change",ay="mfp",aA="."+ay,aC="mfp-ready",aE="mfp-removing",aG="mfp-prevent-close",aI=function(){},aK=!!window.jQuery,aM=V(window),aN=function(b,d){X.ev.on(ay+b+aA,d)},aO=function(a,g,h,i){var j=document.createElement("div");return j.className="mfp-"+a,h&&(j.innerHTML=h),i?g&&g.appendChild(j):(j=V(j),g&&j.appendTo(g)),j},aP=function(a,b){X.ev.triggerHandler(ay+a,b),X.st.callbacks&&(a=a.charAt(0).toLowerCase()+a.slice(1),X.st.callbacks[a]&&X.st.callbacks[a].apply(X,V.isArray(b)?b:[b]))},aQ=function(a){return a===ah&&X.currTemplate.closeBtn||(X.currTemplate.closeBtn=V(X.st.closeMarkup.replace("%title%",X.st.tClose)),ah=a),X.currTemplate.closeBtn},W=function(){V.magnificPopup.instance||(X=new aI,X.init(),V.magnificPopup.instance=X)},Y=function(){var c=document.createElement("p").style,d=["ms","O","Moz","Webkit"];if(void 0!==c.transition){return !0}for(;d.length;){if(d.pop()+"Transition" in c){return !0}}return !1};aI.prototype={constructor:aI,init:function(){var a=navigator.appVersion;X.isIE7=-1!==a.indexOf("MSIE 7."),X.isIE8=-1!==a.indexOf("MSIE 8."),X.isLowIE=X.isIE7||X.isIE8,X.isAndroid=/android/gi.test(a),X.isIOS=/iphone|ipad|ipod/gi.test(a),X.supportsTransition=Y(),X.probablyMobile=X.isAndroid||X.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent),ab=V(document),X.popupsCache={}},open:function(a){var b;if(a.isObj===!1){X.items=a.items.toArray(),X.index=0;var d,f=a.items;for(b=0;b<f.length;b++){if(d=f[b],d.parsed&&(d=d.el[0]),d===a.el[0]){X.index=b;break}}}else{X.items=V.isArray(a.items)?a.items:[a.items],X.index=a.index||0}if(X.isOpen){return void X.updateItemHTML()}X.types=[],af="",X.ev=a.mainEl&&a.mainEl.length?a.mainEl.eq(0):ab,a.key?(X.popupsCache[a.key]||(X.popupsCache[a.key]={}),X.currTemplate=X.popupsCache[a.key]):X.currTemplate={},X.st=V.extend(!0,{},V.magnificPopup.defaults,a),X.fixedContentPos="auto"===X.st.fixedContentPos?!X.probablyMobile:X.st.fixedContentPos,X.st.modal&&(X.st.closeOnContentClick=!1,X.st.closeOnBgClick=!1,X.st.showCloseBtn=!1,X.st.enableEscapeKey=!1),X.bgOverlay||(X.bgOverlay=aO("bg").on("click"+aA,function(){X.close()}),X.wrap=aO("wrap").attr("tabindex",-1).on("click"+aA,function(c){X._checkIfClose(c.target)&&X.close()}),X.container=aO("container",X.wrap)),X.contentContainer=aO("content"),X.st.preloader&&(X.preloader=aO("preloader",X.container,X.st.tLoading));var l=V.magnificPopup.modules;for(b=0;b<l.length;b++){var m=l[b];m=m.charAt(0).toUpperCase()+m.slice(1),X["init"+m].call(X)}aP("BeforeOpen"),X.st.showCloseBtn&&(X.st.closeBtnInside?(aN(ar,function(e,g,h,i){h.close_replaceWith=aQ(i.type)}),af+=" mfp-close-btn-in"):X.wrap.append(aQ())),X.st.alignTop&&(af+=" mfp-align-top"),X.wrap.css(X.fixedContentPos?{overflow:X.st.overflowY,overflowX:"hidden",overflowY:X.st.overflowY}:{top:aM.scrollTop(),position:"absolute"}),(X.st.fixedBgPos===!1||"auto"===X.st.fixedBgPos&&!X.fixedContentPos)&&X.bgOverlay.css({height:ab.height(),position:"absolute"}),X.st.enableEscapeKey&&ab.on("keyup"+aA,function(c){27===c.keyCode&&X.close()}),aM.on("resize"+aA,function(){X.updateSize()}),X.st.closeOnContentClick||(af+=" mfp-auto-cursor"),af&&X.wrap.addClass(af);var p=X.wH=aM.height(),q={};if(X.fixedContentPos&&X._hasScrollBar(p)){var s=X._getScrollbarSize();s&&(q.marginRight=s)}X.fixedContentPos&&(X.isIE7?V("body, html").css("overflow","hidden"):q.overflow="hidden");var t=X.st.mainClass;return X.isIE7&&(t+=" mfp-ie7"),t&&X._addClassToMFP(t),X.updateItemHTML(),aP("BuildControls"),V("html").css(q),X.bgOverlay.add(X.wrap).prependTo(X.st.prependTo||V(document.body)),X._lastFocusedEl=document.activeElement,setTimeout(function(){X.content?(X._addClassToMFP(aC),X._setFocus()):X.bgOverlay.addClass(aC),ab.on("focusin"+aA,X._onFocusIn)},16),X.isOpen=!0,X.updateSize(p),aP(au),a},close:function(){X.isOpen&&(aP(al),X.isOpen=!1,X.st.removalDelay&&!X.isLowIE&&X.supportsTransition?(X._addClassToMFP(aE),setTimeout(function(){X._close()},X.st.removalDelay)):X._close())},_close:function(){aP(aj);var a=aE+" "+aC+" ";if(X.bgOverlay.detach(),X.wrap.detach(),X.container.empty(),X.st.mainClass&&(a+=X.st.mainClass+" "),X._removeClassFromMFP(a),X.fixedContentPos){var b={marginRight:""};X.isIE7?V("body, html").css("overflow",""):b.overflow="",V("html").css(b)}ab.off("keyup"+aA+" focusin"+aA),X.ev.off(aA),X.wrap.attr("class","mfp-wrap").removeAttr("style"),X.bgOverlay.attr("class","mfp-bg"),X.container.attr("class","mfp-container"),!X.st.showCloseBtn||X.st.closeBtnInside&&X.currTemplate[X.currItem.type]!==!0||X.currTemplate.closeBtn&&X.currTemplate.closeBtn.detach(),X._lastFocusedEl&&V(X._lastFocusedEl).focus(),X.currItem=null,X.content=null,X.currTemplate=null,X.prevHeight=0,aP(an)},updateSize:function(b){if(X.isIOS){var e=document.documentElement.clientWidth/window.innerWidth,f=window.innerHeight*e;X.wrap.css("height",f),X.wH=f}else{X.wH=b||aM.height()}X.fixedContentPos||X.wrap.css("height",X.wH),aP("Resize")},updateItemHTML:function(){var a=X.items[X.index];X.contentContainer.detach(),X.content&&X.content.detach(),a.parsed||(a=X.parseEl(X.index));var b=a.type;if(aP("BeforeChange",[X.currItem?X.currItem.type:"",b]),X.currItem=a,!X.currTemplate[b]){var e=X.st[b]?X.st[b].markup:!1;aP("FirstMarkupParse",e),X.currTemplate[b]=e?V(e):!0}ad&&ad!==a.type&&X.container.removeClass("mfp-"+ad+"-holder");var h=X["get"+b.charAt(0).toUpperCase()+b.slice(1)](a,X.currTemplate[b]);X.appendContent(h,b),a.preloaded=!0,aP(aw,a),ad=a.type,X.container.prepend(X.contentContainer),aP("AfterChange")},appendContent:function(b,d){X.content=b,b?X.st.showCloseBtn&&X.st.closeBtnInside&&X.currTemplate[d]===!0?X.content.find(".mfp-close").length||X.content.append(aQ()):X.content=b:X.content="",aP(ap),X.container.addClass("mfp-"+d+"-holder"),X.contentContainer.append(X.content)},parseEl:function(a){var b,h=X.items[a];if(h.tagName?h={el:V(h)}:(b=h.type,h={data:h,src:h.src}),h.el){for(var i=X.types,j=0;j<i.length;j++){if(h.el.hasClass("mfp-"+i[j])){b=i[j];break}}h.src=h.el.attr("data-mfp-src"),h.src||(h.src=h.el.attr("href"))}return h.type=b||X.st.type||"inline",h.index=a,h.parsed=!0,X.items[a]=h,aP("ElementParse",h),X.items[a]},addGroup:function(b,f){var g=function(a){a.mfpEl=this,X._openClick(a,b,f)};f||(f={});var h="click.magnificPopup";f.mainEl=b,f.items?(f.isObj=!0,b.off(h).on(h,g)):(f.isObj=!1,f.delegate?b.off(h).on(h,f.delegate,g):(f.items=b,b.off(h).on(h,g)))},_openClick:function(a,b,h){var i=void 0!==h.midClick?h.midClick:V.magnificPopup.defaults.midClick;if(i||2!==a.which&&!a.ctrlKey&&!a.metaKey){var j=void 0!==h.disableOn?h.disableOn:V.magnificPopup.defaults.disableOn;if(j){if(V.isFunction(j)){if(!j.call(X)){return !0}}else{if(aM.width()<j){return !0}}}a.type&&(a.preventDefault(),X.isOpen&&a.stopPropagation()),h.el=V(a.mfpEl),h.delegate&&(h.items=b.find(h.delegate)),X.open(h)}},updateStatus:function(b,c){if(X.preloader){Z!==b&&X.container.removeClass("mfp-s-"+Z),c||"loading"!==b||(c=X.st.tLoading);var f={status:b,text:c};aP("UpdateStatus",f),b=f.status,c=f.text,X.preloader.html(c),X.preloader.find("a").on("click",function(d){d.stopImmediatePropagation()}),X.container.addClass("mfp-s-"+b),Z=b}},_checkIfClose:function(a){if(!V(a).hasClass(aG)){var b=X.st.closeOnContentClick,f=X.st.closeOnBgClick;if(b&&f){return !0}if(!X.content||V(a).hasClass("mfp-close")||X.preloader&&a===X.preloader[0]){return !0}if(a===X.content[0]||V.contains(X.content[0],a)){if(b){return !0}}else{if(f&&V.contains(document,a)){return !0}}return !1}},_addClassToMFP:function(b){X.bgOverlay.addClass(b),X.wrap.addClass(b)},_removeClassFromMFP:function(b){this.bgOverlay.removeClass(b),X.wrap.removeClass(b)},_hasScrollBar:function(b){return(X.isIE7?ab.height():document.body.scrollHeight)>(b||aM.height())},_setFocus:function(){(X.st.focus?X.content.find(X.st.focus).eq(0):X.wrap).focus()},_onFocusIn:function(a){return a.target===X.wrap[0]||V.contains(X.wrap[0],a.target)?void 0:(X._setFocus(),!1)},_parseMarkup:function(a,f,g){var h;g.data&&(f=V.extend(g.data,f)),aP(ar,[a,f,g]),V.each(f,function(b,e){if(void 0===e||e===!1){return !0}if(h=b.split("_"),h.length>1){var i=a.find(aA+"-"+h[0]);if(i.length>0){var j=h[1];"replaceWith"===j?i[0]!==e[0]&&i.replaceWith(e):"img"===j?i.is("img")?i.attr("src",e):i.replaceWith('<img src="'+e+'" class="'+i.attr("class")+'" />'):i.attr(h[1],e)}}else{a.find(aA+"-"+b).html(e)}})},_getScrollbarSize:function(){if(void 0===X.scrollbarSize){var b=document.createElement("div");b.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(b),X.scrollbarSize=b.offsetWidth-b.clientWidth,document.body.removeChild(b)}return X.scrollbarSize}},V.magnificPopup={instance:null,proto:aI.prototype,modules:[],open:function(a,d){return W(),a=a?V.extend(!0,{},a):{},a.isObj=!0,a.index=d||0,this.instance.open(a)},close:function(){return V.magnificPopup.instance&&V.magnificPopup.instance.close()},registerModule:function(a,d){d.options&&(V.magnificPopup.defaults[a]=d.options),V.extend(this.proto,d.proto),this.modules.push(a)},defaults:{disableOn:0,key:null,midClick:!1,mainClass:"",preloader:!0,focus:"",closeOnContentClick:!1,closeOnBgClick:!0,closeBtnInside:!0,showCloseBtn:!0,enableEscapeKey:!0,modal:!1,alignTop:!1,removalDelay:0,prependTo:null,fixedContentPos:"auto",fixedBgPos:"auto",overflowY:"auto",closeMarkup:'<button title="%title%" type="button" class="mfp-close">&times;</button>',tClose:"Close (Esc)",tLoading:"Loading..."}},V.fn.magnificPopup=function(a){W();var b=V(this);if("string"==typeof a){if("open"===a){var h,i=aK?b.data("magnificPopup"):b[0].magnificPopup,j=parseInt(arguments[1],10)||0;i.items?h=i.items[j]:(h=b,i.delegate&&(h=h.find(i.delegate)),h=h.eq(j)),X._openClick({mfpEl:h},b,i)}else{X.isOpen&&X[a].apply(X,Array.prototype.slice.call(arguments,1))}}else{a=V.extend(!0,{},a),aK?b.data("magnificPopup",a):b[0].magnificPopup=a,X.addGroup(b,a)}return b};var aa,ac,ae,ag="inline",ai=function(){ae&&(ac.after(ae.addClass(aa)).detach(),ae=null)};V.magnificPopup.registerModule(ag,{options:{hiddenClass:"hide",markup:"",tNotFound:"Content not found"},proto:{initInline:function(){X.types.push(ag),aN(aj+"."+ag,function(){ai()})},getInline:function(a,b){if(ai(),a.src){var h=X.st.inline,i=V(a.src);if(i.length){var j=i[0].parentNode;j&&j.tagName&&(ac||(aa=h.hiddenClass,ac=aO(aa),aa="mfp-"+aa),ae=i.after(ac).detach().removeClass(aa)),X.updateStatus("ready")}else{X.updateStatus("error",h.tNotFound),i=V("<div>")}return a.inlineElement=i,i}return X.updateStatus("ready"),X._parseMarkup(b,{},a),b}}});var ak,am="ajax",ao=function(){ak&&V(document.body).removeClass(ak)},aq=function(){ao(),X.req&&X.req.abort()};V.magnificPopup.registerModule(am,{options:{settings:null,cursor:"mfp-ajax-cur",tError:'<a href="%url%">The content</a> could not be loaded.'},proto:{initAjax:function(){X.types.push(am),ak=X.st.ajax.cursor,aN(aj+"."+am,aq),aN("BeforeChange."+am,aq)},getAjax:function(a){ak&&V(document.body).addClass(ak),X.updateStatus("loading");var b=V.extend({url:a.src,success:function(c,h,i){var j={data:c,xhr:i};aP("ParseAjax",j),X.appendContent(V(j.data),am),a.finished=!0,ao(),X._setFocus(),setTimeout(function(){X.wrap.addClass(aC)},16),X.updateStatus("ready"),aP("AjaxContentAdded")},error:function(){ao(),a.finished=a.loadError=!0,X.updateStatus("error",X.st.ajax.tError.replace("%url%",a.src))}},X.st.ajax.settings);return X.req=V.ajax(b),""}}});var at,av=function(a){if(a.data&&void 0!==a.data.title){return a.data.title}var b=X.st.image.titleSrc;if(b){if(V.isFunction(b)){return b.call(X,a)}if(a.el){return a.el.attr(b)||""}}return""};V.magnificPopup.registerModule("image",{options:{markup:'<div class="mfp-figure"><div class="mfp-close"></div><figure><div class="mfp-img"></div><figcaption><div class="mfp-bottom-bar"><div class="mfp-title"></div><div class="mfp-counter"></div></div></figcaption></figure></div>',cursor:"mfp-zoom-out-cur",titleSrc:"title",verticalFit:!0,tError:'<a href="%url%">The image</a> could not be loaded.'},proto:{initImage:function(){var a=X.st.image,b=".image";X.types.push("image"),aN(au+b,function(){"image"===X.currItem.type&&a.cursor&&V(document.body).addClass(a.cursor)}),aN(aj+b,function(){a.cursor&&V(document.body).removeClass(a.cursor),aM.off("resize"+aA)}),aN("Resize"+b,X.resizeImage),X.isLowIE&&aN("AfterChange",X.resizeImage)},resizeImage:function(){var b=X.currItem;if(b&&b.img&&X.st.image.verticalFit){var d=0;X.isLowIE&&(d=parseInt(b.img.css("padding-top"),10)+parseInt(b.img.css("padding-bottom"),10)),b.img.css("max-height",X.wH-d)}},_onImageHasSize:function(b){b.img&&(b.hasSize=!0,at&&clearInterval(at),b.isCheckingImgSize=!1,aP("ImageHasSize",b),b.imgHidden&&(X.content&&X.content.removeClass("mfp-loading"),b.imgHidden=!1))},findImageSize:function(b){var f=0,g=b.img[0],h=function(a){at&&clearInterval(at),at=setInterval(function(){return g.naturalWidth>0?void X._onImageHasSize(b):(f>200&&clearInterval(at),f++,void (3===f?h(10):40===f?h(50):100===f&&h(500)))},a)};h(1)},getImage:function(a,b){var k=0,l=function(){a&&(a.img[0].complete?(a.img.off(".mfploader"),a===X.currItem&&(X._onImageHasSize(a),X.updateStatus("ready")),a.hasSize=!0,a.loaded=!0,aP("ImageLoadComplete")):(k++,200>k?setTimeout(l,100):m()))},m=function(){a&&(a.img.off(".mfploader"),a===X.currItem&&(X._onImageHasSize(a),X.updateStatus("error",n.tError.replace("%url%",a.src))),a.hasSize=!0,a.loaded=!0,a.loadError=!0)},n=X.st.image,o=b.find(".mfp-img");if(o.length){var p=document.createElement("img");p.className="mfp-img",a.el&&a.el.find("img").length&&(p.alt=a.el.find("img").attr("alt")),a.img=V(p).on("load.mfploader",l).on("error.mfploader",m),p.src=a.src,o.is("img")&&(a.img=a.img.clone()),p=a.img[0],p.naturalWidth>0?a.hasSize=!0:p.width||(a.hasSize=!1)}return X._parseMarkup(b,{title:av(a),img_replaceWith:a.img},a),X.resizeImage(),a.hasSize?(at&&clearInterval(at),a.loadError?(b.addClass("mfp-loading"),X.updateStatus("error",n.tError.replace("%url%",a.src))):(b.removeClass("mfp-loading"),X.updateStatus("ready")),b):(X.updateStatus("loading"),a.loading=!0,a.hasSize||(a.imgHidden=!0,b.addClass("mfp-loading"),X.findImageSize(a)),b)}}});var ax,az=function(){return void 0===ax&&(ax=void 0!==document.createElement("p").style.MozTransform),ax};V.magnificPopup.registerModule("zoom",{options:{enabled:!1,easing:"ease-in-out",duration:300,opener:function(b){return b.is("img")?b:b.find("img")}},proto:{initZoom:function(){var b,h=X.st.zoom,i=".zoom";if(h.enabled&&X.supportsTransition){var l,m,n=h.duration,o=function(c){var g=c.clone().removeAttr("style").removeAttr("class").addClass("mfp-animated-image"),j="all "+h.duration/1000+"s "+h.easing,k={position:"fixed",zIndex:9999,left:0,top:0,"-webkit-backface-visibility":"hidden"},q="transition";return k["-webkit-"+q]=k["-moz-"+q]=k["-o-"+q]=k[q]=j,g.css(k),g},p=function(){X.content.css("visibility","visible")};aN("BuildControls"+i,function(){if(X._allowZoom()){if(clearTimeout(l),X.content.css("visibility","hidden"),b=X._getItemToZoom(),!b){return void p()}m=o(b),m.css(X._getOffset()),X.wrap.append(m),l=setTimeout(function(){m.css(X._getOffset(!0)),l=setTimeout(function(){p(),setTimeout(function(){m.remove(),b=m=null,aP("ZoomAnimationEnded")},16)},n)},16)}}),aN(al+i,function(){if(X._allowZoom()){if(clearTimeout(l),X.st.removalDelay=n,!b){if(b=X._getItemToZoom(),!b){return}m=o(b)}m.css(X._getOffset(!0)),X.wrap.append(m),X.content.css("visibility","hidden"),setTimeout(function(){m.css(X._getOffset())},16)}}),aN(aj+i,function(){X._allowZoom()&&(p(),m&&m.remove(),b=null)})}},_allowZoom:function(){return"image"===X.currItem.type},_getItemToZoom:function(){return X.currItem.hasSize?X.currItem.img:!1},_getOffset:function(a){var b;b=a?X.currItem.img:X.st.zoom.opener(X.currItem.el||X.currItem);var i=b.offset(),j=parseInt(b.css("padding-top"),10),k=parseInt(b.css("padding-bottom"),10);i.top-=V(window).scrollTop()-j;var l={width:b.width(),height:(aK?b.innerHeight():b[0].offsetHeight)-k-j};return az()?l["-moz-transform"]=l.transform="translate("+i.left+"px,"+i.top+"px)":(l.left=i.left,l.top=i.top),l}}});var aB="iframe",aD="//about:blank",aF=function(b){if(X.currTemplate[aB]){var d=X.currTemplate[aB].find("iframe");d.length&&(b||(d[0].src=aD),X.isIE8&&d.css("display",b?"block":"none"))}};V.magnificPopup.registerModule(aB,{options:{markup:'<div class="mfp-iframe-scaler"><div class="mfp-close"></div><iframe class="mfp-iframe" src="//about:blank" frameborder="0" allowfullscreen></iframe></div>',srcAction:"iframe_src",patterns:{youtube:{index:"youtube.com",id:"v=",src:"//www.youtube.com/embed/%id%?autoplay=1"},vimeo:{index:"vimeo.com/",id:"/",src:"//player.vimeo.com/video/%id%?autoplay=1"},gmaps:{index:"//maps.google.",src:"%id%&output=embed"}}},proto:{initIframe:function(){X.types.push(aB),aN("BeforeChange",function(d,e,f){e!==f&&(e===aB?aF():f===aB&&aF(!0))}),aN(aj+"."+aB,function(){aF()})},getIframe:function(a,b){var h=a.src,i=X.st.iframe;V.each(i.patterns,function(){return h.indexOf(this.index)>-1?(this.id&&(h="string"==typeof this.id?h.substr(h.lastIndexOf(this.id)+this.id.length,h.length):this.id.call(this,h)),h=this.src.replace("%id%",h),!1):void 0});var j={};return i.srcAction&&(j[i.srcAction]=h),X._parseMarkup(b,j,a),X.updateStatus("ready"),b}}});var aH=function(b){var d=X.items.length;return b>d-1?b-d:0>b?d+b:b},aJ=function(d,e,f){return d.replace(/%curr%/gi,e+1).replace(/%total%/gi,f)};V.magnificPopup.registerModule("gallery",{options:{enabled:!1,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',preload:[0,2],navigateByImgClick:!0,arrows:!0,tPrev:"Previous (Left arrow key)",tNext:"Next (Right arrow key)",tCounter:"%curr% of %total%"},proto:{initGallery:function(){var a=X.st.gallery,b=".mfp-gallery",d=Boolean(V.fn.mfpFastClick);return X.direction=!0,a&&a.enabled?(af+=" mfp-gallery",aN(au+b,function(){a.navigateByImgClick&&X.wrap.on("click"+b,".mfp-img",function(){return X.items.length>1?(X.next(),!1):void 0}),ab.on("keydown"+b,function(c){37===c.keyCode?X.prev():39===c.keyCode&&X.next()})}),aN("UpdateStatus"+b,function(e,f){f.text&&(f.text=aJ(f.text,X.currItem.index,X.items.length))}),aN(ar+b,function(c,h,i,j){var k=X.items.length;i.counter=k>1?aJ(a.tCounter,j.index,k):""}),aN("BuildControls"+b,function(){if(X.items.length>1&&a.arrows&&!X.arrowLeft){var c=a.arrowMarkup,g=X.arrowLeft=V(c.replace(/%title%/gi,a.tPrev).replace(/%dir%/gi,"left")).addClass(aG),i=X.arrowRight=V(c.replace(/%title%/gi,a.tNext).replace(/%dir%/gi,"right")).addClass(aG),j=d?"mfpFastClick":"click";g[j](function(){X.prev()}),i[j](function(){X.next()}),X.isIE7&&(aO("b",g[0],!1,!0),aO("a",g[0],!1,!0),aO("b",i[0],!1,!0),aO("a",i[0],!1,!0)),X.container.append(g.add(i))}}),aN(aw+b,function(){X._preloadTimeout&&clearTimeout(X._preloadTimeout),X._preloadTimeout=setTimeout(function(){X.preloadNearbyImages(),X._preloadTimeout=null},16)}),void aN(aj+b,function(){ab.off(b),X.wrap.off("click"+b),X.arrowLeft&&d&&X.arrowLeft.add(X.arrowRight).destroyMfpFastClick(),X.arrowRight=X.arrowLeft=null})):!1},next:function(){X.direction=!0,X.index=aH(X.index+1),X.updateItemHTML()},prev:function(){X.direction=!1,X.index=aH(X.index-1),X.updateItemHTML()},goTo:function(b){X.direction=b>=X.index,X.index=b,X.updateItemHTML()},preloadNearbyImages:function(){var b,f=X.st.gallery.preload,g=Math.min(f[0],X.items.length),h=Math.min(f[1],X.items.length);for(b=1;b<=(X.direction?h:g);b++){X._preloadItem(X.index+b)}for(b=1;b<=(X.direction?g:h);b++){X._preloadItem(X.index-b)}},_preloadItem:function(a){if(a=aH(a),!X.items[a].preloaded){var b=X.items[a];b.parsed||(b=X.parseEl(a)),aP("LazyLoad",b),"image"===b.type&&(b.img=V('<img class="mfp-img" />').on("load.mfploader",function(){b.hasSize=!0}).on("error.mfploader",function(){b.hasSize=!0,b.loadError=!0,aP("LazyLoadError",b)}).attr("src",b.src)),b.preloaded=!0}}}});var aL="retina";V.magnificPopup.registerModule(aL,{options:{replaceSrc:function(b){return b.src.replace(/\.\w+$/,function(c){return"@2x"+c})},ratio:1},proto:{initRetina:function(){if(window.devicePixelRatio>1){var b=X.st.retina,d=b.ratio;d=isNaN(d)?d():d,d>1&&(aN("ImageHasSize."+aL,function(c,e){e.img.css({"max-width":e.img[0].naturalWidth/d,width:"100%"})}),aN("ElementParse."+aL,function(a,c){c.src=b.replaceSrc(c,d)}))}}}}),function(){var a=1000,g="ontouchstart" in window,h=function(){aM.off("touchmove"+j+" touchend"+j)},i="mfpFastClick",j="."+i;V.fn.mfpFastClick=function(b){return V(this).each(function(){var c,d=V(this);if(g){var e,f,o,p,q,r;d.on("touchstart"+j,function(k){p=!1,r=1,q=k.originalEvent?k.originalEvent.touches[0]:k.touches[0],f=q.clientX,o=q.clientY,aM.on("touchmove"+j,function(l){q=l.originalEvent?l.originalEvent.touches:l.touches,r=q.length,q=q[0],(Math.abs(q.clientX-f)>10||Math.abs(q.clientY-o)>10)&&(p=!0,h())}).on("touchend"+j,function(l){h(),p||r>1||(c=!0,l.preventDefault(),clearTimeout(e),e=setTimeout(function(){c=!1},a),b())})})}d.on("click"+j,function(){c||b()})})},V.fn.destroyMfpFastClick=function(){V(this).off("touchstart"+j+" click"+j),g&&aM.off("touchmove"+j+" touchend"+j)}}(),W()});var qq=qq||{};var qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}return function(){qq(a).detach(c,b)}},detach:function(c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}return this},contains:function(b){if(a==b){return true}if(a.contains){return a.contains(b)}else{return !!(b.compareDocumentPosition(a)&8)}},insertBefore:function(b){b.parentNode.insertBefore(a,b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b);return this},hasClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},addClass:function(b){if(!qq(a).hasClass(b)){a.className+=" "+b}return this},removeClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(c){if(a.querySelectorAll){return a.querySelectorAll("."+c)}var f=[];var b=a.getElementsByTagName("*");var e=b.length;for(var d=0;d<e;d++){if(qq(b[d]).hasClass(c)){f.push(b[d])}}return f},children:function(){var c=[],b=a.firstChild;while(b){if(b.nodeType==1){c.push(b)}b=b.nextSibling}return c},setText:function(b){a.innerText=b;a.textContent=b;return this},clearText:function(){return qq(a).setText("")}}};qq.log=function(b,a){if(window.console){if(!a||a==="info"){window.console.log(b)}else{if(window.console[a]){window.console[a](b)}else{window.console.log("<"+a+"> "+b)}}}};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.extend=function(b,d,a){var c;for(c in d){if(d.hasOwnProperty(c)){if(a&&qq.isObject(d[c])){if(b[c]===undefined){b[c]={}}qq.extend(b[c],d[c],true)}else{b[c]=d[c]}}}};qq.indexOf=function(a,b,c){if(a.indexOf){return a.indexOf(b,c)}c=c||0;var d=a.length;if(c<0){c+=d}for(;c<d;c++){if(c in a&&a[c]===b){return c}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!=-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!=-1};qq.safari=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf("Apple")!=-1};qq.chrome=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf("Google")!=-1};qq.firefox=function(){return(navigator.userAgent.indexOf("Mozilla")!=-1&&navigator.vendor!=undefined&&navigator.vendor=="")};qq.windows=function(){return navigator.platform=="Win32"};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.obj2url=function(d,g,f){var h=[],e="&",a=function(k,j){var l=g?(/\[\]$/.test(g))?g:g+"["+j+"]":j;if((l!="undefined")&&(j!="undefined")){h.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!f&&g){e=(/\?/.test(g))?(/\?$/.test(g))?"":"&":"?";h.push(g);h.push(qq.obj2url(d))}else{if((Object.prototype.toString.call(d)==="[object Array]")&&(typeof d!="undefined")){for(var b=0,c=d.length;b<c;++b){a(d[b],b)}}else{if((typeof d!="undefined")&&(d!==null)&&(typeof d==="object")){for(var b in d){a(d[b],b)}}else{h.push(encodeURIComponent(g)+"="+encodeURIComponent(d))}}}if(g){return h.join(e)}else{return h.join(e).replace(/^&/,"").replace(/%20/g,"+")}};qq.DisposeSupport={_disposers:[],dispose:function(){var a;while(a=this._disposers.shift()){a()}},addDisposer:function(a){this._disposers.push(a)},_attach:function(){this.addDisposer(qq(arguments[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq(this._input).remove()}qq(this._element).removeClass(this._options.focusClass);this._input=this._createInput()},_createInput:function(){var a=document.createElement("input");if(this._options.multiple){a.setAttribute("multiple","multiple")}if(this._options.acceptFiles){a.setAttribute("accept",this._options.acceptFiles)}a.setAttribute("type","file");a.setAttribute("name",this._options.name);qq(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild(a);var b=this;this._attach(a,"change",function(){b._options.onChange(a)});this._attach(a,"mouseover",function(){qq(b._element).addClass(b._options.hoverClass)});this._attach(a,"mouseout",function(){qq(b._element).removeClass(b._options.hoverClass)});this._attach(a,"focus",function(){qq(b._element).addClass(b._options.focusClass)});this._attach(a,"blur",function(){qq(b._element).removeClass(b._options.focusClass)});return a}};qq.FineUploaderBasic=function(a){var b=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},customHeaders:{},forceMultipart:false,inputName:"qqfile"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:true},callbacks:{onSubmit:function(d,c){},onComplete:function(d,c,e){},onCancel:function(d,c){},onUpload:function(d,c,e){},onProgress:function(d,c,e,f){},onError:function(d,c,e){},onAutoRetry:function(e,d,c){},onManualRetry:function(d,c){},onValidate:function(c){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"}};qq.extend(this._options,a,true);this._wrapCallbacks();qq.extend(this,qq.DisposeSupport);this._filesInProgress=0;this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(b,a){if(this._options.debug&&(!a||a==="info")){qq.log("[FineUploader] "+b)}else{if(a&&a!=="info"){qq.log("[FineUploader] "+b,a)}}},setParams:function(a){this._options.request.params=a},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){while(this._storedFileIds.length){this._filesInProgress++;this._handler.upload(this._storedFileIds.shift(),this._options.request.params)}},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(a){if(this._onBeforeManualRetry(a)){this._handler.retry(a);return true}else{return false}},cancel:function(a){this._handler.cancel(a)},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=0;this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset()},_createUploadButton:function(b){var c=this;var a=new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(d){c._onInputChange(d)}});this.addDisposer(function(){a.dispose()});return a},_createUploadHandler:function(){var c=this,b;if(qq.UploadHandlerXhr.isSupported()){b="UploadHandlerXhr"}else{b="UploadHandlerForm"}var a=new qq[b]({debug:this._options.debug,endpoint:this._options.request.endpoint,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,demoMode:this._options.demoMode,log:this.log,onProgress:function(e,d,f,g){c._onProgress(e,d,f,g);c._options.callbacks.onProgress(e,d,f,g)},onComplete:function(e,d,f,g){c._onComplete(e,d,f,g);c._options.callbacks.onComplete(e,d,f)},onCancel:function(e,d){c._onCancel(e,d);c._options.callbacks.onCancel(e,d)},onUpload:function(e,d,f){c._onUpload(e,d,f);c._options.callbacks.onUpload(e,d,f)},onAutoRetry:function(e,d,f,g){c._preventRetries[e]=f[c._options.retry.preventRetryResponseProperty];if(c._shouldAutoRetry(e,d,f)){c._maybeParseAndSendUploadError(e,d,f,g);c._options.callbacks.onAutoRetry(e,d,c._autoRetries[e]+1);c._onBeforeAutoRetry(e,d);c._retryTimeouts[e]=setTimeout(function(){c._onAutoRetry(e,d,f)},c._options.retry.autoAttemptDelay*1000);return true}else{return false}}});return a},_preventLeaveInProgress:function(){var a=this;this._attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){if(this._options.autoUpload){this._filesInProgress++}},_onProgress:function(b,a,c,d){},_onComplete:function(b,a,c,d){this._filesInProgress--;this._maybeParseAndSendUploadError(b,a,c,d)},_onCancel:function(b,a){clearTimeout(this._retryTimeouts[b]);var c=qq.indexOf(this._storedFileIds,b);if(this._options.autoUpload||c<0){this._filesInProgress--}else{if(!this._options.autoUpload){this._storedFileIds.splice(c,1)}}},_onUpload:function(b,a,c){},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_onBeforeAutoRetry:function(b,a){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+a+"...")},_onAutoRetry:function(b,a,c){this.log("Retrying "+a+"...");this._autoRetries[b]++;this._handler.retry(b)},_shouldAutoRetry:function(b,a,c){if(!this._preventRetries[b]&&this._options.retry.enableAuto){if(this._autoRetries[b]===undefined){this._autoRetries[b]=0}return this._autoRetries[b]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(b){if(this._preventRetries[b]){this.log("Retries are forbidden for id "+b,"warn");return false}else{if(this._handler.isValid(b)){var a=this._handler.getName(b);if(this._options.callbacks.onManualRetry(b,a)===false){return false}this.log("Retrying upload for '"+a+"' (id: "+b+")...");this._filesInProgress++;return true}else{this.log("'"+b+"' is not a valid file ID","error");return false}}},_maybeParseAndSendUploadError:function(c,b,d,e){if(!d.success){if(e&&e.status!==200&&!d.error){this._options.callbacks.onError(c,b,"XHR returned response code "+e.status)}else{var a=d.error?d.error:"Upload failure reason unknown";this._options.callbacks.onError(c,b,a)}}},_uploadFileList:function(b){var d,c,a;d=this._getValidationDescriptors(b);if(d.length>1){a=this._options.callbacks.onValidate(d)===false}if(!a){if(b.length>0){for(c=0;c<b.length;c++){if(this._validateFile(b[c])){this._uploadFile(b[c])}else{if(this._options.validation.stopOnFirstInvalidFile){return}}}}else{this._error("noFilesError","")}}},_uploadFile:function(a){var c=this._handler.add(a);var b=this._handler.getName(c);if(this._options.callbacks.onSubmit(c,b)!==false){this._onSubmit(c,b);if(this._options.autoUpload){this._handler.upload(c,this._options.request.params)}else{this._storeFileForLater(c)}}},_storeFileForLater:function(a){this._storedFileIds.push(a)},_validateFile:function(a){var d,b,c;d=this._getValidationDescriptor(a);b=d.name;c=d.size;if(this._options.callbacks.onValidate([d])===false){return false}if(!this._isAllowedExtension(b)){this._error("typeError",b);return false}else{if(c===0){this._error("emptyError",b);return false}else{if(c&&this._options.validation.sizeLimit&&c>this._options.validation.sizeLimit){this._error("sizeError",b);return false}else{if(c&&c<this._options.validation.minSizeLimit){this._error("minSizeError",b);return false}}}}return true},_error:function(a,c){var d=this._options.messages[a];function e(f,g){d=d.replace(f,g)}var b=this._options.validation.allowedExtensions.join(", ");e("{0}",this._formatFileName(c));e("{1}",b);e("{2}",this._formatSize(this._options.validation.sizeLimit));e("{3}",this._formatSize(this._options.validation.minSizeLimit));this._options.callbacks.onError(null,c,d);return d},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(c){var b=(-1!==c.indexOf("."))?c.replace(/.*[.]/,"").toLowerCase():"";var a=this._options.validation.allowedExtensions;if(!a.length){return true}for(var d=0;d<a.length;d++){if(a[d].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]},_wrapCallbacks:function(){var c,b;c=this;b=function(g,e,d){try{return e.apply(c,d)}catch(f){c.log("Caught exception in '"+g+"' callback - "+f,"error")}};for(var a in this._options.callbacks){(function(){var d=c._options.callbacks[a];c._options.callbacks[a]=function(){return b(a,d,arguments)}}())}},_parseFileName:function(a){var b;if(a.value){b=a.value.replace(/.*(\/|\\)/,"")}else{b=(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name}return b},_parseFileSize:function(a){var b;if(!a.value){b=(a.fileSize!==null&&a.fileSize!==undefined)?a.fileSize:a.size}return b},_getValidationDescriptor:function(a){var c,d,b;b={};c=this._parseFileName(a);d=this._parseFileSize(a);b.name=c;if(d){b.size=d}return b},_getValidationDescriptors:function(b){var c,a;a=[];for(c=0;c<b.length;c++){a.push(b[c])}return a}};qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:false,disableDefaultDropzone:false},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",failUpload:"Upload failed",dragZone:"Drop files here to upload",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?'<div class="qq-upload-drop-area'+(this._options.dragAndDrop.hideDropzones?" hide":"")+'"><p><span>{dragZoneText}</span></p>':"")+((!this._options.button&&!this._options.dragAndDrop.hideDropzones)?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':"")+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?"</div>":"")+((!this._options.button&&this._options.dragAndDrop.hideDropzones)?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':"")+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':this._options.listElement),fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},showMessage:function(b){alert(b)}},true);qq.extend(this._options,a,true);this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._find(this._element,"list");this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._setupDragDrop()};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._setupExtraDropzone(a)},removeExtraDropzone:function(b){var a=this._options.dragAndDrop.extraDropzones;for(var c in a){if(a[c]===b){return this._options.dragAndDrop.extraDropzones.splice(c,1)}}},getItemByFileId:function(a){var b=this._listElement.firstChild;while(b){if(b.qqFileId==a){return b}b=b.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");if(!this._options.button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._setupDragDrop()},_leaving_document_out:function(a){return((qq.chrome()||(qq.safari()&&qq.windows()))&&a.clientX==0&&a.clientY==0)||(qq.firefox()&&!a.relatedTarget)},_storeFileForLater:function(a){qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"spinner")).hide()},_find:function(b,c){var a=qq(b).getByClass(this._options.classes[c])[0];if(!a){throw new Error("element not found "+c)}return a},_setupExtraDropzone:function(a){this._options.dragAndDrop.extraDropzones.push(a);this._setupDropzone(a)},_setupDropzone:function(a){var c=this;var b=new qq.UploadDropZone({element:a,onEnter:function(d){qq(a).addClass(c._classes.dropActive)},onLeave:function(d){},onLeaveNotDescendants:function(d){qq(a).removeClass(c._classes.dropActive)},onDrop:function(d){if(c._options.dragAndDrop.hideDropzones){qq(a).hide()}qq(a).removeClass(c._classes.dropActive);if(d.dataTransfer.files.length>1&&!c._options.multiple){c._error("tooManyFilesError","")}else{c._uploadFileList(d.dataTransfer.files)}}});this.addDisposer(function(){b.dispose()});if(this._options.dragAndDrop.hideDropzones){qq(a).hide()}},_setupDragDrop:function(){var e,a,d;e=this;if(!this._options.dragAndDrop.disableDefaultDropzone){a=this._find(this._element,"drop");this._options.dragAndDrop.extraDropzones.push(a)}var b=this._options.dragAndDrop.extraDropzones;var c;for(c=0;c<b.length;c++){this._setupDropzone(b[c])}if(!this._options.dragAndDrop.disableDefaultDropzone){this._attach(document,"dragenter",function(f){setTimeout(function(){clearTimeout(d);if(qq(a).hasClass(e._classes.dropDisabled)){return}a.style.display="block";for(c=0;c<b.length;c++){b[c].style.display="block"}},2)})}this._attach(document,"dragleave",function(f){clearTimeout(d);d=setTimeout(function(){if(e._options.dragAndDrop.hideDropzones){for(c=0;c<b.length;c++){qq(b[c]).hide()}}},10)});qq(document).attach("drop",function(f){if(e._options.dragAndDrop.hideDropzones){for(c=0;c<b.length;c++){qq(b[c]).hide()}}f.preventDefault()})},_onSubmit:function(b,a){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(c,b,e,j){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var d,g,i,f,a,h;d=this.getItemByFileId(c);g=this._find(d,"progressBar");f=Math.round(e/j*100);if(e===j){a=this._find(d,"cancel");qq(a).hide();qq(g).hide();qq(this._find(d,"statusText")).setText(this._options.text.waitingForResponse);i=this._formatSize(j)}else{i=this._formatProgress(e,j);qq(g).css({display:"block"})}qq(g).css({width:f+"%"});h=this._find(d,"size");qq(h).css({display:"inline"});qq(h).setText(i)},_onComplete:function(b,a,d,e){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var c=this.getItemByFileId(b);qq(this._find(c,"statusText")).clearText();qq(c).removeClass(this._classes.retrying);qq(this._find(c,"progressBar")).hide();if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported()){qq(this._find(c,"cancel")).hide()}qq(this._find(c,"spinner")).hide();if(d.success){qq(c).addClass(this._classes.success);if(this._classes.successIcon){this._find(c,"finished").style.display="inline-block";qq(c).addClass(this._classes.successIcon)}}else{qq(c).addClass(this._classes.fail);if(this._classes.failIcon){this._find(c,"finished").style.display="inline-block";qq(c).addClass(this._classes.failIcon)}if(this._options.retry.showButton&&!this._preventRetries[b]){qq(c).addClass(this._classes.retryable)}this._controlFailureTextDisplay(c,d)}},_onUpload:function(b,a,d){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);var c=this.getItemByFileId(b);this._showSpinner(c)},_onBeforeAutoRetry:function(c){var d,f,a,b,h,e,g;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);d=this.getItemByFileId(c);f=this._find(d,"progressBar");this._showCancelLink(d);f.style.width=0;qq(f).hide();if(this._options.retry.showAutoRetryNote){b=this._find(d,"statusText");h=this._autoRetries[c]+1;e=this._options.retry.maxAutoAttempts;g=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,h);g=g.replace(/\{maxAuto\}/g,e);qq(b).setText(g);if(h===1){qq(d).addClass(this._classes.retrying)}}},_onBeforeManualRetry:function(a){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var b=this.getItemByFileId(a);this._find(b,"progressBar").style.width=0;qq(b).removeClass(this._classes.fail);this._showSpinner(b);this._showCancelLink(b);return true}return false},_addToList:function(d,c){var e=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.UploadHandlerXhr.isSupported()){var a=this._find(e,"cancel");qq(a).remove()}e.qqFileId=d;var b=this._find(e,"file");qq(b).setText(this._formatFileName(c));qq(this._find(e,"size")).hide();if(!this._options.multiple){this._clearList()}this._listElement.appendChild(e)},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var b=this,a=this._listElement;this._attach(a,"click",function(c){c=c||window.event;var f=c.target||c.srcElement;if(qq(f).hasClass(b._classes.cancel)||qq(f).hasClass(b._classes.retry)){qq.preventDefault(c);var d=f.parentNode;while(d.qqFileId==undefined){d=f=f.parentNode}if(qq(f).hasClass(b._classes.cancel)){b.cancel(d.qqFileId);qq(d).remove()}else{qq(d).removeClass(b._classes.retryable);b.retry(d.qqFileId)}}})},_formatProgress:function(d,c){var a=this._options.text.formatProgress;function b(e,f){a=a.replace(e,f)}b("{percent}",Math.round(d/c*100));b("{total_size}",this._formatSize(c));return a},_controlFailureTextDisplay:function(b,e){var d,c,f,a,g;d=this._options.failedUploadTextDisplay.mode;c=this._options.failedUploadTextDisplay.maxChars;f=this._options.failedUploadTextDisplay.responseProperty;if(d==="custom"){a=e[f];if(a){if(a.length>c){g=a.substring(0,c)+"..."}}else{a=this._options.text.failUpload;this.log("'"+f+"' is not a valid property on the server response.","warn")}qq(this._find(b,"statusText")).setText(g||a);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(b,a)}}else{if(d==="default"){qq(this._find(b,"statusText")).setText(this._options.text.failUpload)}else{if(d!=="none"){this.log("failedUploadTextDisplay.mode value of '"+d+"' is not valid","warn")}}}},_showTooltip:function(a,b){a.title=b},_showSpinner:function(a){var b=this._find(a,"spinner");b.style.display="inline-block"},_showCancelLink:function(b){if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported()){var a=this._find(b,"cancel");a.style.display="inline"}},_error:function(a,b){var c=qq.FineUploaderBasic.prototype._error.apply(this,arguments);this._options.showMessage(c)}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return qq.safari()||(qq.firefox()&&qq.windows())},_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){if(this._dragover_should_be_canceled){qq(document).attach("dragover",function(b){b.preventDefault()})}else{qq(document).attach("dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}})}qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;a._attach(a._element,"dragover",function(b){if(!a._isValidFileDrag(b)){return}var c=qq.ie()?null:b.dataTransfer.effectAllowed;if(c=="move"||c=="linkMove"){b.dataTransfer.dropEffect="move"}else{b.dataTransfer.dropEffect="copy"}b.stopPropagation();b.preventDefault()});a._attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});a._attach(a._element,"dragleave",function(b){if(!a._isValidFileDrag(b)){return}a._options.onLeave(b);var c=document.elementFromPoint(b.clientX,b.clientY);if(qq(this).contains(c)){return}a._options.onLeaveNotDescendants(b)});a._attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(b){var a=b.dataTransfer,d=qq.safari();var c=qq.ie10()?true:a.effectAllowed!="none";return a&&c&&(a.files||(!d&&a.types.contains&&a.types.contains("Files")))}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,endpoint:"/upload.php",maxConnections:999,log:function(c,b){},onProgress:function(c,b,d,e){},onComplete:function(c,b,d,e){},onCancel:function(c,b){},onUpload:function(c,b,d){},onAutoRetry:function(c,b,d,e){}};qq.extend(this._options,a);this._queue=[];this._params=[];this.log=this._options.log};qq.UploadHandlerAbstract.prototype={add:function(a){},upload:function(b,d){var c=this._queue.push(b);var a={};qq.extend(a,d);this._params[b]=a;if(c<=this._options.maxConnections){this._upload(b,this._params[b])}},retry:function(b){var a=qq.indexOf(this._queue,b);if(a>=0){this._upload(b,this._params[b])}else{this.upload(b,this._params[b])}},cancel:function(a){this.log("Cancelling "+a);this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},reset:function(){this.log("Resetting upload handler");this._queue=[];this._params=[]},_upload:function(a){},_cancel:function(a){},_dequeue:function(b){var a=qq.indexOf(this._queue,b);this._queue.splice(a,1);var c=this._options.maxConnections;if(this._queue.length>=c&&a<c){var d=this._queue[c-1];this._upload(d,this._params[d])}},isValid:function(a){}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={};this._detach_load_events={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name",this._options.inputName);var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq(a).remove()}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},isValid:function(a){return this._inputs[a]!==undefined},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments);this._inputs={};this._detach_load_events={}},_cancel:function(a){this._options.onCancel(a,this.getName(a));delete this._inputs[a];delete this._detach_load_events[a];var b=document.getElementById(a);if(b){b.setAttribute("src","javascript:false;");qq(b).remove()}},_upload:function(c,f){this._options.onUpload(c,this.getName(c),false);var e=this._inputs[c];if(!e){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var a=this.getName(c);f[this._options.inputName]=a;var d=this._createIframe(c);var b=this._createForm(d,f);b.appendChild(e);var g=this;this._attachLoadEvent(d,function(){g.log("iframe loaded");var h=g._getIframeContentJSON(d);setTimeout(function(){g._detach_load_events[c]();delete g._detach_load_events[c];qq(d).remove()},1);if(!h.success){if(g._options.onAutoRetry(c,a,h)){return}}g._options.onComplete(c,a,h);g._dequeue(c)});this.log("Sending upload request for "+c);b.submit();qq(b).remove();return c},_attachLoadEvent:function(b,a){var c=this;this._detach_load_events[b.id]=qq(b).attach("load",function(){c.log("Received response for "+b.id);if(!b.parentNode){return}try{if(b.contentDocument&&b.contentDocument.body&&b.contentDocument.body.innerHTML=="false"){return}}catch(d){c.log("Error when attempting to access iframe during handling of upload response ("+d+")","error")}a()})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;var innerHTML=doc.body.innerHTML;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+innerHTML);if(innerHTML&&innerHTML.match(/^<pre/i)){innerHTML=doc.body.firstChild.firstChild.nodeValue}response=eval("("+innerHTML+")")}catch(error){this.log("Error when attempting to parse form upload response ("+error+")","error");response={success:false}}return response},_createIframe:function(a){var b=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');b.setAttribute("id",a);b.style.display="none";document.body.appendChild(b);return b},_createForm:function(b,c){var d=this._options.demoMode?"GET":"POST";var a=qq.toElement('<form method="'+d+'" enctype="multipart/form-data"></form>');var e=qq.obj2url(c,this._options.endpoint);a.setAttribute("action",e);a.setAttribute("target",b.name);a.style.display="none";document.body.appendChild(a);return a}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return("multiple" in a&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined")};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},isValid:function(a){return this._files[a]!==undefined},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]},_upload:function(c,e){this._options.onUpload(c,this.getName(c),true);var a=this._files[c],d=this.getName(c),i=this.getSize(c);this._loaded[c]=0;var j=this._xhrs[c]=new XMLHttpRequest();var h=this;j.upload.onprogress=function(k){if(k.lengthComputable){h._loaded[c]=k.loaded;h._options.onProgress(c,d,k.loaded,k.total)}};j.onreadystatechange=function(){if(j.readyState==4){h._onComplete(c,j)}};e=e||{};e[this._options.inputName]=d;var g=qq.obj2url(e,this._options.endpoint);var f=this._options.demoMode?"GET":"POST";j.open(f,g,true);j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.setRequestHeader("X-File-Name",encodeURIComponent(d));j.setRequestHeader("Cache-Control","no-cache");if(this._options.forceMultipart){var b=new FormData();b.append(this._options.inputName,a);a=b}else{j.setRequestHeader("Content-Type","application/octet-stream");j.setRequestHeader("X-Mime-Type",a.type)}for(key in this._options.customHeaders){j.setRequestHeader(key,this._options.customHeaders[key])}this.log("Sending upload request for "+c);j.send(a)},_onComplete:function(id,xhr){if(!this._files[id]){return}var name=this.getName(id);var size=this.getSize(id);var response;this._options.onProgress(id,name,size,size);this.log("xhr - server response received for "+id);this.log("responseText = "+xhr.responseText);try{if(typeof JSON.parse==="function"){response=JSON.parse(xhr.responseText)}else{response=eval("("+xhr.responseText+")")}}catch(error){this.log("Error when attempting to parse xhr response text ("+error+")","error");response={}}if(xhr.status!==200||!response.success){if(this._options.onAutoRetry(id,name,response,xhr)){return}}this._options.onComplete(id,name,response,xhr);this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});(function(a){var k,b,f,d,h,i,c,j,g,e;i=["uploaderType"];f=function(l){if(l){var m=j(l);c(m);if(h("uploaderType")==="basic"){k(new qq.FineUploaderBasic(m))}else{k(new qq.FineUploader(m))}}return b};d=function(m,n){var l=b.data("fineuploader");if(n){if(l===undefined){l={}}l[m]=n;b.data("fineuploader",l)}else{if(l===undefined){return null}return l[m]}};k=function(l){return d("uploader",l)};h=function(l,m){return d(l,m)};c=function(m){var l=m.callbacks={};a.each(new qq.FineUploaderBasic()._options.callbacks,function(q,o){var p,n;p=/^on(\w+)/.exec(q)[1];p=p.substring(0,1).toLowerCase()+p.substring(1);n=b;l[q]=function(){var r=Array.prototype.slice.call(arguments);return n.triggerHandler(p,r)}})};j=function(n,m){var o,l;if(m===undefined){if(n.uploaderType!=="basic"){o={element:b[0]}}else{o={}}}else{o=m}a.each(n,function(p,q){if(a.inArray(p,i)>=0){h(p,q)}else{if(q instanceof a){o[p]=q[0]}else{if(a.isPlainObject(q)){o[p]={};j(q,o[p])}else{if(a.isArray(q)){l=[];a.each(q,function(s,r){if(r instanceof a){a.merge(l,r)}else{l.push(r)}});o[p]=l}else{o[p]=q}}}}});if(m===undefined){return o}};g=function(l){return a.type(l)==="string"&&!l.match(/^_/)&&k()[l]!==undefined};e=function(l){return k()[l].apply(k(),Array.prototype.slice.call(arguments,1))};a.fn.fineUploader=function(l){b=this;if(k()&&g(l)){return e.apply(this,arguments)}else{if(typeof l==="object"||!l){return f.apply(this,arguments)}else{a.error("Method "+l+" does not exist on jQuery.fineUploader")}}return this}}(jQuery));(function(a){var c={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:false,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:true,theme:null,resultsFormatter:function(g){return(g)?"<li>"+g[this.propertyToSearch]+"</li>":g},tokenFormatter:function(g){return(g)?"<li><p>"+g[this.propertyToSearch]+"</p></li>":g},tokenLimit:null,tokenDelimiter:",",preventDuplicates:false,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",allowNewToken:false};var b={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"};var f={BEFORE:0,AFTER:1,END:2};var d={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188};var e={init:function(i,g){var h=a.extend({},c,g||{});return this.each(function(){a(this).data("tokenInputObject",new a.TokenList(this,i,h))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(g){this.data("tokenInputObject").add(g);return this},remove:function(g){this.data("tokenInputObject").remove(g);return this},get:function(){return this.data("tokenInputObject").getTokens()},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var h=this;var g=this.parent();g.empty();h.show();g.append(h);return h}}};a.fn.tokenInput=function(g){if(e[g]){return e[g].apply(this,Array.prototype.slice.call(arguments,1))}else{return e.init.apply(this,arguments)}};a.TokenList=function(t,U,K){if(a.type(U)==="string"||a.type(U)==="function"){K.url=U;var T=j();if(K.crossDomain===undefined){if(T.indexOf("://")===-1){K.crossDomain=false}else{K.crossDomain=(location.href.split(/\/+/g)[1]!==T.split(/\/+/g)[1])}}}else{if(typeof(U)==="object"){K.local_data=U}}if(K.classes){K.classes=a.extend({},b,K.classes)}else{if(K.theme){K.classes={};a.each(b,function(V,W){K.classes[V]=W+"-"+K.theme})}else{K.classes=b}}var E=[];var Q=0;var h=new a.TokenList.Cache();var O;var x;var u=a('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",K.idPrefix+t.id).prop("placeholder",a(t).prop("placeholder")).focus(function(){if(K.tokenLimit===null||K.tokenLimit!==Q){M()}}).blur(function(){r();a(this).val("")}).bind("keyup keydown blur update",C).keydown(function(W){var Y;var X;switch(W.keyCode){case d.LEFT:case d.RIGHT:case d.UP:case d.DOWN:if(!a(this).val()){Y=w.prev();X=w.next();if((Y.length&&Y.get(0)===I)||(X.length&&X.get(0)===I)){if(W.keyCode===d.LEFT||W.keyCode===d.UP){m(a(I),f.BEFORE)}else{m(a(I),f.AFTER)}}else{if((W.keyCode===d.LEFT||W.keyCode===d.UP)&&Y.length){G(a(Y.get(0)))}else{if((W.keyCode===d.RIGHT||W.keyCode===d.DOWN)&&X.length){G(a(X.get(0)))}}}}else{var V=null;if(W.keyCode===d.DOWN||W.keyCode===d.RIGHT){V=a(H).next()}else{V=a(H).prev()}if(V.length){F(V)}return false}break;case d.BACKSPACE:Y=w.prev();if(!a(this).val().length){if(I){k(a(I));q.change()}else{if(Y.length){G(a(Y.get(0)))}}return false}else{if(a(this).val().length===1){r()}else{setTimeout(function(){n()},5)}}break;case d.TAB:case d.ENTER:case d.NUMPAD_ENTER:case d.COMMA:if(H){g(a(H).data("tokeninput"));q.change();return false}break;case d.ESCAPE:r();return true;case d.SPACE:if(K.allowNewToken){var Z=a(this).val();if(Z){g({id:Z,name:Z})}return false}default:if(String.fromCharCode(W.which)){setTimeout(function(){n()},5)}break}});var q=a(t).hide().val("").focus(function(){u.focus()}).blur(function(){u.blur()});var I=null;var J=0;var H=null;var R=a("<ul />").addClass(K.classes.tokenList).click(function(V){var W=a(V.target).closest("li");if(W&&W.get(0)&&a.data(W.get(0),"tokeninput")){P(W)}else{if(I){m(a(I),f.END)}u.focus()}}).mouseover(function(V){var W=a(V.target).closest("li");if(W&&I!==this){W.addClass(K.classes.highlightedToken)}}).mouseout(function(V){var W=a(V.target).closest("li");if(W&&I!==this){W.removeClass(K.classes.highlightedToken)}}).insertBefore(q);var w=a("<li />").addClass(K.classes.inputToken).appendTo(R).append(u);var o=a("<div>").addClass(K.classes.dropdown).appendTo("body").hide();var v=a("<tester/>").insertAfter(u).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:u.css("fontSize"),fontFamily:u.css("fontFamily"),fontWeight:u.css("fontWeight"),letterSpacing:u.css("letterSpacing"),whiteSpace:"nowrap"});q.val("");var A=K.prePopulate||q.data("pre");if(K.processPrePopulate&&a.isFunction(K.onResult)){A=K.onResult.call(q,A)}if(A&&A.length){a.each(A,function(V,W){y(W);i()})}if(a.isFunction(K.onReady)){K.onReady.call()}this.clear=function(){R.children("li").each(function(){if(a(this).children("input").length===0){k(a(this))}})};this.add=function(V){g(V)};this.remove=function(V){R.children("li").each(function(){if(a(this).children("input").length===0){var W=a(this).data("tokeninput");var X=true;for(var Y in V){if(V[Y]!==W[Y]){X=false;break}}if(X){k(a(this))}}})};this.getTokens=function(){return E};function i(){if(K.tokenLimit!==null&&Q>=K.tokenLimit){u.hide();r();return}}function C(){if(x===(x=u.val())){return}var V=x.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");v.html(V);u.width(v.width()+30)}function z(V){return((V>=48&&V<=90)||(V>=96&&V<=111)||(V>=186&&V<=192)||(V>=219&&V<=222))}function y(V){var W=K.tokenFormatter(V);W=a(W).addClass(K.classes.token).insertBefore(w);a("<span>"+K.deleteText+"</span>").addClass(K.classes.tokenDelete).appendTo(W).click(function(){k(a(this).parent());q.change();return false});var X={id:V.id};X[K.propertyToSearch]=V[K.propertyToSearch];a.data(W.get(0),"tokeninput",V);E=E.slice(0,J).concat([X]).concat(E.slice(J));J++;S(E,q);Q+=1;if(K.tokenLimit!==null&&Q>=K.tokenLimit){u.hide();r()}return W}function g(X){var V=K.onAdd;if(Q>0&&K.preventDuplicates){var W=null;R.children().each(function(){var Z=a(this);var Y=a.data(Z.get(0),"tokeninput");if(Y&&Y.id===X.id){W=Z;return false}});if(W){G(W);w.insertAfter(W);u.focus();return}}if(K.tokenLimit==null||Q<K.tokenLimit){y(X);i()}u.val("");r();if(a.isFunction(V)){V.call(q,X)}}function G(V){V.addClass(K.classes.selectedToken);I=V.get(0);u.val("");r()}function m(W,V){W.removeClass(K.classes.selectedToken);I=null;if(V===f.BEFORE){w.insertBefore(W);J--}else{if(V===f.AFTER){w.insertAfter(W);J++}else{w.appendTo(R);J=Q}}u.focus()}function P(W){var V=I;if(I){m(a(I),f.END)}if(V===W.get(0)){m(W,f.END)}else{G(W)}}function k(X){var Y=a.data(X.get(0),"tokeninput");var V=K.onDelete;var W=X.prevAll().length;if(W>J){W--}X.remove();I=null;u.focus();E=E.slice(0,W).concat(E.slice(W+1));if(W<J){J--}S(E,q);Q-=1;if(K.tokenLimit!==null){u.show().val("").focus()}if(a.isFunction(V)){V.call(q,Y)}}function S(W,V){var X=a.map(W,function(Y){return Y[K.tokenValue]});V.val(X.join(K.tokenDelimiter))}function r(){o.hide().empty();H=null}function L(){o.css({position:"absolute",top:a(R).offset().top+a(R).outerHeight(),left:a(R).offset().left,"z-index":100010}).show()}function N(){if(K.searchingText){o.html("<p>"+K.searchingText+"</p>");L()}}function M(){if(K.hintText){o.html("<p>"+K.hintText+"</p>");L()}}function s(W,V){return W.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+V+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function p(V,X,W){return V.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+X+")(?![^<>]*>)(?![^&;]+;)","g"),s(X,W))}function B(W,X){if(X&&X.length){o.empty();var V=a("<ul>").appendTo(o).mouseover(function(Y){F(a(Y.target).closest("li"))}).mousedown(function(Y){g(a(Y.target).closest("li").data("tokeninput"));q.change();return false}).hide();a.each(X,function(Y,aa){var Z=K.resultsFormatter(aa);Z=p(Z,aa[K.propertyToSearch],W);Z=a(Z).appendTo(V);if(Y%2){Z.addClass(K.classes.dropdownItem)}else{Z.addClass(K.classes.dropdownItem2)}if(Y===0){F(Z)}a.data(Z.get(0),"tokeninput",aa)});L();if(K.animateDropdown){V.slideDown("fast")}else{V.show()}}else{if(K.noResultsText){o.html("<p>"+K.noResultsText+"</p>");L()}}}function F(V){if(V){if(H){l(a(H))}V.addClass(K.classes.selectedDropdownItem);H=V.get(0)}}function l(V){V.removeClass(K.classes.selectedDropdownItem);H=null}function n(){var V=u.val().toLowerCase();if(V&&V.length){if(I){m(a(I),f.AFTER)}if(V.length>=K.minChars){N();clearTimeout(O);O=setTimeout(function(){D(V)},K.searchDelay)}else{r()}}}function D(X){console.log("Query: "+X);var V=X+j();var W=h.get(V);if(W){B(X,W)}else{if(K.url){var Z=j();a.ajax({url:Z+"?q="+X,success:function(aa){if(a.isFunction(K.onResult)){aa=K.onResult.call(q,aa)}h.add(V,K.jsonContainer?aa[K.jsonContainer]:aa);if(u.val().toLowerCase()===X){B(X,K.jsonContainer?aa[K.jsonContainer]:aa)}},error:function(ac,ab,aa){console.log("Results failed: "+aa)}})}else{if(K.local_data){var Y=a.grep(K.local_data,function(aa){return aa[K.propertyToSearch].toLowerCase().indexOf(X.toLowerCase())>-1});if(a.isFunction(K.onResult)){Y=K.onResult.call(q,Y)}h.add(V,Y);B(X,Y)}}}}function j(){var V=K.url;if(typeof K.url=="function"){V=K.url.call()}return V}};a.TokenList.Cache=function(i){var j=a.extend({max_size:500},i);var g={};var k=0;var h=function(){g={};k=0};this.add=function(l,m){if(k>j.max_size){h()}if(!g[l]){k+=1}g[l]=m};this.get=function(l){return g[l]}}}(jQuery));(function(a){a.confirm=function(j,o){if(typeof(o)=="function"){var n=o;o=a.confirm.defaults;o.onConfirm=n}else{o=a.extend({},a.confirm.defaults,o)}var l=a(o.container);var i=a(o.headerContainer);var p=a(o.headerTitleContainer);var b=a(o.bodyContainer);var h=a(o.footerContainer);var k=a(o.messageContainer);var f=a(o.confirmButton);var c=a(o.cancelButton);var q="missing",m="missing";if(Communifire&&Communifire.Resources){q=Communifire.Resources.getValue("globalYesText");m=Communifire.Resources.getValue("globalNoText")}if(o.confirmButtonText=="missing"){o.confirmButtonText=q}if(o.cancelButtonText=="missing"){o.cancelButtonText=m}if(o.modalClass){l.addClass(o.modalClass)}var e=function(){l.modal("hide")};if(o.title&&o.showHeader){p.append(o.title);if(o.showHeaderCloseButton){i.append(o.headerCloseButton)}i.append(p);l.append(i)}if(typeof(j)=="string"){k.append(j);b.append(k)}else{j.show();b.append(j)}l.append(b);if(o.showFooter){var g=null;if(o.confirmButtonIcon){g=o.confirmButtonIcon}if(o.confirmButtonText){g=(g)?g+" "+o.confirmButtonText:o.confirmButtonText}f.html(g);if(o.confirmButtonClass){f.addClass(o.confirmButtonClass)}f.on("click",function(){if(o.onConfirm!=null){o.onConfirm.apply(l);if(o.hideOnConfirm){l.modal("hide")}}});var d=null;if(o.confirmButtonIcon){d=o.cancelButtonIcon}if(o.confirmButtonText){d=(d)?d+" "+o.cancelButtonText:o.cancelButtonText}c.html(d);if(o.cancelButtonClass){c.addClass(o.cancelButtonClass)}c.on("click",function(){if(o.onCancel!=null){o.onCancel();l.modal("hide")}});if(o.reverseButtonsOrder){h.append(c);h.append(f)}else{h.append(f);h.append(c)}l.append(h)}l.modal(o)};a.confirm.defaults={title:null,showHeader:true,showFooter:true,showHeaderCloseButton:true,hideOnConfirm:true,container:'<div class="modal modal-delete"></div>',headerContainer:'<div class="modal-header"></div>',headerCloseButton:'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>',headerTitleContainer:"<h3></h3>",bodyContainer:'<div class="modal-body"></div>',messageContainer:"<p></p>",footerContainer:'<div class="modal-footer"></div>',confirmButton:'<button id="EditFilePropertiesModalSaveButton" class="btn"></button>',confirmButtonIcon:null,confirmButtonText:"missing",modalClass:"",confirmButtonClass:"",cancelButton:'<button class="btn" data-dismiss="modal" aria-hidden="true"></button>',cancelButtonIcon:null,cancelButtonText:"missing",cancelButtonClass:null,onConfirm:null,onCancel:null,reverseButtonsOrder:false,backdrop:"static"};a.fn.confirm=function(b){a.confirm(this,b);return this}})(jQuery);(function(y){var P=y.fn.domManip,B="_tmplitem",O=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,z={},D={},C,N={key:0,data:{}},F=0,A=0,J=[];function E(f,b,h,j){var a={data:j||(b?b.data:{}),_wrap:b?b._wrap:null,tmpl:null,parent:b||null,nodes:[],calls:S,nest:U,wrap:V,html:T,update:R};f&&y.extend(a,f,{nodes:[],parent:b});if(h){a.tmpl=h;a._ctnt=a._ctnt||a.tmpl(y,a);a.key=++F;(J.length?D:z)[F]=a}return a}y.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,a){y.fn[b]=function(r){var c=[],e=y(r),o,d,q,p,f=this.length===1&&this[0].parentNode;C=z||{};if(f&&f.nodeType===11&&f.childNodes.length===1&&e.length===1){e[a](this[0]);c=this}else{for(d=0,q=e.length;d<q;d++){A=d;o=(d>0?this.clone(true):this).get();y.fn[a].apply(y(e[d]),o);c=c.concat(o)}A=0;c=this.pushStack(c,b,e.selector)}p=C;C=null;y.tmpl.complete(p);return c}});y.fn.extend({tmpl:function(f,e,a){return y.tmpl(this[0],f,e,a)},tmplItem:function(){return y.tmplItem(this[0])},template:function(a){return y.template(a,this[0])},domManip:function(a,n,m){if(a[0]&&a[0].nodeType){var b=y.makeArray(arguments),c=a.length,k=0,e;while(k<c&&!(e=y.data(a[k++],"tmplItem"))){}if(c>1){b[0]=[y.makeArray(a)]}if(e&&A){b[2]=function(d){y.tmpl.afterManip(this,d,m)}}P.apply(this,b)}else{P.apply(this,arguments)}A=0;!C&&y.tmpl.complete(z);return this}});y.extend({tmpl:function(b,g,f,a){var i,l=!a;if(l){a=N;b=y.template[b]||y.template(null,b);D={}}else{if(!b){b=a.tmpl;z[a.key]=a;a.nodes=[];a.wrapped&&L(a,a.wrapped);return y(G(a,null,a.tmpl(y,a)))}}if(!b){return[]}if(typeof g==="function"){g=g.call(a||{})}f&&f.wrapped&&L(f,f.wrapped);i=y.isArray(g)?y.map(g,function(c){return c?E(f,a,b,c):null}):[E(f,a,b,g)];return l?y(G(a,null,i)):i},tmplItem:function(a){var d;if(a instanceof y){a=a[0]}while(a&&a.nodeType===1&&!(d=y.data(a,"tmplItem"))&&(a=a.parentNode)){}return d||N},template:function(d,a){if(a){if(typeof a==="string"){a=M(a)}else{if(a instanceof y){a=a[0]||{}}}if(a.nodeType){a=y.data(a,"tmpl")||y.data(a,"tmpl",M(a.innerHTML))}return typeof d==="string"?(y.template[d]=a):a}return d?typeof d!=="string"?y.template(null,d):y.template[d]||y.template(null,O.test(d)?d:y(d)):null},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});y.extend(y.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){z={}},afterManip:function(h,a,c){var g=a.nodeType===11?y.makeArray(a.childNodes):a.nodeType===1?[a]:[];c.call(h,a);K(g);A++}});function G(h,j,i){var a,d=i?y.map(i,function(b){return typeof b==="string"?h.key?b.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+B+'="'+h.key+'" $2'):b:G(b,h,b._ctnt)}):h;if(j){return d}d=d.join("");d.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(l,b,k,g){a=y(k).get();K(a);if(b){a=H(b).concat(a)}if(g){a=a.concat(H(g))}});return a?a:H(d)}function H(d){var a=document.createElement("div");a.innerHTML=d;return y.makeArray(a.childNodes)}function M(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+y.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(w,v,u,o,k,n,p){var t=y.tmpl.tag[u],s,q,r;if(!t){throw"Template command not found: "+u}s=t._default||[];if(n&&!/\w$/.test(k)){k+=n;n=""}if(k){k=I(k);p=p?","+I(p)+")":n?")":"";q=n?k.indexOf(".")>-1?k+n:"("+k+").call($item"+p:k;r=n?q:"(typeof("+k+")==='function'?("+k+").call($item):("+k+"))"}else{r=q=s.$1||"null"}o=I(o);return"');"+t[v?"close":"open"].split("$notnull_1").join(k?"typeof("+k+")!=='undefined' && ("+k+")!=null":"true").split("$1a").join(r).split("$1").join(q).split("$2").join(o?o.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(h,g,f,e){e=e?","+e+")":f?")":"";return e?"("+g+").call($item"+e:h}):s.$2||"")+"_.push('"})+"');}return _;")}function L(d,a){d._wrap=G(d,true,y.isArray(a)?a:[O.test(a)?a:y(a).html()]).join("")}function I(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function Q(d){var c=document.createElement("div");c.appendChild(d.cloneNode(true));return c.innerHTML}function K(q){var h="_"+A,d,c,f={},a,r,b;for(a=0,r=q.length;a<r;a++){if((d=q[a]).nodeType!==1){continue}c=d.getElementsByTagName("*");for(b=c.length-1;b>=0;b--){g(c[b])}g(d)}function g(s){var w,n=s,t,l,u;if(u=s.getAttribute(B)){while(n.parentNode&&(n=n.parentNode).nodeType===1&&!(w=n.getAttribute(B))){}if(w!==u){n=n.parentNode?n.nodeType===11?0:n.getAttribute(B)||0:0;if(!(l=z[u])){l=D[u];l=E(l,z[n]||D[n],null,true);l.key=++F;z[F]=l}A&&v(u)}s.removeAttribute(B)}else{if(A&&(l=y.data(s,"tmplItem"))){v(l.key);z[l.key]=l;n=y.data(s.parentNode,"tmplItem");n=n?n.key:0}}if(l){t=l;while(t&&t.key!=n){t.nodes.push(s);t=t.parent}delete l._ctnt;delete l._wrap;y.data(s,"tmplItem",l)}function v(e){e=e+h;l=f[e]=f[e]||E(l,z[l.parent.key+h]||l.parent,null,true)}}}function S(e,h,g,f){if(!e){return J.pop()}J.push({_:e,tmpl:h,item:this,data:g,options:f})}function U(f,e,a){return y.tmpl(y.template(f),e,a,this)}function V(a,f){var e=a.options||{};e.wrapped=f;return y.tmpl(y.template(a.tmpl),a.data,e,a.item)}function T(f,e){var a=this._wrap;return y.map(y(y.isArray(a)?a.join(""):a).filter(f||"*"),function(b){return e?b.innerText||b.textContent:b.outerHTML||Q(b)})}function R(){var a=this.nodes;y.tmpl(null,null,null,this).insertBefore(a[0]);y(a).remove()}})(jQuery);/*
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(a,d,h){var f=/\+/g;function g(j){return j}function c(j){return i(decodeURIComponent(j.replace(f," ")))}function i(j){if(j.indexOf('"')===0){j=j.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}return j}function e(j){return b.json?JSON.parse(j):j}var b=a.cookie=function(p,x,s){if(x!==h){s=a.extend({},b.defaults,s);if(x===null){s.expires=-1}if(typeof s.expires==="number"){var m=s.expires,w=s.expires=new Date();w.setDate(w.getDate()+m)}x=b.json?JSON.stringify(x):String(x);return(d.cookie=[encodeURIComponent(p),"=",b.raw?x:encodeURIComponent(x),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join(""))}var n=b.raw?g:c;var k=d.cookie.split("; ");var v=p?null:{};for(var o=0,q=k.length;o<q;o++){var u=k[o].split("=");var r=n(u.shift());var j=n(u.join("="));if(p&&p===r){v=e(j);break}if(!p){v[r]=e(j)}}return v};b.defaults={};a.removeCookie=function(j,k){if(a.cookie(j)!==null){a.cookie(j,null,k);return true}return false}})(jQuery,document);(function(a){a.timeago=function(g){if(g instanceof Date){return d(g)}else{if(typeof g==="string"){return d(a.timeago.parse(g))}else{return d(a.timeago.datetime(g))}}};var b=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:60000,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(i){var g=this.settings.strings;var l=g.prefixAgo;var o=g.suffixAgo;if(this.settings.allowFuture){if(i<0){l=g.prefixFromNow;o=g.suffixFromNow}}var m=Math.abs(i)/1000;var k=m/60;var j=k/60;var h=j/24;var q=h/365;function n(t,r){var s=a.isFunction(t)?t(r,i):t;var u=(g.numbers&&g.numbers[r])||r;return s.replace(/%d/i,u)}var p=m<45&&n(g.seconds,Math.round(m))||m<90&&n(g.minute,1)||k<45&&n(g.minutes,Math.round(k))||k<90&&n(g.hour,1)||j<24&&n(g.hours,Math.round(j))||j<48&&n(g.day,1)||h<30&&n(g.days,Math.floor(h))||h<60&&n(g.month,1)||h<365&&n(g.months,Math.floor(h/30))||q<2&&n(g.year,1)||n(g.years,Math.floor(q));return a.trim([l,p,o].join(" "))},parse:function(g){var h=a.trim(g);h=h.replace(/\.\d\d\d+/,"");h=h.replace(/-/,"/").replace(/-/,"/");h=h.replace(/T/," ").replace(/Z/," UTC");h=h.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(h)},datetime:function(g){var i=a(g).get(0).tagName.toLowerCase()==="time";var h=i?a(g).attr("datetime"):a(g).attr("title");return b.parse(h)}});a.fn.timeago=function(){var h=this;h.each(f);var g=b.settings;if(g.refreshMillis>0){setInterval(function(){h.each(f)},g.refreshMillis)}return h};function f(){var g=e(this);if(!isNaN(g.datetime)){a(this).text(d(g.datetime))}return this}function e(g){g=a(g);if(!g.data("timeago")){g.data("timeago",{datetime:b.datetime(g)});var h=a.trim(g.text());if(h.length>0){g.attr("title",h)}}return g.data("timeago")}function d(g){return b.inWords(c(g))}function c(g){return(new Date().getTime()-g.getTime())}document.createElement("abbr");document.createElement("time")}(jQuery));window.linkify=(function(){var z="[a-z\\d.-]+://",w="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",r="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",C="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",u="(?:"+r+C+"|"+w+")",D="(?:[;/][^#?<>\\s]*)?",t="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",s="\\b"+z+"[^<>\\s]+",p="\\b"+u+D+t+"(?!\\w)",B="mailto:",y="(?:"+B+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+u+t+"(?!\\w)",A=new RegExp("(?:"+s+"|"+p+"|"+y+")","ig"),v=new RegExp("^"+z,"i"),q={"'":"`",">":"<",")":"(","]":"[","}":"{","B;":"B+","b?:":"b?9"},x={callback:function(b,a){return a?'<a href="'+a+'" title="'+a+'">'+b+"</a>":b},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(k,F){F=F||{};var m,l,a,f,n="",j=[],i,e,c,o,g,d,b,h;for(l in x){if(F[l]===undefined){F[l]=x[l]}}while(m=A.exec(k)){a=m[0];e=A.lastIndex;c=e-a.length;if(/[\/:]/.test(k.charAt(c-1))){continue}do{o=a;h=a.substr(-1);b=q[h];if(b){g=a.match(new RegExp("\\"+b+"(?!$)","g"));d=a.match(new RegExp("\\"+h,"g"));if((g?g.length:0)<(d?d.length:0)){a=a.substr(0,a.length-1);e--}}if(F.punct_regexp){a=a.replace(F.punct_regexp,function(E){e-=E.length;return""})}}while(a.length&&a!==o);f=a;if(!v.test(f)){f=(f.indexOf("@")!==-1?(!f.indexOf(B)?"":B):!f.indexOf("irc.")?"irc://":!f.indexOf("ftp.")?"ftp://":"http://")+f}if(i!=c){j.push([k.slice(i,c)]);i=e}j.push([a,f])}j.push([k.substr(i)]);for(l=0;l<j.length;l++){n+=F.callback.apply(window,j[l])}return n||k}})();(function(a){var e={put:function(g,h){(h||window).location.hash=this.encoder(g)},get:function(i){var h=((i||window).location.hash).replace(/^#/,"");try{return a.browser.mozilla?h:decodeURIComponent(h)}catch(g){return h}},encoder:encodeURIComponent};var b={id:"__jQuery_history",init:function(){var g='<iframe id="'+this.id+'" style="display:none" src="javascript:false;" />';a("body").prepend(g);return this},_document:function(){return a("#"+this.id)[0].contentWindow.document},put:function(h){var g=this._document();g.open();g.close();e.put(h,g)},get:function(){return e.get(this._document())}};function d(h){h=a.extend({unescape:false},h||{});e.encoder=g(h.unescape);function g(j){if(j===true){return function(k){return k}}if(typeof j=="string"&&(j=i(j.split("")))||typeof j=="function"){return function(k){return j(encodeURIComponent(k))}}return encodeURIComponent}function i(j){var k=new RegExp(a.map(j,encodeURIComponent).join("|"),"ig");return function(l){return l.replace(k,decodeURIComponent)}}}var c={};c.base={callback:undefined,type:undefined,check:function(){},load:function(g){},init:function(g,h){d(h);f.callback=g;f._options=h;f._init()},_init:function(){},_options:{}};c.timer={_appState:undefined,_init:function(){var g=e.get();f._appState=g;f.callback(g);setInterval(f.check,100)},check:function(){var g=e.get();if(g!=f._appState){f._appState=g;f.callback(g)}},load:function(g){if(g!=f._appState){e.put(g);f._appState=g;f.callback(g)}}};c.iframeTimer={_appState:undefined,_init:function(){var g=e.get();f._appState=g;b.init().put(g);f.callback(g);setInterval(f.check,100)},check:function(){var g=b.get(),h=e.get();if(h!=g){if(h==f._appState){f._appState=g;e.put(g);f.callback(g)}else{f._appState=h;b.put(h);f.callback(h)}}},load:function(g){if(g!=f._appState){e.put(g);b.put(g);f._appState=g;f.callback(g)}}};c.hashchangeEvent={_init:function(){f.callback(e.get());a(window).bind("hashchange",f.check)},check:function(){f.callback(e.get())},load:function(g){e.put(g)}};var f=a.extend({},c.base);if(a.browser.msie&&(a.browser.version<8||document.documentMode<8)){f.type="iframeTimer"}else{if("onhashchange" in window){f.type="hashchangeEvent"}else{f.type="timer"}}a.extend(f,c[f.type]);a.history=f})(jQuery);(function(ak){function aJ(a,b){return function(c){return ax(a.call(this,c),b)}}function aE(a){return function(b){return this.lang().ordinal(a.call(this,b))}}function ab(){}function aj(a){at(this,a)}function aL(c){var m=this._data={},h=c.years||c.year||c.y||0,k=c.months||c.month||c.M||0,g=c.weeks||c.week||c.w||0,l=c.days||c.day||c.d||0,j=c.hours||c.hour||c.h||0,p=c.minutes||c.minute||c.m||0,b=c.seconds||c.second||c.s||0,d=c.milliseconds||c.millisecond||c.ms||0;this._milliseconds=d+b*1000+p*60000+j*3600000,this._days=l+g*7,this._months=k+h*12,m.milliseconds=d%1000,b+=af(d/1000),m.seconds=b%60,p+=af(b/60),m.minutes=p%60,j+=af(p/60),m.hours=j%24,l+=af(j/24),l+=g*7,m.days=l%30,k+=af(l/30),m.months=k%12,h+=af(k/12),m.years=h}function at(a,c){for(var b in c){c.hasOwnProperty(b)&&(a[b]=c[b])}return a}function af(a){return a<0?Math.ceil(a):Math.floor(a)}function ax(a,c){var b=a+"";while(b.length<c){b="0"+b}return b}function ao(a,h,c){var f=h._milliseconds,b=h._days,g=h._months,d;f&&a._d.setTime(+a+f*c),b&&a.date(a.date()+b*c),g&&(d=a.date(),a.date(1).month(a.month()+g*c).date(Math.min(d,a.daysInMonth())))}function av(a){return Object.prototype.toString.call(a)==="[object Array]"}function aM(a,g){var c=Math.min(a.length,g.length),d=Math.abs(a.length-g.length),b=0,f;for(f=0;f<c;f++){~~a[f]!==~~g[f]&&b++}return b+d}function aP(a,b){return b.abbr=a,aR[a]||(aR[a]=new ab),aR[a].set(b),aR[a]}function aY(a){return a?(!aR[a]&&aI&&require("./lang/"+a),aR[a]):aU.fn._lang}function a7(a){return a.match(/\[.*\]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function a2(a){var d=a.match(ac),b,c;for(b=0,c=d.length;b<c;b++){ad[d[b]]?d[b]=ad[d[b]]:d[b]=a7(d[b])}return function(e){var f="";for(b=0;b<c;b++){f+=typeof d[b].call=="function"?d[b].call(e,a):d[b]}return f}}function a4(a,d){function c(e){return a.lang().longDateFormat(e)||e}var b=5;while(b--&&an.test(d)){d=d.replace(an,c)}return ah[d]||(ah[d]=a2(d)),ah[d](a)}function a0(a){switch(a){case"DDDD":return aK;case"YYYY":return ai;case"YYYYY":return aZ;case"S":case"SS":case"SSS":case"DDD":return ar;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return aD;case"X":return ae;case"Z":case"ZZ":return ap;case"T":return a5;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return ag;default:return new RegExp(a.replace("\\",""))}}function aa(a,g,c){var d,b,f=c._a;switch(a){case"M":case"MM":f[1]=g==null?0:~~g-1;break;case"MMM":case"MMMM":d=aY(c._l).monthsParse(g),d!=null?f[1]=d:c._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":g!=null&&(f[2]=~~g);break;case"YY":f[0]=~~g+(~~g>68?1900:2000);break;case"YYYY":case"YYYYY":f[0]=~~g;break;case"a":case"A":c._isPm=(g+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":f[3]=~~g;break;case"m":case"mm":f[4]=~~g;break;case"s":case"ss":f[5]=~~g;break;case"S":case"SS":case"SSS":f[6]=~~(("0."+g)*1000);break;case"X":c._d=new Date(parseFloat(g)*1000);break;case"Z":case"ZZ":c._useUTC=!0,d=(g+"").match(a3),d&&d[1]&&(c._tzh=~~d[1]),d&&d[2]&&(c._tzm=~~d[2]),d&&d[0]==="+"&&(c._tzh=-c._tzh,c._tzm=-c._tzm)}g==null&&(c._isValid=!1)}function ay(a){var d,b,c=[];if(a._d){return}for(d=0;d<7;d++){a._a[d]=c[d]=a._a[d]==null?d===2?1:0:a._a[d]}c[3]+=a._tzh||0,c[4]+=a._tzm||0,b=new Date(0),a._useUTC?(b.setUTCFullYear(c[0],c[1],c[2]),b.setUTCHours(c[3],c[4],c[5],c[6])):(b.setFullYear(c[0],c[1],c[2]),b.setHours(c[3],c[4],c[5],c[6])),a._d=b}function aA(a){var f=a._f.match(ac),c=a._i,d,b;a._a=[];for(d=0;d<f.length;d++){b=(a0(f[d]).exec(c)||[])[0],b&&(c=c.slice(c.indexOf(b)+b.length)),ad[f[d]]&&aa(f[d],b,a)}a._isPm&&a._a[3]<12&&(a._a[3]+=12),a._isPm===!1&&a._a[3]===12&&(a._a[3]=0),ay(a)}function aN(a){var h,c,f,b=99,g,d,j;while(a._f.length){h=at({},a),h._f=a._f.pop(),aA(h),c=new aj(h);if(c.isValid()){f=c;break}j=aM(h._a,c.toArray()),j<b&&(b=j,f=c)}at(a,f)}function aq(a){var c,b=a._i;if(a1.exec(b)){a._f="YYYY-MM-DDT";for(c=0;c<4;c++){if(aS[c][1].exec(b)){a._f+=aS[c][0];break}}ap.exec(b)&&(a._f+=" Z"),aA(a)}else{a._d=new Date(b)}}function a6(c){var a=c._i,b=aX.exec(a);a===ak?c._d=new Date:b?c._d=new Date(+b[1]):typeof a=="string"?aq(c):av(a)?(c._a=a.slice(0),ay(c)):c._d=a instanceof Date?new Date(+a):new Date(a)}function a8(a,f,c,d,b){return b.relativeTime(f||1,!!c,a,d)}function am(c,l,h){var g=aO(Math.abs(c)/1000),k=aO(g/60),j=aO(k/60),m=aO(j/24),b=aO(m/365),d=g<45&&["s",g]||k===1&&["m"]||k<45&&["mm",k]||j===1&&["h"]||j<22&&["hh",j]||m===1&&["d"]||m<=25&&["dd",m]||m<=45&&["M"]||m<345&&["MM",aO(m/30)]||b===1&&["y"]||["yy",b];return d[2]=l,d[3]=c>0,d[4]=h,a8.apply({},d)}function aW(a,c,d){var b=d-c,f=d-a.day();return f>b&&(f-=7),f<b-7&&(f+=7),Math.ceil(aU(a).add("d",f).dayOfYear()/7)}function aH(a){var b=a._i,c=a._f;return b===null||b===""?null:(typeof b=="string"&&(a._i=b=aY().preparse(b)),aU.isMoment(b)?(a=at({},b),a._d=new Date(+b._d)):c?av(c)?aN(a):aA(a):a6(a),new aj(a))}function aQ(a,b){aU.fn[a]=aU.fn[a+"s"]=function(c){var d=this._isUTC?"UTC":"";return c!=null?(this._d["set"+d+b](c),this):this._d["get"+d+b]()}}function aw(a){aU.duration.fn[a]=function(){return this._data[a]}}function aT(a,b){aU.duration.fn["as"+a]=function(){return +this/b}}var aU,aF="2.0.0",aO=Math.round,au,aR={},aI=typeof module!="undefined"&&module.exports,aX=/^\/?Date\((\-?\d+)/i,ac=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,an=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,aB=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,ag=/\d\d?/,ar=/\d{1,3}/,aK=/\d{3}/,ai=/\d{1,4}/,aZ=/[+\-]?\d{1,6}/,aD=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,ap=/Z|[\+\-]\d\d:?\d\d/i,a5=/T/i,ae=/[\+\-]?\d+(\.\d{1,3})?/,a1=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,al="YYYY-MM-DDTHH:mm:ssZ",aS=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],a3=/([\+\-]|\d\d)/gi,aV="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),aG={Milliseconds:1,Seconds:1000,Minutes:60000,Hours:3600000,Days:86400000,Months:2592000000,Years:31536000000},ah={},az="DDD w W M D d".split(" "),aC="M D H h m s w W".split(" "),ad={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return ax(this.year()%100,2)},YYYY:function(){return ax(this.year(),4)},YYYYY:function(){return ax(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return ~~(this.milliseconds()/100)},SS:function(){return ax(~~(this.milliseconds()/10),2)},SSS:function(){return ax(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+ax(~~(a/60),2)+":"+ax(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+ax(~~(10*a/6),4)},X:function(){return this.unix()}};while(az.length){au=az.pop(),ad[au+"o"]=aE(ad[au])}while(aC.length){au=aC.pop(),ad[au+au]=aJ(ad[au],2)}ad.DDDD=aJ(ad.DDD,3),ab.prototype={set:function(a){var c,b;for(b in a){c=a[b],typeof c=="function"?this[b]=c:this["_"+b]=c}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var c,d,b,f;this._monthsParse||(this._monthsParse=[]);for(c=0;c<12;c++){this._monthsParse[c]||(d=aU([2000,c]),b="^"+this.months(d,"")+"|^"+this.monthsShort(d,""),this._monthsParse[c]=new RegExp(b.replace(".",""),"i"));if(this._monthsParse[c].test(a)){return c}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return !b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(c){return c.slice(1)}),this._longDateFormat[a]=b),b},meridiem:function(a,c,b){return a>11?b?"pm":"PM":b?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(a,c){var b=this._calendar[a];return typeof b=="function"?b.apply(c):b},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,f,c,d){var b=this._relativeTime[c];return typeof b=="function"?b(a,f,c,d):b.replace(/%d/i,a)},pastFuture:function(a,c){var b=this._relativeTime[a>0?"future":"past"];return typeof b=="function"?b(c):b.replace(/%s/i,c)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return aW(a,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},aU=function(a,c,b){return aH({_i:a,_f:c,_l:b,_isUTC:!1})},aU.utc=function(a,c,b){return aH({_useUTC:!0,_isUTC:!0,_l:b,_i:a,_f:c})},aU.unix=function(a){return aU(a*1000)},aU.duration=function(a,c){var f=aU.isDuration(a),b=typeof a=="number",g=f?a._data:b?{}:a,d;return b&&(c?g[c]=a:g.milliseconds=a),d=new aL(g),f&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},aU.version=aF,aU.defaultFormat=al,aU.lang=function(a,b){var c;if(!a){return aU.fn._lang._abbr}b?aP(a,b):aR[a]||aY(a),aU.duration.fn._lang=aU.fn._lang=aY(a)},aU.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),aY(a)},aU.isMoment=function(a){return a instanceof aj},aU.isDuration=function(a){return a instanceof aL},aU.fn=aj.prototype={clone:function(){return aU(this)},valueOf:function(){return +this._d},unix:function(){return Math.floor(+this._d/1000)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return aU.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return this._isValid==null&&(this._a?this._isValid=!aM(this._a,(this._isUTC?aU.utc(this._a):aU(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){var b=a4(this,a||aU.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return typeof a=="string"?c=aU.duration(+b,a):c=aU.duration(a,b),ao(this,c,1),this},subtract:function(a,b){var c;return typeof a=="string"?c=aU.duration(+b,a):c=aU.duration(a,b),ao(this,c,-1),this},diff:function(a,c,f){var b=this._isUTC?aU(a).utc():aU(a).local(),g=(this.zone()-b.zone())*60000,d,h;return c&&(c=c.replace(/s$/,"")),c==="year"||c==="month"?(d=(this.daysInMonth()+b.daysInMonth())*43200000,h=(this.year()-b.year())*12+(this.month()-b.month()),h+=(this-aU(this).startOf("month")-(b-aU(b).startOf("month")))/d,c==="year"&&(h/=12)):(d=this-b-g,h=c==="second"?d/1000:c==="minute"?d/60000:c==="hour"?d/3600000:c==="day"?d/86400000:c==="week"?d/604800000:d),f?h:af(h)},from:function(a,b){return aU.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(aU(),a)},calendar:function(){var a=this.diff(aU().startOf("day"),"days",!0),b=a<-6?"sameElse":a<-1?"lastWeek":a<0?"lastDay":a<1?"sameDay":a<2?"nextDay":a<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(b,this))},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<aU([this.year()]).zone()||this.zone()<aU([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){a=a.replace(/s$/,"");switch(a){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return a==="week"&&this.day(0),this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(a,b){return b=typeof b!="undefined"?b:"millisecond",+this.clone().startOf(b)>+aU(a).startOf(b)},isBefore:function(a,b){return b=typeof b!="undefined"?b:"millisecond",+this.clone().startOf(b)<+aU(a).startOf(b)},isSame:function(a,b){return b=typeof b!="undefined"?b:"millisecond",+this.clone().startOf(b)===+aU(a).startOf(b)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return aU.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(a){var b=aO((aU(this).startOf("day")-aU(this).startOf("year"))/86400000)+1;return a==null?b:this.add("d",a-b)},isoWeek:function(a){var b=aW(this,1,4);return a==null?b:this.add("d",(a-b)*7)},week:function(a){var b=this.lang().week(this);return a==null?b:this.add("d",(a-b)*7)},lang:function(a){return a===ak?this._lang:(this._lang=aY(a),this)}};for(au=0;au<aV.length;au++){aQ(aV[au].toLowerCase().replace(/s$/,""),aV[au])}aQ("year","FullYear"),aU.fn.days=aU.fn.day,aU.fn.weeks=aU.fn.week,aU.fn.isoWeeks=aU.fn.isoWeek,aU.duration.fn=aL.prototype={weeks:function(){return af(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*86400000+this._months*2592000000},humanize:function(a){var c=+this,b=am(c,!a,this.lang());return a&&(b=this.lang().pastFuture(c,b)),this.lang().postformat(b)},lang:aU.fn.lang};for(au in aG){aG.hasOwnProperty(au)&&(aT(au,aG[au]),aw(au.toLowerCase()))}aT("Weeks",604800000),aU.lang("en",{ordinal:function(a){var c=a%10,b=~~(a%100/10)===1?"th":c===1?"st":c===2?"nd":c===3?"rd":"th";return a+b}}),aI&&(module.exports=aU),typeof ender=="undefined"&&(this.moment=aU),typeof define=="function"&&define.amd&&define("moment",[],function(){return aU})}).call(this);(function(b){if(typeof define==="function"&&define.amd){define(["jquery","moment"],b)}else{b(jQuery,moment)}}(function(n,t){var k=1000,q=false,p=n([]),s=function(){r.resume()},o=function(a,c){var d=a.data("livestampdata");if(typeof c=="number"){c*=1000}a.removeAttr("data-livestamp").removeData("livestamp");c=t(c);if(t.isMoment(c)&&!isNaN(+c)){var b=n.extend({},{original:a.contents()},d);b.moment=t(c);a.data("livestampdata",b).empty();p.push(a[0])}},m=function(){if(q){return}r.update();setTimeout(m,k)},r={update:function(){n("[data-livestamp]").each(function(){var b=n(this);o(b,b.data("livestamp"))});var a=[];p.each(function(){var d=n(this),b=d.data("livestampdata");if(b===undefined){a.push(this)}else{if(t.isMoment(b.moment)){var f=d.html(),e=b.moment.fromNow();if(f!=e){var c=n.Event("change.livestamp");d.trigger(c,[f,e]);if(!c.isDefaultPrevented()){d.html(e)}}}}});p=p.not(a);delete p.prevObject},pause:function(){q=true},resume:function(){q=false;m()},interval:function(a){if(a===undefined){return k}k=a}},l={add:function(a,b){if(typeof b=="number"){b*=1000}b=t(b);if(t.isMoment(b)&&!isNaN(+b)){a.each(function(){o(n(this),b)});r.update()}return a},destroy:function(a){p=p.not(a);a.each(function(){var c=n(this),b=c.data("livestampdata");if(b===undefined){return a}c.html(b.original?b.original:"").removeData("livestampdata")});return a},isLivestamp:function(a){return a.data("livestampdata")!==undefined}};n.livestamp=r;n(s);n.fn.livestamp=function(b,a){if(!l[b]){a=b;b="add"}return l[b](this,a)}}));/*
 * jQuery Textarea AutoSize plugin
 */
(function(a,i,b,h){var e="autoResize";var d="plugin_"+e;var g=function(j,m,l){if(j.setSelectionRange){j.focus();j.setSelectionRange(m,l)}else{if(j.createTextRange){var k=j.createTextRange();k.collapse(true);k.moveEnd("character",l);k.moveStart("character",m);k.select()}}};var f=function(j,k){g(j,k,k)};function c(j,k){this.element=j;this.$element=a(j);this.init(k)}c.prototype={init:function(l){var k=this.$element.outerHeight();var m;var p=this.$element;function o(){a(p).height("auto");var q=a(p)[0].scrollHeight;if(l&&l.MaxHeight&&q>(a(i).height()*l.MaxHeight)){q=a(i).height()*l.MaxHeight}a(p).height(q+"px")}function n(){p.value="";o();i.setTimeout(o,function(){f(a(p)[0],0)},0)}function j(){i.setTimeout(o,0)}this.$element.on("change",o);this.$element.on("cut paste drop keydown",j);this.$element.on("reset",n);n()}};a.fn[e]=function(j){this.each(function(){if(!a.data(this,d)){a.data(this,d,new c(this,j))}});return this}})(jQuery,window,document);(function(a,e,d,b){var c;if(!e.Emoji){e.Emoji={}}d.defaults.emojiSheets={apple:b.virtualDirectory+"/assets/chat/emoji/sheets/sheet_apple_64.png"};d.defaults.include_title=true;d.defaults.include_text=true;e.Emoji=Emoji;e.Emoji.parse=function(f){return d.render(f)};e.Emoji.init=function(f,g){d.init(f);c=g.getLanguageResource};d.getTitle=function(f){switch(f){case"People":f=c("ChatEmojiPeopleGroup");break;case"Nature":f=c("ChatEmojiNatureGroup");break;case"Foods":f=c("ChatEmojiFoodsGroup");break;case"Activity":f=c("ChatEmojiActivityGroup");break;case"Places":f=c("ChatEmojiPlacesGroup");break;case"Objects":f=c("ChatEmojiObjectsGroup");break;case"Symbols":f=c("ChatEmojiSymbolsGroup");break;case"Flags":f=c("ChatEmojiFlagsGroup");break;default:break}return f}})(window.jQuery,window,window.wdtEmojiBundle,window.Communifire);/*
Chosen, a Select Box Enhancer for jQuery and Prototype
by Patrick Filler for Harvest, http://getharvest.com

Version 1.4.2
Full source at https://github.com/harvesthq/chosen
Copyright (c) 2011-2015 Harvest http://getharvest.com

MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md
This file is generated by `grunt build`, do not edit it by hand.
*/
(function(){var a,e,f,g,d,c={}.hasOwnProperty,b=function(h,k){for(var j in k){if(c.call(k,j)){h[j]=k[j]}}function i(){this.constructor=h}i.prototype=k.prototype;h.prototype=new i();h.__super__=k.prototype;return h};g=(function(){function h(){this.options_index=0;this.parsed=[]}h.prototype.add_node=function(i){if(i.nodeName.toUpperCase()==="OPTGROUP"){return this.add_group(i)}else{return this.add_option(i)}};h.prototype.add_group=function(m){var n,o,i,j,k,l;n=this.parsed.length;this.parsed.push({array_index:n,group:true,label:this.escapeExpression(m.label),title:m.title?m.title:void 0,children:0,disabled:m.disabled,classes:m.className});k=m.childNodes;l=[];for(i=0,j=k.length;i<j;i++){o=k[i];l.push(this.add_option(o,n,m.disabled))}return l};h.prototype.add_option=function(k,j,i){if(k.nodeName.toUpperCase()==="OPTION"){if(k.text!==""){if(j!=null){this.parsed[j].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:k.value,text:k.text,html:k.innerHTML,title:k.title?k.title:void 0,selected:k.selected,disabled:i===true?i:k.disabled,group_array_index:j,group_label:j!=null?this.parsed[j].label:null,classes:k.className,style:k.style.cssText})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};h.prototype.escapeExpression=function(j){var i,k;if((j==null)||j===false){return""}if(!/[\&\<\>\"\'\`]/.test(j)){return j}i={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};k=/&(?!\w+;)|[\<\>\"\'\`]/g;return j.replace(k,function(l){return i[l]||"&amp;"})};return h})();g.select_to_array=function(m){var k,l,h,i,j;l=new g();j=m.childNodes;for(h=0,i=j.length;h<i;h++){k=j[h];l.add_node(k)}return l.parsed};e=(function(){function h(i,j){this.form_field=i;this.options=j!=null?j:{};this.is_multiple=this.form_field.multiple;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers();this.on_ready()}h.prototype.set_default_values=function(){var i=this;this.click_test_action=function(j){return i.test_active_click(j)};this.activate_action=function(j){return i.activate_field(j)};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.allow_single_deselect=(this.options.allow_single_deselect!=null)&&(this.form_field.options[0]!=null)&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.disable_search=this.options.disable_search||false;this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:true;this.group_search=this.options.group_search!=null?this.options.group_search:true;this.search_contains=this.options.search_contains||false;this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:true;this.max_selected_options=this.options.max_selected_options||Infinity;this.inherit_select_classes=this.options.inherit_select_classes||false;this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:true;this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:true;return this.include_group_label_in_selected=this.options.include_group_label_in_selected||false};h.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder")){this.default_text=this.form_field.getAttribute("data-placeholder")}else{if(this.is_multiple){this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||h.default_multiple_text}else{this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||h.default_single_text}}return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||h.default_no_result_text};h.prototype.choice_label=function(i){if(this.include_group_label_in_selected&&(i.group_label!=null)){return"<b class='group-name'>"+i.group_label+"</b>"+i.html}else{return i.html}};h.prototype.mouse_enter=function(){return this.mouse_on_container=true};h.prototype.mouse_leave=function(){return this.mouse_on_container=false};h.prototype.input_focus=function(j){var i=this;if(this.is_multiple){if(!this.active_field){return setTimeout((function(){return i.container_mousedown()}),50)}}else{if(!this.active_field){return this.activate_field()}}};h.prototype.input_blur=function(j){var i=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout((function(){return i.blur_test()}),100)}};h.prototype.results_option_build=function(n){var l,m,i,j,k;l="";k=this.results_data;for(i=0,j=k.length;i<j;i++){m=k[i];if(m.group){l+=this.result_add_group(m)}else{l+=this.result_add_option(m)}if(n!=null?n.first:void 0){if(m.selected&&this.is_multiple){this.choice_build(m)}else{if(m.selected&&!this.is_multiple){this.single_set_selected_text(this.choice_label(m))}}}}return l};h.prototype.result_add_option=function(j){var i,k;if(!j.search_match){return""}if(!this.include_option_in_results(j)){return""}i=[];if(!j.disabled&&!(j.selected&&this.is_multiple)){i.push("active-result")}if(j.disabled&&!(j.selected&&this.is_multiple)){i.push("disabled-result")}if(j.selected){i.push("result-selected")}if(j.group_array_index!=null){i.push("group-option")}if(j.classes!==""){i.push(j.classes)}k=document.createElement("li");k.className=i.join(" ");k.style.cssText=j.style;k.setAttribute("data-option-array-index",j.array_index);k.innerHTML=j.search_text;if(j.title){k.title=j.title}return this.outerHTML(k)};h.prototype.result_add_group=function(j){var i,k;if(!(j.search_match||j.group_match)){return""}if(!(j.active_options>0)){return""}i=[];i.push("group-result");if(j.classes){i.push(j.classes)}k=document.createElement("li");k.className=i.join(" ");k.innerHTML=j.search_text;if(j.title){k.title=j.title}return this.outerHTML(k)};h.prototype.results_update_field=function(){this.set_default_text();if(!this.is_multiple){this.results_reset_cleanup()}this.result_clear_highlight();this.results_build();if(this.results_showing){return this.winnow_results()}};h.prototype.reset_single_select_options=function(){var m,i,j,k,l;k=this.results_data;l=[];for(i=0,j=k.length;i<j;i++){m=k[i];if(m.selected){l.push(m.selected=false)}else{l.push(void 0)}}return l};h.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};h.prototype.results_search=function(i){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};h.prototype.winnow_results=function(){var l,m,n,o,p,q,r,s,t,i,j,k;this.no_results_clear();o=0;q=this.get_search_text();l=q.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");t=new RegExp(l,"i");n=this.get_search_regex(l);k=this.results_data;for(i=0,j=k.length;i<j;i++){m=k[i];m.search_match=false;p=null;if(this.include_option_in_results(m)){if(m.group){m.group_match=false;m.active_options=0}if((m.group_array_index!=null)&&this.results_data[m.group_array_index]){p=this.results_data[m.group_array_index];if(p.active_options===0&&p.search_match){o+=1}p.active_options+=1}m.search_text=m.group?m.label:m.html;if(!(m.group&&!this.group_search)){m.search_match=this.search_string_match(m.search_text,n);if(m.search_match&&!m.group){o+=1}if(m.search_match){if(q.length){r=m.search_text.search(t);s=m.search_text.substr(0,r+q.length)+"</em>"+m.search_text.substr(r+q.length);m.search_text=s.substr(0,r)+"<em>"+s.substr(r)}if(p!=null){p.group_match=true}}else{if((m.group_array_index!=null)&&this.results_data[m.group_array_index].search_match){m.search_match=true}}}}}this.result_clear_highlight();if(o<1&&q.length){this.update_results_content("");return this.no_results(q)}else{this.update_results_content(this.results_option_build());return this.winnow_results_set_highlight()}};h.prototype.get_search_regex=function(i){var j;j=this.search_contains?"":"^";return new RegExp(j+i,"i")};h.prototype.search_string_match=function(n,m){var k,l,i,j;if(m.test(n)){return true}else{if(this.enable_split_word_search&&(n.indexOf(" ")>=0||n.indexOf("[")===0)){l=n.replace(/\[|\]/g,"").split(" ");if(l.length){for(i=0,j=l.length;i<j;i++){k=l[i];if(m.test(k)){return true}}}}}};h.prototype.choices_count=function(){var l,i,j,k;if(this.selected_option_count!=null){return this.selected_option_count}this.selected_option_count=0;k=this.form_field.options;for(i=0,j=k.length;i<j;i++){l=k[i];if(l.selected){this.selected_option_count+=1}}return this.selected_option_count};h.prototype.choices_click=function(i){i.preventDefault();if(!(this.results_showing||this.is_disabled)){return this.results_show()}};h.prototype.keyup_checker=function(j){var k,i;k=(i=j.which)!=null?i:j.keyCode;this.search_field_scale();switch(k){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0){return this.keydown_backstroke()}else{if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}}break;case 13:j.preventDefault();if(this.results_showing){return this.result_select(j)}break;case 27:if(this.results_showing){this.results_hide()}return true;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};h.prototype.clipboard_event_checker=function(j){var i=this;return setTimeout((function(){return i.results_search()}),50)};h.prototype.container_width=function(){if(this.options.width!=null){return this.options.width}else{return""+this.form_field.offsetWidth+"px"}};h.prototype.include_option_in_results=function(i){if(this.is_multiple&&(!this.display_selected_options&&i.selected)){return false}if(!this.display_disabled_options&&i.disabled){return false}if(i.empty){return false}return true};h.prototype.search_results_touchstart=function(i){this.touch_started=true;return this.search_results_mouseover(i)};h.prototype.search_results_touchmove=function(i){this.touch_started=false;return this.search_results_mouseout(i)};h.prototype.search_results_touchend=function(i){if(this.touch_started){return this.search_results_mouseup(i)}};h.prototype.outerHTML=function(i){var j;if(i.outerHTML){return i.outerHTML}j=document.createElement("div");j.appendChild(i);return j.innerHTML};h.browser_is_supported=function(){if(window.navigator.appName==="Microsoft Internet Explorer"){return document.documentMode>=8}if(/iP(od|hone)/i.test(window.navigator.userAgent)){return false}if(/Android/i.test(window.navigator.userAgent)){if(/Mobile/i.test(window.navigator.userAgent)){return false}}return true};h.default_multiple_text="Select Some Options";h.default_single_text="Select an Option";h.default_no_result_text="No results match";return h})();a=jQuery;a.fn.extend({chosen:function(h){return this.each(function(k){var i,j;i=a(this);j=i.data("chosen");if(h==="destroy"&&j instanceof f){j.destroy()}else{if(!(j instanceof f)){i.data("chosen",new f(this,h))}}})}});f=(function(h){b(i,h);function i(){d=i.__super__.constructor.apply(this,arguments);return d}i.prototype.setup=function(){this.form_field_jq=a(this.form_field);this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")};i.prototype.set_up_html=function(){var j,k;j=["chosen-container"];j.push("chosen-container-"+(this.is_multiple?"multi":"single"));if(this.inherit_select_classes&&this.form_field.className){j.push(this.form_field.className)}if(this.is_rtl){j.push("chosen-rtl")}k={"class":j.join(" "),style:"width: "+(this.container_width())+";",title:this.form_field.title};if(this.form_field.id.length){k.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"}this.container=a("<div />",k);if(this.is_multiple){this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>')}else{this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>')}this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find("div.chosen-drop").first();this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chosen-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chosen-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chosen-search").first();this.selected_item=this.container.find(".chosen-single").first()}this.results_build();this.set_tab_index();return this.set_label_behavior()};i.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this})};i.prototype.register_observers=function(){var j=this;this.container.bind("touchstart.chosen",function(k){j.container_mousedown(k);return k.preventDefault()});this.container.bind("touchend.chosen",function(k){j.container_mouseup(k);return k.preventDefault()});this.container.bind("mousedown.chosen",function(k){j.container_mousedown(k)});this.container.bind("mouseup.chosen",function(k){j.container_mouseup(k)});this.container.bind("mouseenter.chosen",function(k){j.mouse_enter(k)});this.container.bind("mouseleave.chosen",function(k){j.mouse_leave(k)});this.search_results.bind("mouseup.chosen",function(k){j.search_results_mouseup(k)});this.search_results.bind("mouseover.chosen",function(k){j.search_results_mouseover(k)});this.search_results.bind("mouseout.chosen",function(k){j.search_results_mouseout(k)});this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(k){j.search_results_mousewheel(k)});this.search_results.bind("touchstart.chosen",function(k){j.search_results_touchstart(k)});this.search_results.bind("touchmove.chosen",function(k){j.search_results_touchmove(k)});this.search_results.bind("touchend.chosen",function(k){j.search_results_touchend(k)});this.form_field_jq.bind("chosen:updated.chosen",function(k){j.results_update_field(k)});this.form_field_jq.bind("chosen:activate.chosen",function(k){j.activate_field(k)});this.form_field_jq.bind("chosen:open.chosen",function(k){j.container_mousedown(k)});this.form_field_jq.bind("chosen:close.chosen",function(k){j.input_blur(k)});this.search_field.bind("blur.chosen",function(k){j.input_blur(k)});this.search_field.bind("keyup.chosen",function(k){j.keyup_checker(k)});this.search_field.bind("keydown.chosen",function(k){j.keydown_checker(k)});this.search_field.bind("focus.chosen",function(k){j.input_focus(k)});this.search_field.bind("cut.chosen",function(k){j.clipboard_event_checker(k)});this.search_field.bind("paste.chosen",function(k){j.clipboard_event_checker(k)});if(this.is_multiple){return this.search_choices.bind("click.chosen",function(k){j.choices_click(k)})}else{return this.container.bind("click.chosen",function(k){k.preventDefault()})}};i.prototype.destroy=function(){a(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);if(this.search_field[0].tabIndex){this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex}this.container.remove();this.form_field_jq.removeData("chosen");return this.form_field_jq.show()};i.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled){this.container.addClass("chosen-disabled");this.search_field[0].disabled=true;if(!this.is_multiple){this.selected_item.unbind("focus.chosen",this.activate_action)}return this.close_field()}else{this.container.removeClass("chosen-disabled");this.search_field[0].disabled=false;if(!this.is_multiple){return this.selected_item.bind("focus.chosen",this.activate_action)}}};i.prototype.container_mousedown=function(j){if(!this.is_disabled){if(j&&j.type==="mousedown"&&!this.results_showing){j.preventDefault()}if(!((j!=null)&&(a(j.target)).hasClass("search-choice-close"))){if(!this.active_field){if(this.is_multiple){this.search_field.val("")}a(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action);this.results_show()}else{if(!this.is_multiple&&j&&((a(j.target)[0]===this.selected_item[0])||a(j.target).parents("a.chosen-single").length)){j.preventDefault();this.results_toggle()}}return this.activate_field()}}};i.prototype.container_mouseup=function(j){if(j.target.nodeName==="ABBR"&&!this.is_disabled){return this.results_reset(j)}};i.prototype.search_results_mousewheel=function(k){var j;if(k.originalEvent){j=k.originalEvent.deltaY||-k.originalEvent.wheelDelta||k.originalEvent.detail}if(j!=null){k.preventDefault();if(k.type==="DOMMouseScroll"){j=j*40}return this.search_results.scrollTop(j+this.search_results.scrollTop())}};i.prototype.blur_test=function(j){if(!this.active_field&&this.container.hasClass("chosen-container-active")){return this.close_field()}};i.prototype.close_field=function(){a(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);this.active_field=false;this.results_hide();this.container.removeClass("chosen-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};i.prototype.activate_field=function(){this.container.addClass("chosen-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};i.prototype.test_active_click=function(k){var j;j=a(k.target).closest(".chosen-container");if(j.length&&this.container[0]===j[0]){return this.active_field=true}else{return this.close_field()}};i.prototype.results_build=function(){this.parsing=true;this.selected_option_count=null;this.results_data=g.select_to_array(this.form_field);if(this.is_multiple){this.search_choices.find("li.search-choice").remove()}else{if(!this.is_multiple){this.single_set_selected_text();if(this.disable_search||this.form_field.options.length<=this.disable_search_threshold){this.search_field[0].readOnly=true;this.container.addClass("chosen-container-single-nosearch")}else{this.search_field[0].readOnly=false;this.container.removeClass("chosen-container-single-nosearch")}}}this.update_results_content(this.results_option_build({first:true}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=false};i.prototype.result_do_highlight=function(j){var k,l,m,n,o;if(j.length){this.result_clear_highlight();this.result_highlight=j;this.result_highlight.addClass("highlighted");m=parseInt(this.search_results.css("maxHeight"),10);o=this.search_results.scrollTop();n=m+o;l=this.result_highlight.position().top+this.search_results.scrollTop();k=l+this.result_highlight.outerHeight();if(k>=n){return this.search_results.scrollTop((k-m)>0?k-m:0)}else{if(l<o){return this.search_results.scrollTop(l)}}}};i.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};i.prototype.results_show=function(){if(this.form_field.options.length<1&&(typeof this.search_field.val()==="undefined"||this.search_field.val()==="")){return false}if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}this.container.addClass("chosen-with-drop");this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());this.winnow_results();return this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this})};i.prototype.update_results_content=function(j){return this.search_results.html(j)};i.prototype.results_hide=function(){if(this.results_showing){this.result_clear_highlight();this.container.removeClass("chosen-with-drop");this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})}return this.results_showing=false};i.prototype.set_tab_index=function(j){var k;if(this.form_field.tabIndex){k=this.form_field.tabIndex;this.form_field.tabIndex=-1;return this.search_field[0].tabIndex=k}};i.prototype.set_label_behavior=function(){var j=this;this.form_field_label=this.form_field_jq.parents("label");if(!this.form_field_label.length&&this.form_field.id.length){this.form_field_label=a("label[for='"+this.form_field.id+"']")}if(this.form_field_label.length>0){return this.form_field_label.bind("click.chosen",function(k){if(j.is_multiple){return j.container_mousedown(k)}else{return j.activate_field()}})}};i.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices_count()<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};i.prototype.search_results_mouseup=function(j){var k;k=a(j.target).hasClass("active-result")?a(j.target):a(j.target).parents(".active-result").first();if(k.length){this.result_highlight=k;this.result_select(j);return this.search_field.focus()}};i.prototype.search_results_mouseover=function(j){var k;k=a(j.target).hasClass("active-result")?a(j.target):a(j.target).parents(".active-result").first();if(k){return this.result_do_highlight(k)}};i.prototype.search_results_mouseout=function(j){if(a(j.target).hasClass("active-result"||a(j.target).parents(".active-result").first())){return this.result_clear_highlight()}};i.prototype.choice_build=function(m){var k,l,j=this;k=a("<li />",{"class":"search-choice"}).html("<span>"+(this.choice_label(m))+"</span>");if(m.disabled){k.addClass("search-choice-disabled")}else{l=a("<a />",{"class":"search-choice-close","data-option-array-index":m.array_index});l.bind("click.chosen",function(n){return j.choice_destroy_link_click(n)});k.append(l)}return this.search_container.before(k)};i.prototype.choice_destroy_link_click=function(j){j.preventDefault();j.stopPropagation();if(!this.is_disabled){return this.choice_destroy(a(j.target))}};i.prototype.choice_destroy=function(j){if(this.result_deselect(j[0].getAttribute("data-option-array-index"))){this.show_search_field_default();if(this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1){this.results_hide()}j.parents("li").first().remove();return this.search_field_scale()}};i.prototype.results_reset=function(){this.reset_single_select_options();this.form_field.options[0].selected=true;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide()}};i.prototype.results_reset_cleanup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.selected_item.find("abbr").remove()};i.prototype.result_select=function(j){var k,l;if(this.result_highlight){k=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}if(this.is_multiple){k.removeClass("active-result")}else{this.reset_single_select_options()}k.addClass("result-selected");l=this.results_data[k[0].getAttribute("data-option-array-index")];l.selected=true;this.form_field.options[l.options_index].selected=true;this.selected_option_count=null;if(this.is_multiple){this.choice_build(l)}else{this.single_set_selected_text(this.choice_label(l))}if(!((j.metaKey||j.ctrlKey)&&this.is_multiple)){this.results_hide()}this.search_field.val("");if(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex){this.form_field_jq.trigger("change",{selected:this.form_field.options[l.options_index].value})}this.current_selectedIndex=this.form_field.selectedIndex;j.preventDefault();return this.search_field_scale()}};i.prototype.single_set_selected_text=function(j){if(j==null){j=this.default_text}if(j===this.default_text){this.selected_item.addClass("chosen-default")}else{this.single_deselect_control_build();this.selected_item.removeClass("chosen-default")}return this.selected_item.find("span").html(j)};i.prototype.result_deselect=function(j){var k;k=this.results_data[j];if(!this.form_field.options[k.options_index].disabled){k.selected=false;this.form_field.options[k.options_index].selected=false;this.selected_option_count=null;this.result_clear_highlight();if(this.results_showing){this.winnow_results()}this.form_field_jq.trigger("change",{deselected:this.form_field.options[k.options_index].value});this.search_field_scale();return true}else{return false}};i.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect){return}if(!this.selected_item.find("abbr").length){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}return this.selected_item.addClass("chosen-single-with-deselect")};i.prototype.get_search_text=function(){return a("<div/>").text(a.trim(this.search_field.val())).html()};i.prototype.winnow_results_set_highlight=function(){var j,k;k=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];j=k.length?k.first():this.search_results.find(".active-result").first();if(j!=null){return this.result_do_highlight(j)}};i.prototype.no_results=function(k){var j;j=a('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');j.find("span").first().html(k);this.search_results.append(j);return this.form_field_jq.trigger("chosen:no_results",{chosen:this})};i.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};i.prototype.keydown_arrow=function(){var j;if(this.results_showing&&this.result_highlight){j=this.result_highlight.nextAll("li.active-result").first();if(j){return this.result_do_highlight(j)}}else{return this.results_show()}};i.prototype.keyup_arrow=function(){var j;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else{if(this.result_highlight){j=this.result_highlight.prevAll("li.active-result");if(j.length){return this.result_do_highlight(j.first())}else{if(this.choices_count()>0){this.results_hide()}return this.result_clear_highlight()}}}};i.prototype.keydown_backstroke=function(){var j;if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{j=this.search_container.siblings("li.search-choice").last();if(j.length&&!j.hasClass("search-choice-disabled")){this.pending_backstroke=j;if(this.single_backstroke_delete){return this.keydown_backstroke()}else{return this.pending_backstroke.addClass("search-choice-focus")}}}};i.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};i.prototype.keydown_checker=function(k){var l,j;l=(j=k.which)!=null?j:k.keyCode;this.search_field_scale();if(l!==8&&this.pending_backstroke){this.clear_backstroke()}switch(l){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:if(this.results_showing&&!this.is_multiple){this.result_select(k)}this.mouse_on_container=false;break;case 13:if(this.results_showing){k.preventDefault()}break;case 32:if(this.disable_search){k.preventDefault()}break;case 38:k.preventDefault();this.keyup_arrow();break;case 40:k.preventDefault();this.keydown_arrow();break}};i.prototype.search_field_scale=function(){var l,m,n,o,p,q,r,j,k;if(this.is_multiple){n=0;r=0;p="position:absolute; left: -1000px; top: -1000px; display:none;";q=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(j=0,k=q.length;j<k;j++){o=q[j];p+=o+":"+this.search_field.css(o)+";"}l=a("<div />",{style:p});l.text(this.search_field.val());a("body").append(l);r=l.width()+25;l.remove();m=this.container.outerWidth();if(r>m-10){r=m-10}return this.search_field.css({width:r+"px"})}};return i})(e)}).call(this);(function(a){return a.fn.ajaxChosen=function(h,b,c){var d,e,f,g;if(h==null){h={}}if(c==null){c={}}e={minTermLength:3,afterTypeDelay:500,jsonTermKey:"term",keepTypingMsg:"Keep typing...",lookingForMsg:"Looking for"};g=this;d=null;f=a.extend({},e,a(g).data(),h);this.chosen(c?c:{});return this.each(function(){return a(this).next(".chosen-container").find(".search-field > input, .chosen-search > input").bind("keyup",function(){var i,j,k,l,m;l=a(this).val();m=a.trim(a(this).val());j=m.length<f.minTermLength?f.keepTypingMsg:f.lookingForMsg+(" '"+m+"'");g.next(".chosen-container").find(".no-results").text(j);if(m===a(this).data("prevVal")){return false}a(this).data("prevVal",m);if(this.timer){clearTimeout(this.timer)}if(m.length<f.minTermLength){return false}i=a(this);if(f.data==null){f.data={}}f.data[f.jsonTermKey]=m;if(f.dataCallback!=null){f.data=f.dataCallback(f.data)}k=f.success;f.success=function(n){var o,p,q;if(n==null){return}q=[];g.find("option").each(function(){if(!a(this).is(":selected")){return a(this).remove()}else{return q.push(a(this).val()+"-"+a(this).text())}});g.find("optgroup:empty").each(function(){return a(this).remove()});o=b!=null?b(n,i):n;p=0;a.each(o,function(t,r){var s,u,v;p++;if(r.group){s=g.find("optgroup[label='"+r.text+"']");if(!s.size()){s=a("<optgroup />")}s.attr("label",r.text).appendTo(g);return a.each(r.items,function(x,w){var y,z;if(typeof w==="string"){z=x;y=w}else{z=w.value;y=w.text}if(a.inArray(z+"-"+y,q)===-1){return a("<option />").attr("value",z).html(y).appendTo(s)}})}else{if(typeof r==="string"){v=t;u=r}else{v=r.value;u=r.text}if(a.inArray(v+"-"+u,q)===-1){return a("<option />").attr("value",v).html(u).appendTo(g)}}});if(p){g.trigger("chosen:updated")}else{g.data().chosen.no_results_clear();g.data().chosen.no_results(i.val())}if(h.success!=null){h.success(n)}return i.val(l)};return this.timer=setTimeout(function(){if(d){d.abort()}return d=a.ajax(f)},f.afterTypeDelay)})})}})(jQuery);(function(a,C,f,q,l,o,r,n,b){var d=b,c=d.Utilities;var p={highlight:function(D){return l.highlightAuto(D).value},tables:false,breaks:true,sanitize:true,gfm:true};function w(D){return c.htmlEncode(D)}var s=navigator.userAgent||navigator.vendor||C.opera;var m=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(s)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(s.substr(0,4));function t(D){D=D.toString();if(D.length===1){return"0"+D}return D}function k(){var D=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(D()+D()+"-"+D()+"-"+D()+"-"+D()+"-"+D()+D()+D())}a.fn.isNearTheEnd=function(){if(typeof this[0]==="undefined"){return false}return this[0].scrollTop+this.height()>=this[0].scrollHeight-10};a.fn.expandableContent=function(){var D=["img:not(.gravatar),.file-container i.fa"];return this.find(D.join(","))};function e(D){return a("<div/>").html(D).text()}function g(D){return a("<div/>").text(D).html().replace(/\"/g,"&quot;")}function h(E){if(!E){return}var D=arguments;return E.replace(/{(?:[0-9]+)}/g,function(F){return D[parseInt(F.substr(1,F.length-2),10)+1]})}function i(E){var D=Array.prototype.slice.call(arguments,0);D[0]=n[E];return D[0]}function z(H,F,D,G,E){F=F===null?[]:a.makeArray(F);D=D===null?[]:a.makeArray(D);G=G===null?[]:a.makeArray(G);E=E===null?[]:a.makeArray(E);return a.map(H,function(I){var J=[];if(F.indexOf(I)>-1){J.push(B.getLanguageResource("Client_OnlineTag"))}if(D.indexOf(I)>-1){J.push(B.getLanguageResource("Client_AdminTag"))}if(G.indexOf(I)>-1){J.push(B.getLanguageResource("Client_OwnerTag"))}if(E.indexOf(I)>-1){J.push(B.getLanguageResource("Client_CreatorTag"))}return I+(J.length>0?" ("+J.join(", ")+")":"")})}String.prototype.fromJsonDate=function(){return new Date(r(this.toString()).valueOf())};Date.prototype.formatDate=function(){var E=this.getMonth()+1,D=this.getDate(),F=this.getFullYear();return E+"/"+D+"/"+F};Date.prototype.formatTime=function(G){var D,E=this.getHours();if(E<12){D="AM"}else{D="PM"}if(E===0){E=12}if(E>12){E=E-12}var F=t(this.getMinutes());return E+":"+F+(G?" "+D:"")};Date.prototype.toDate=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())};Date.prototype.diffDays=function(D){var E=this.getTime(),F=D.getTime();return parseInt((E-F)/(24*3600*1000),10)};Date.prototype.addDays=function(D){return new Date(this.getTime()+1000*3600*24*D)};function A(D){D=D.replace(/\n/g,"<br />");return D}function v(D){D=D.replace(/<br ?\/?>/g,"\n");var E=a("<div/>").html(D);D=E.text();return D}function u(D,G,F){D=D||"";var E=false;if(E){return a("<div />").append(G.multiline.tmpl({content:D})).html()}else{D=B.parseEmojis(D);D=A(D);if(F){D=D.replace(/#([A-Za-z0-9-_]{1,30}\w*)/g,function(H){var I=H.substr(1);if(F[I.toUpperCase()]){return'<a href="#/rooms/'+I+'" title="'+I+'">'+H+"</a>"}return H})}D=o(D,{callback:function(I,H){return H?'<a rel="nofollow external" target="_blank" href="'+H+'" title="'+H+'">'+I+"</a>":I}});return D}}function j(F){var D,E="ChatStatusOffline";switch(F){case"status-online":D="ChatStatusOnline";break;case"status-offline":case"status-invisible":D=E;break;case"status-away":D="ChatStatusAway";break;case"status-disturb":D="ChatStatusDND";break;default:D=E;break}return B.getLanguageResource(D)}var y=function(D,G,F){if(D.setSelectionRange){D.focus();D.setSelectionRange(G,F)}else{if(D.createTextRange){var E=D.createTextRange();E.collapse(true);E.moveEnd(keys.character,F);E.moveStart(keys.character,G);E.select()}}};var x=function(D,E){y(D,E,E)};var B={trim:function(E,D){if(E.length>D){return E.substr(0,D-3)+"..."}return E},randomUniqueId:function(E){var D=Math.floor(Math.random()*100);while(a("#"+E+D.toString()).length>0){D=Math.Floor(Math.random()*100)}return E+D},markdownToHtml:function(D){var E=q.parse;return(E(D,p))},isMobile:m,parseEmojis:function(D){return(f.parse(D))},transformEmojis:function(D){return D},decodeHtml:e,encodeHtml:g,newId:k,processContent:u,format:h,getLanguageResource:i,tagUsers:z,getPresenceText:j,processContentForInput:v,getAttachmentViewModel:function(E){var D={ThumbUrl:E.FileThumbURL,Url:E.FileURL,Name:E.Caption,Extension:E.FileExtension,IsImage:E.IsImage,Size:E.FileSizeText,ExtensionClass:E.FileTypeIconCSSClass};return D},getUserViewModel:function(E,D){return{id:E.UserID,name:E.Name,hash:E.Hash,owner:D,active:E.Active,flag:E.Flag,country:E.Country,lastActive:(E.LastActivityDate)?E.LastActivityDate.fromJsonDate():"",admin:E.IsAdmin,afk:E.IsAfk,presenceClass:E.Presence,presenceText:B.getPresenceText(E.Presence),avatar:E.AvatarImageURL,skype:E.SkypeIM,onlineChatStatus:E.OnlineChatStatus}},getRoomViewModel:function(L){var J=L.Name,N=L.UserID,K=L.RoomType,H=L.RoomDisplayName,G=L.Presence,I=L.RoomImageUrl,M=L.UnreadMessageCount,D=L.Count,E=L.IsFavorite,Q=L.When,F=L.IsOwner,O=L.Users,P={id:J,name:J,userID:N,roomType:K,roomDisplayName:H,presenceClass:G,presenceText:B.getPresenceText(G),roomImageUrl:I,unreadMessageCount:M,count:D,isFavorite:E,when:Q,isOwner:F,users:O};return P},isElectronPresent:c.isElectronPresent,appendQueryString:c.appendQueryString,isChrome:/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),setCaretToPos:x};if(!C.chat){C.chat={}}C.chat.utility=B})(window.jQuery,window,window.Emoji,window.marked,window.hljs,window.linkify,window.moment,Communifire.languageResources,window.Communifire);(function(a,f,b){var e=200;function c(g){return'[data-name="'+g+'"]'}function d(i,k,l,j,g,h){this.tab=i;this.users=k;this.owners=l;this.activeUsers=j;this.messages=g;this.roomTopic=h;this.templates={separator:a("#message-separator-template")}}d.prototype.hasNewMessages=function(){return this.tab.data("new-messages")};d.prototype.removeNewMessagesStatus=function(){return this.tab.removeData("new-messages")};d.prototype.setNewMessagesStatus=function(){return this.tab.data("new-messages",true)};d.prototype.setTab=function(g){return this.tab=g};d.prototype.isLocked=function(){return this.tab.hasClass("locked")};d.prototype.isHistory=function(){return this.tab.hasClass("history")};d.prototype.isLobby=function(){return this.tab.hasClass("lobby")};d.prototype.hasUnread=function(){return this.tab.hasClass("unread")};d.prototype.hasMessages=function(){return this.tab.data("messages")};d.prototype.updateMessages=function(g){this.tab.data("messages",g)};d.prototype.getUnread=function(){return this.tab.data("unread")||0};d.prototype.hasSeparator=function(){return this.messages.find(".message-separator").length>0};d.prototype.needsSeparator=function(){if(this.isActive()){return false}return this.isInitialized()&&this.getUnread()===5};d.prototype.addSeparator=function(){if(this.isLobby()){return}var h=this.getUnread(),g=this.messages.find(".message").eq(-(h+1));g.after(this.templates.separator.tmpl()).data("unread",h);this.scrollToBottom()};d.prototype.removeSeparator=function(){this.messages.find(".message-separator").fadeOut(2000,function(){a(this).remove()})};d.prototype.updateUnread=function(j){var h=this.tab.addClass("unread"),g=h.find(".message-count"),k=(parseInt(g.text(),0)||0)+1,i=h.data("hasMentions")||j;g.text(k);h.data("unread",k);h.data("hasMentions",i)};d.prototype.scrollToBottom=function(){if(a.browser.webkit){this.messages.scrollTop(this.messages.scrollTop()-1)}this.messages.scrollTop(this.messages[0].scrollHeight)};d.prototype.isNearTheEnd=function(){return this.messages.isNearTheEnd()};d.prototype.getName=function(){return this.tab.data("name")};d.prototype.isActive=function(){return this.tab.hasClass("current")};d.prototype.exists=function(){return this.tab.length>0};d.prototype.isLoaded=function(){return this.tab.attr("data-loaded")==="true"};d.prototype.markLoaded=function(){this.tab.attr("data-loaded",true)};d.prototype.isClosed=function(){return this.tab.attr("data-closed")==="true"};d.prototype.close=function(){this.tab.attr("data-closed",true);this.tab.addClass("closed");this.tab.find(".readonly").removeClass("hide")};d.prototype.unClose=function(){this.tab.attr("data-closed",false);this.tab.removeClass("closed");this.tab.find(".readonly").addClass("hide")};d.prototype.clear=function(){this.messages.empty();this.owners.empty();this.activeUsers.empty()};d.prototype.makeInactive=function(){this.tab.removeClass("current");this.tab.find("a").removeClass("active");this.messages.removeClass("current").hide();this.users.removeClass("current").hide();this.roomTopic.removeClass("current").hide()};d.prototype.isUnread=function(){return this.tab.hasClass("unread")};d.prototype.makeActive=function(){var i=this.getUnread(),j=this.messages.find(".message-separator").data("unread")||0;var h=this.tab,g=h.find(".message-count");g.text(0);this.tab.addClass("current").removeClass("unread").data("unread",0).data("hasMentions",false);this.tab.find("a").addClass("active");if(this.tab.is(".room")){this.tab.find(".content").text(this.getName())}this.messages.addClass("current").show();this.users.addClass("current").show();this.roomTopic.addClass("current").show();if(i<=j){this.removeSeparator()}};d.prototype.setInitialized=function(){this.tab.data("initialized",true)};d.prototype.isInitialized=function(){return this.tab.data("initialized")===true};d.prototype.getUser=function(g){return this.users.find(c(g))};d.prototype.getUserReferences=function(g){return a.merge(this.getUser(g),this.messages.find(c(g)))};d.prototype.setLocked=function(){this.tab.addClass("locked");this.tab.find(".lock").removeClass("hide")};d.prototype.setListState=function(h){var g=h.children("li.empty"),i=h.children("li:not(.empty)").filter(function(){return a(this).css("display")!=="none"});if(i.length>0){g.remove()}else{if(g.length===0){h.append(a('<li class="empty" />').text(h.data("emptyMessage")))}}};d.prototype.addUser=function(h,g){if(h.owner){this.addUserToList(g,this.owners)}else{this.changeInactive(g,h.active);this.addUserToList(g,this.activeUsers)}};d.prototype.clearUserList=function(h,g){this.activeUsers.empty()};d.prototype.changeInactive=function(g,h){if(h){g.removeClass("inactive")}else{g.addClass("inactive")}};d.prototype.addUserToList=function(g,h){var i=g.parent("ul");g.appendTo(h);this.setListState(h);if(i.length>0){this.setListState(i)}this.sortList(h,g)};d.prototype.appearsInList=function(g,h){return g.parent("ul").attr("id")===h.attr("id")};d.prototype.updateUserStatus=function(g){var h=g.data("owner")||false;if(h===true){if(!this.appearsInList(g,this.owners)){this.addUserToList(g,this.owners)}return}var i=g.data("active");if(typeof i==="undefined"){return}if(!this.appearsInList(g,this.activeUsers)){this.changeInactive(g,i);this.addUserToList(g,this.activeUsers)}};d.prototype.sortLists=function(h){var g=a(h).data("owner");if(g){this.sortList(this.owners,h)}else{this.sortList(this.activeUsers,h)}};d.prototype.sortList=function(j,m){var h=j.children("li:not(.empty)").get(),o=(a(m).data("displayname")||"").toString(),n=a(m).data("active");for(var g=0;g<h.length;g++){var l=(a(h[g]).data("displayname")||"").toString(),k=a(h[g]).data("active");if(n===k&&o.toUpperCase()<l.toUpperCase()){a(h[g]).before(m);break}else{if(n&&!k){a(h[g]).before(m);break}else{if(g===(h.length-1)){a(h[g]).after(m);break}}}}};d.prototype.canTrimHistory=function(){return this.tab.data("trimmable")!==false};d.prototype.setTrimmable=function(g){this.tab.data("trimmable",g)};d.prototype.trimHistory=function(i){var g=this.messages.find("li.message"),h=g.length;i=i||e;if(this.isLobby()||!this.canTrimHistory()){return}if(h<i){return}g.filter("li:eq("+(h-i)+")").prevAll().remove()};b.Room=d}(window.jQuery,window,window.chat));(function(a,q){var o='<li data-name="${id}" data-displayname="${name}">            <a class="user-link">                <span class="msg-thread">                    <span class="msg-thread-avatar user${id}">                        <img src="${avatar}">                        <i class="avatar-status ${presenceClass}"></i>                    </span>                    <span class="msg-thread-info">                        <span class="msg-thread-name overflow-ellipsis">${name}</span>                    </span>                </span>            </a>         </li>',n='<div id="userlist-${id}" class="users">        <div class="user-section-label"><h5 class="userlist-header"><span class="users-online"></span> '+q.getLanguageResource("FooterPeopleText")+' </h5></div>            <ul id="userlist-${id}-active"></ul>        </div>',c='<li id="m-${id}" mid="${messageID}" data-threadid="${threadid}" data-name="${userid}" data-timestamp="${date}" class="cl-message message current-user {{if isDeleted}}deleted{{/if}}">            {{if showUser}}            <div class="cl-message-avatar avatar-container">                <img src="${avatar}">            </div>            {{/if}}            <div class="cl-message-body">                {{if showUser}}                <div class="cl-message-user">${name}</div>                {{/if}}                <div class="cl-message-inner clearfix">                    <div class="message-options">                        <div class="status">{{if isEdited}}<i class="fa fa-pencil"></i>{{/if}}{{if isDeleted}}<i class="fa fa-trash"></i>{{/if}}</div>                        <div class="timestamp">${when}</div>                            <div class="drop">                                <div class="btn-group">                                    <a class="btn btn-link dropdown-toggle" data-toggle="dropdown" href="#"><i class="fa fa-chevron-circle-down"></i></a>                                    <ul class="dropdown-menu pull-right" data-messageid="${messageID}">                                        <li><a class="quote" href="#">'+q.getLanguageResource("ChatQuoteMessageText")+'</a></li>                                        {{if userid == Communifire.currentUserID && Communifire.allowMessageEditDelete}}<li><a class="delete-message" href="#">'+q.getLanguageResource("ChatRemoveMessageText")+'</a></li>{{/if}}                                    </ul>                                </div>                            </div>                    </div>                    <div class="message content">                    {{if attachment.IsImage}}                        <a href="${attachment.Url}" target="_blank">${attachment.Name}</a>                        <p class="image-attachment-container">                            <a class="thumbnail" href="${attachment.Url}" target="_blank">                                <img class="image-attachment" alt="${attachment.name}" src="${attachment.ThumbUrl}">                                <span class="file-download" data-href="${attachment.Url}&attachment=1" title="'+q.getLanguageResource("FileDownloadText")+'"><i class="fa fa-download"></i></span>                            </a>                        </p>                    {{else}}                    <div class="file-container">                        <a class="file-link" href="${attachment.Url}" target="_blank"> <div class="row-fluid">                            <div class="span1 file-extension-icon">                                <i class="fa fa-file${attachment.ExtensionClass}"></i>                            </div>                            <div class="span11 file-info overflow-ellipsis"><h4 class="file-title overflow-ellipsis">${attachment.Name}</h4>                                <p class="file-meta">                                    ${attachment.Size} ${attachment.Extension}                                </p>                            </div>                            </div>                        </a>                        <span class="file-download" data-href="${attachment.Url}&attachment=1" title="'+q.getLanguageResource("FileDownloadText")+'"><i class="fa fa-download"></i></span>                    </div>                    {{/if}}                </div>            </div>        </div>        </li>',h='<li id="m-${id}" mid="${messageID}" data-threadid="${threadid}" data-name="${userid}" data-displayname="${name}" data-timestamp="${date}" class="cl-message message current-user {{if isDeleted}}deleted{{/if}}">            {{if showUser}}            <div class="cl-message-avatar avatar-container">                <img src="${avatar}">            </div>            {{/if}}            <div class="cl-message-body">                {{if showUser}}                <div class="cl-message-user">${name}</div>                {{/if}}                <div class="cl-message-inner clearfix">                    <div class="message-options">                    <i class="fa fa-circle status-unread"></i><div class="message-delivery-status"><i class="${messageDeliveryStatusClass}"></i></div><div class="status">{{if isEdited}}<i class="fa fa-pencil"></i>{{/if}}{{if isDeleted}}<i class="fa fa-trash"></i>{{/if}}</div>                    <div class="timestamp">${when}</div>                            <div class="drop">                                <div class="btn-group">                                    <a class="btn btn-link dropdown-toggle" data-toggle="dropdown" href="#"><i class="fa fa-chevron-circle-down"></i></a>                                    <ul class="dropdown-menu pull-right" data-messageid="${messageID}">                                        <li><a class="quote" href="#">'+q.getLanguageResource("ChatQuoteMessageText")+'</a></li>                                        {{if userid == Communifire.currentUserID && Communifire.allowMessageEditDelete}}<li><a class="edit-message" href="#">'+q.getLanguageResource("ChatEditMessageText")+'</a></li><li><a class="delete-message" href="#">'+q.getLanguageResource("ChatRemoveMessageText")+'</a></li>{{/if}}                                    </ul>                                </div>                            </div>                    </div>                    <div class="message content">{{html message}}</div>                </div>            </div>        </li>',f='<li id="m-${id}" mid="${messageID}" data-name="${name}" data-timestamp="${date}" class="cl-message message current-user">            {{if showUser}}            <div class="cl-message-avatar avatar-container">                <img src="${avatar}">            </div>            {{/if}}            <div class="cl-message-body">                <div class="cl-message-user">${name}</div>                <div class="cl-message-inner clearfix">                    <div class="message-options">                        <div class="timestamp">${when}</div>                    </div>                    <div class="message content">{{html message}}</div>                </div>            </div>        </li>',i='<div class="collapsible_content">            <div class="collapsible_box">                <pre class="multiline">${content}</pre>            </div>        </div>',l='<li id="tabs-${id}" data-name="${name}" class="thread-li{{if unreadMessageCount>0}} unread{{/if}}" data-threadtype="${roomType}">                    <a class="thread-link" ><span class="msg-thread"><span class="message-count">${unreadMessageCount}</span>                        <span class="msg-thread-avatar user${userID}">                       <img src="${roomImageUrl}" />                       {{if roomType==3}}<i  data-userid="${userID}" class="avatar-status ${presenceClass} "></i>{{/if}}                        </span>                        <span class="msg-thread-info"><span class="msg-thread-name overflow-ellipsis">${roomDisplayName}</span>                            <span class="msg-thread-date time"></span>                        </span>                        </span>                        <span class="thread-item-desc hide"></span>                        </a>                </li>',k='<li id="tabs-${id}" class="history-li">            <a class="thread-link msg-thread msg-thread-history" >                <span class="msg-thread-avatar user${userID}">                    <i class="fa fa-clock-o"></i>                </span>                <span class="msg-thread-info">'+q.getLanguageResource("ChatHistoryText")+"                </span>            </a>        </li>",j='<li id="tabs-history-${id}" class="ch-history-section"  data-name="${id}">            <a class="history-link">                <span class="ch-history-avatar user${userID}">                    <img src="${roomImageUrl}">                    {{if roomType==3}}<i  data-userid="${userID}" class="avatar-status ${presenceClass} "></i>{{/if}}                    </span>                <span class="ch-history-info">                    <span class="ch-history-date time"></span>                    <span class="ch-history-people overflow-ellipsis">${roomDisplayName}</span>                    <span class="ch-history-message clearfix">${message}</span>                </span>            </a>        </li>',e='<div class="cf-header cf-chat-header cf-header-history">             <div class="history-title">${roomDisplayName}</div>        </div>',m='        <div class="cf-header cf-chat-header">                     <div class="person-container pull-left" >                        <span class="msg-thread">                            <span class="msg-thread-avatar user${userID}">                                <img src="${roomImageUrl}">                                {{if roomType==3}}<i class="avatar-status ${presenceClass}"></i>{{/if}}                            </span>                             <span class="msg-thread-info">                                <span class="msg-thread-name overflow-ellipsis">${roomDisplayName}</span>                                {{if roomType==3}}                                <span class="user-status${userID}">${presenceText}</span>                                {{else}}                                <span class="user-status"><a class="user-count-link" href="#"><span class="people-count">${count}</span> '+q.getLanguageResource("HeaderMenuPeopleText")+'</a></span>                                {{/if}}                                </span>                                <span class="msg-thread-star"><a href="#" class="favorite-link" data-threadid="${id}"><i></i></a></span>                                </span>                        </div>                        <div id="ManageMessageThreadContainer" class="btn-group actions pull-right">                         {{if (allowSkypeCallInChat) }}  <a class="btn skype-button" href="#" title="'+q.getLanguageResource("CallSkypeText")+'"><i class="fa fa-skype"></i></a>{{/if}}                         {{if (isOwner==true && roomType==1)}}                                <a id="ManageMessageThreadLink" class="btn dropdown-toggle" data-toggle="dropdown" href="#"><i class="fa fa-cog"></i> <span class="caret"></span></a>                                <ul class="dropdown-menu">                                    <li id="ManageMessageThreadAnchorContainer"><a class="update-room" href="#"><i class="fa fa-cog"></i> '+q.getLanguageResource("UserControlSettingCamelText")+'</a></li>                                </ul><a class="btn" id="AddMorePeopleLink" data-threadid="${id}" href="#" title="'+q.getLanguageResource("InboxAddPeopleText")+'"><i class="fa fa-user-plus" aria-hidden="true"></i></a>                                    {{/if}}                        {{if roomType==3}}                            <a class="btn" id="CreateNewGroupLink" href="#" title="'+q.getLanguageResource("StartANewChatText")+'" data-userid="${userID}" data-name="${roomDisplayName}"><i class="fa fa-user-plus" aria-hidden="true"></i></a>                                    {{/if}}            </div>            </div>',d='<li class="day-divider ${type}" data-timestamp="${date}"><hr><div class="day-divider-label">{{html message}}</div></li>',g='<li class="day-divider new-messages" data-timestamp="${date}"><hr><div class="day-divider-label">'+q.getLanguageResource("NewMessages")+"</div></li>",b='<div class="loading-room alert alert-info">          <i class="fa fa-spinner fa-spin"></i> '+q.getLanguageResource("LoadingRoomText")+"</div>";a.template("newUserTemplate",o);a.template("newUserListTemplate",n);a.template("newAttachmentTemplate",c);a.template("newMessageTemplate",h);a.template("newMessageHistoryTemplate",f);a.template("newMultiLineContentTemplate",i);a.template("newThreadTemplate",l);a.template("newThreadHistoryTemplate",k);a.template("newThreadHistoryMessageTemplate",j);a.template("newHistoryTopicTemplate",e);a.template("newTopicTemplate",m);a.template("newDateDividerTemplate",d);a.template("newMessagesDividerTemplate",g);a.template("loadingRoomIndicatorTemplate",b);var p={process:function(s,r){return a.tmpl(s,r)}};if(!window.chat){window.chat={}}window.chat.templates=p})(window.jQuery,window.chat.utility);(function(a,dV,bB,aY,dR,bG,cw,a5,bd){var m=null,au=null,ad=null,F=null,G=null,av=null,at=null,ab=null,ag=null,ax=null,w=null,A=null,y=null,z=null,B=null,V=null,L=null,az=null,ao=null,dy=null,bK=true,db=false,ci={Up:38,Down:40,Esc:27,Enter:13,Return:45,Slash:47,Space:32,Tab:9,Question:191},di=75,de=1,dA=dV.chat.toast,c0=null,cj=null,N=null,M=null,b3=0,an=null,K=null,ah=null,aD=null,aB=null,aF=a(dV),x=a(bB),U=null,cp=false,ai=null,n=null,ay=null,dH=null,bj=null,bk=null,bl=null,dQ=null,dO=15000,af=null,cm=null,bT="getMessageItem",dd={},ae=null,cs,cd="i",cY=null,t=null,r=null,bh=-1,s=null,bi=null,q=null,p=null,J=null,O=null,I=null,H=null,bf=null,bg=null,Q=null,dF=1000*60*2,R=null,c8=null,dw=null,cr=100,ck=0,T=null,S=null,aj=null,j=null,W=null,df=250,dg=null,dc=aY.Room,aA=null,ap=null,u=null,aC=null,k=null,l=null,b8=0,dG={},dS=bd.virtualDirectory,a8="class",a9="clear",ba="click",bb="click touchstart",aS="blur",b4="hidden",dv="shown",bx="destroy",du="show",b5="hide",b6="href",dz="title",cn="left",aT="bottom",dC="top",br="data-original-title",bs="data-status",bn="data-href",bt="data-threadid",bp="data-mid",bo="data-id",bq="data-name",bu="data-userid",b7="id",cv="mid",b6="href",dT="visibility",b4="hidden",dU="visible",aR="avatar-status ",c9="read",da="."+c9,dn="setLastMessagesInCache",bS="getLastMessageID",cu=".messages",be="fa fa-globe",bA="fa fa-exclamation-triangle",dP="fa fa-refresh fa-spin fa-fw",bz="alert disconnected",aJ="alert",aM="alert alert-warning",aK="alert alert-info",aL="alert alert-success",cB="new-messages",cC="."+cB,bC="document",ct="#m-",dk="sent",bv="delivered",c4="fa fa-clock-o",dJ="unread",dK="."+dJ,bJ=".failed",dx="#tabs",co="li",ak=null,i=null,al=null,o=null,am=null,aE=null,P=null,v=null,d=null,c=null,b=null,h=null,g=null,f=null,ac=null,aw=null,X=null,aa=null,Y=null,Z=null,ar=null,aq=null,cy=dR.getLanguageResource("MuteNotificationsSoundText"),bI=dR.getLanguageResource("EnableNotificationsSoundText"),a0=dR.getLanguageResource("ChatQuotedText"),bH="fa fa-bell",by="fa fa-bell-o",aN=bd.allowEnterKeyAsSubmit,bw=bd.desktopNotificationImageUrl,aV=bd.CF_CHAT_STATUS,aW=bd.Utilities,aG=null,aZ=true,a4=bd.chatSoundUrl,a6=1,a3=[],cl=[],a2={MESSAGE_RECEIVED:{url:a4,volume:a6}},bD=dV.doDomProcessing||function(){},c1=function(){for(var dW in a2){if(!a3[dW]){var dX=a2[dW];var e=a3[dW]=new dV.Audio();e.volume=dX.volume;e.src=dX.url}}},cX=function(dW){var e=a3[dW];if(!e){var dX=a2[dW];if(!dX){throw new Error("Invalid sound name")}e=a3[dW]=new dV.Audio();e.volume=dX.volume;e.src=dX.url}e.currentTime=0;e.play()},b9,cD=false,bF=false,bm=bd.currentUserID,aU=!!bB.createElement("audio").canPlayType,a1,dI,bR=dR.getLanguageResource,bQ=bd.getFriendsUrl,ce=aW.isElectronPresent(),cA="\n",D,E,C,aP=CF_API_TOKEN,b0="/users?searchUsersOnly=true&excludeCurrentUser=true&token="+aP,a7=".chosen-container";try{a1=aU==true&&a4?new Audio(a4):{play:function(){}}}catch(bE){a1=null}if(ce){aZ=false;bF=true;b9=require("electron").ipcRenderer;b9.on("asynchronous-reply",function(e,dW){if(!dW.IsFocused){dj(dW.roomName,dW.message)}})}if(dR.isChrome){if(("Notification" in dV)){if(Notification.permission!=="denied"){Notification.requestPermission(function(e){if(e==="granted"){cD=true}})}}}function cE(dW,e){if(bK===false||ce){if(e.userid!=bm){dI.notifyRoom(dW);dI.toastRoom(dW,e)}}}function dj(d0,dW){var e,dY,dX=dW.name;e=dW.message;e=aW.htmlDecode(e);dX=aW.htmlDecode(dX);var dZ;if(ce){dZ={body:e,silent:true};var dY=new dV.Notification(dX,dZ);dY.onclick=function(){require("electron").remote.getCurrentWindow().show();this.close()};if(Communifire.CF_CHAT_NOTIFICATIONS_SOUND_ENABLED){cX("MESSAGE_RECEIVED")}}}c1();function dB(dY,dW){var dX,e=aV!=4;if(bF){if(e){b9.send("asynchronous-message",{message:dW,roomName:dY})}}else{if(cD&&e){dj(dY,dW)}}}function dh(e,dX){var dW=dI.isNearTheEnd(dX);e();if(dW){dI.scrollToBottom(dX)}}function cP(dW){dW.preventDefault();var d1=a(this),d0=dI.selectors,dZ=d1.closest(d0.message),dY,d2,dX,d3;a.confirm(dR.getLanguageResource("InboxDeleteMessageConfirmText"),function(){dY=dZ.attr(cv);dX=dZ.attr(b7).substr(2);d2=dZ.attr(bt);d3={id:dX,isDeleted:true,message:dR.getLanguageResource("ChatMessageRemovedText")};dh(function(){dI.overwriteMessage(dX,d3)},d2);az.trigger(dI.events.deleteMessage,[d2,dY])})}function cQ(dW){dW.preventDefault();var dZ=D.attr(bp),d1=D.attr(bt),dX=D.attr(bo),dY=a.trim(E.val()),d0,d2;if(!dY){return}d0=dR.encodeHtml(dY);d0=dR.processContent(d0);d2={id:dX,message:d0};dh(function(){dI.replaceMessageContent(d2)},d1);E.val("");D.attr({"data-mid":"","data-threadid":"","data-id":""}).modal(b5);az.trigger(dI.events.editMessage,[d1,dZ,dY])}function cR(dW){dW.preventDefault();var d3=a(this),d2=dI.selectors,d1=d3.closest(d2.message),dY=d1.find(d2.messageContent),dZ,d0,d4,dX;dZ=a.trim(dY.html());dZ=dR.processContentForInput(dZ);d0=d1.attr(cv);dX=d1.attr(b7);d4=d1.attr(bt);E.val(dZ);D.attr({"data-mid":d0,"data-threadid":d4,"data-id":dX}).modal(du)}function cM(dX){dX.preventDefault();var dW=a(this),d0=dW.attr(bu),dY=dW.attr(bq);var dZ={Key:d0,Value:dY};var d1=[];d1.push(dZ);cZ($addPeopleDropdownList,d1);d.modal(du);bL($addPeopleDropdownList)}function cT(dX){dX.preventDefault();var d3=a(this),d2=dI.selectors,d0=d3.closest(d2.message),dY=d0.find(d2.messageContent),d1=dR.decodeHtml(a.trim(d0.attr("data-displayname"))),d7,dW,d5,d1,dZ,d6=d0.attr("data-timestamp");dW=cw(d6).format("MMMM Do YYYY");d5=cw(d6).format("h:mm a");dZ=a.trim(dY.html());dZ=dR.processContentForInput(dZ);dZ=dZ.replace(/^/gm,"> ");var d4=String.format(a0,dW,d5,d1);d4=d4+cA+dZ;d7=ab.val();d7=d7.replace(/\n$/,"");if(!d7){d4=d4+cA+cA}else{d4=d7+cA+d4+cA+cA}ab.val(d4);dR.setCaretToPos(ab[0],d4.length);ab.trigger("reset")}function c2(e,dZ){if(dZ){var d1=JSON.parse(dZ);var dX=[];if(d1.length>0){for(var dW=0,dY=d1.length;dW<dY;dW++){var d0={Key:d1[dW].id,Value:d1[dW].name};dX.push(d0)}}cZ(e,dX)}}function cF(dW){dW.preventDefault();var e=a(this),dY=e.attr(bt),dX;dI.showSplashScreen();az.trigger(dI.events.addMorePeopleClick,[dY])}function cV(e){e.preventDefault();var dW=dI.getActiveRoomID();dI.showSplashScreen();az.trigger(dI.events.updateRoomClick,[dW])}function cW(){aa.val("");cZ(Y);X.attr(bt,"")}function cg(e){return e.length>1}function ch(){var e=true,dW=Y.chosen().val();if(a.trim(dW)==""){e=false}if(!cg(dW)){return}return e}function cb(){var e=true;val=g.chosen().val();if(a.trim(val)==""){e=false}if(!cg(val)){return}return e}function ca(){var e=true;var dW=$addPeopleDropdownList.chosen().val();if(a.trim(dW)==""){e=false}return e}function cc(){var e=true;var dW=ar.chosen().val();if(a.trim(dW)==""){e=false}return e}function cS(e){e.preventDefault();var dY=a(this);if(ch()){var dZ=X.attr(bt),d0=aa.val(),dW=Y.chosen().val().join(","),dX={ThreadTitle:d0,ParticipantsIds:dW};az.trigger(dI.events.updateRoom,[dZ,d0,dW]);X.modal(b5)}}function aQ(e,dW){dW=dW||dC;e.tooltip({placement:dW,container:"body"})}function cJ(e){e.preventDefault();if(cb()){e.preventDefault();var dX=h.attr(bt),dW=g.chosen().val().join(",");az.trigger(dI.events.updateParticipants,[dX,dW]);h.modal(b5)}}function cG(dW){dW.preventDefault();if(ca()){var dZ="",dX=$addPeopleDropdownList.chosen().val().join(","),d0=1,dY={ThreadTitle:dZ,ParticipantsIds:dX,ThreadType:d0};az.trigger(dI.events.addRoom,[dY]);d.modal(b5)}}function cU(dW){dW.preventDefault();if(cc()){var dZ=aw.val(),dX=ar.chosen().val().join(","),d0=1,dY={ThreadTitle:dZ,ParticipantsIds:dX,ThreadType:d0};az.trigger(dI.events.addRoom,[dY]);v.modal(b5)}}function bL(e){e.siblings(a7).find('input[type="text"]').focus()}function cO(){bL(ar)}function cN(){aw.val("");cZ(ar)}function cI(){bL($addPeopleDropdownList)}function cH(){cZ($addPeopleDropdownList)}function cL(){bL(g)}function cK(){cZ($addPeopleDropdownList);h.attr(bt,"")}function cZ(dW,e){if(!dW){return}dW.find("option").removeAttr("selected").prop("selected",false);dW.html("");dW.trigger("chosen:updated");if(!e){return}var dX="";a.each(e,function(dY,dZ){dX=dX+"<option value='"+dZ.Key+"'>"+dZ.Value+"</option>"});dW.html(dX);dW.find("option").attr("selected","selected").prop("selected",true);dW.trigger("chosen:updated")}function b1(e){return dG[e]}function aX(dW,e){dG[dW]=e}function dl(e,dW,dX){t.show();r.html(dW)}function bM(){return aG}function dD(){if(!dR.isMobile&&!db){if(bM()==="Lobby"){ai.focus()}else{ab.focus()}}if(bK===false){bK=true;az.trigger(dI.events.focusit)}}function cq(e){az.trigger(dI.events.markMessagesAsRead,[e])}function c7(e,dZ){var d3=dZ.users,dW,dY,d2,d0,d1,dX="";for(dW=0,dY=d3.length;dW<dY;dW++){d2=d3[dW];d0=d2.SkypeIM;if(d0){dX=dX+";"+d0}}if(dX){d1="skype:"+dX+"?call";e.attr(b6,d1)}else{e.hide()}}function dm(){if(F.is(":empty")){G.hide()}else{G.show()}}function c3(dX,dW){var e=dX;var dY=dR.getLanguageResource((dW)?"RemoveFromFavorites":"SetAsFavoriteText");e.attr("class",(dW)?"fa fa-star":"fa fa-star-o").attr(dz,dY).attr(br,dY);aQ(e,aT)}function bV(dX){var dW=bW(dX);var e=new dc(a("#tabs-"+dW),a("#userlist-"+dW),a("#userlist-"+dW+"-owners"),a("#userlist-"+dW+"-active"),a("#messages-"+dW),a("#roomTopic-"+dW));return e}function bU(e){return a(dI.selectors.messages+"-"+e)}function bX(dW){var e=bU(dW);return e.find(dI.selectors.loadingRoom)}function bP(){var e=au.find("li.current");var dW;if(e.data("name")==="Lobby"){dW=new dc(e,a("#userlist-lobby"),a("#userlist-lobby-owners"),a("#userlist-lobby-active"),a(".messages.current"),a(".roomTopic.current"))}else{dW=new dc(e,a(".users.current"),a(".userlist.current .owners"),a(".userlist.current .active"),a(".messages.current"),a(".roomTopic.current"))}return dW}function bO(){}function bZ(dW,e){}function bN(e){var dW=bP();return bZ(dW.getName(),e)}function aO(e,dW){}function bY(e){if(e.length&&e[0]==="/"){e=e.substr(1)}var dW=e.split("/");if(dW[0]==="threads"){return dW[1]}return null}function cz(dX){aG=dX;var e=(bB.location.hash||"#").substr(1),dW=bY(e);if(dW&&dW===dX){dI.setActiveRoomCore(dX)}else{bB.location.hash="#/threads/"+dX}}function dL(dW,dX){var dY=dW.roomTopic,dZ=dW.users,d0=dI.selectors,e=dX.count;dY.find(d0.peopleCount).html(e);dZ.find(d0.usersOnline).html(e)}function dN(d5){var d6=d5.name,d4=bV(d6),d2=d5.isFavorite,d7=d4.roomTopic,d3=bP().getName()===d6,d9,d8,d1,dW=null,dZ=null,d0=null,dX=null,dY,e;if(d3){d7.hide()}d9=d5,d8=d4.roomTopic,d1=a5.process(dy.topic,d9),$html=a(d1);d8.html($html);bD($html);if(d5.roomType===1){d0=d8.find(dI.selectors.usersCountLink);d0.on(ba,function(ea){ea.preventDefault();i.toggleClass(dI.classes.showRightMenu)})}dL(d4,d5);dW=d8.find(dI.selectors.favoriteLink);dX=dW.find("i");c3(dX,d2);dW.on(ba,function(ec){ec.preventDefault();var eb=a(this),ea=dW.find("i"),ee=eb.attr("data-threadid"),ed=ea.hasClass("fa-star-o");cx(ee,ed);az.trigger(dI.events.markThreadAsFavorite,[ee,ed,dW])});if(dV.allowSkypeCallInChat){dY=d8.find(dI.selectors.skypeButton);c7(dY,d5)}if(d3){d7.show()}}function ds(e,dZ){if(!e){var dX=bW(dZ);var dY=bX(dX);var dW=bV(dZ);if(!dW.isHistory()){dV.setTimeout(function(){dY.remove();dW.markLoaded()},df)}}}function dr(e,dX){if(!dX){return}if(e){var dW=bV(dX);if(!dW.isInitialized()){dg=dV.setTimeout(function(){aj.show()},df)}}else{if(dg){clearTimeout(dg)}aj.hide()}ds(e,dX)}function cf(e){return e.indexOf('class="collapsible_box')>-1}function dt(dX,dY){var dW=cf(dX),e=dY?bZ(dY,"blockRichness"):bN("blockRichness");return dW&&e}function bc(e){e=e.replace(/class="collapsible_box/g,'style="display: none;" class="collapsible_box');return e.replace(/class="collapsible_title"/g,'class="collapsible_title" title="'+dR.getLanguageResource("Content_DisabledMessage")+'"')}function dM(dZ){var dY=bV(dZ),e=dY.tab,dW=e.find(dI.selectors.time),dX=cw(new Date());dW.livestamp("destroy");dW.livestamp(dX)}function dp(e,dZ){var dW=e.find(dI.selectors.time);var dY=cw(dZ);var dX=cw(new Date());if(dX.diff(dY,"days")<2){dW.livestamp(dZ)}else{dW.html(dY.fromNow())}}function c5(dW,dX){var e=dt(dW.message,dX);dW.when=dW.date.formatTime(true);dW.fulldate=dW.date.toLocaleString();if(e){dW.message=bc(dW.message)}}function c6(dW,dX){var e=dt(dW.message,dX);if(e){dW.message=bc(dW.message)}}function bW(e){return dV.escape(e.toString().toLowerCase()).replace(/[^A-Za-z0-9]/g,"_")}function b2(e){return'[data-name="'+e+'"]'}function aH(){var dY=dR.getLanguageResource("FileHistoryText"),d0=dY.toLowerCase(),dX=bV(d0),dZ,d3,e,dW,d1,d2;if(dX.exists()){return false}dZ=bW(d0);d3={id:d0,name:d0,roomDisplayName:dY};dW=a5.process(dy.threadHistory,d3).data("name",d0).appendTo(av);dW.addClass("history");bD(dW);e=a("<ul/>").attr("id","messages-"+dZ).addClass("messages ch-history-content").appendTo(m).hide();bD(e);a("<div/>").attr("id","roomTopic-"+dZ).addClass("roomTopic").appendTo(m).hide();d2=a("<div/>").attr("id","roomTopic-"+dZ).addClass("roomTopic").appendTo(al).hide();a5.process(dy.historyTopic,d3).appendTo(d2);d1=function(){if(a(this).data("full")===true){return}if(a(this).scrollTop()+a(this).innerHeight()+di>=a(this)[0].scrollHeight){az.trigger(dI.events.scrollRoomHistoryBottom,[d0,de])}};e.bind("scroll",d1);e.data("scrollHandler",d1);cp=false;return true}function aI(d7,d2){var d5=d7.Name,d3=bV(d7.Name),d4=null,ea=null,dY=null,e=null,dZ=null,d0=null,dW=null,d8=null,d9=null,dX=null,d6=d7.RoomType,d1=d7.IsFavorite,eb=d7.When;if(d3.exists()){dI.updateRoomTab(d7,d5,d3);return false}d4=bW(d5);ea=dR.getRoomViewModel(d7);dX=a5.process(dy.thread,ea).data("name",d5);if(d2){dZ=dX.prependTo((d1)?F:ad)}else{dZ=dX.appendTo((d1)?F:ad)}console.log("doDomProcessing for t$hreadItem");bD(dZ);dp(dZ,eb);dY=a("<ul/>").attr("id","messages-"+d4).addClass("messages").appendTo(m).hide();a5.process(dy.loadingRoomIndicatorTemplate).appendTo(dY);a("<div/>").attr("id","roomTopic-"+d4).addClass("roomTopic").appendTo(m).hide();d9=a("<div/>").attr("id","roomTopic-"+d4).addClass("roomTopic").appendTo(al).hide();if(d6===1){a5.process(dy.userlist,ea).appendTo(aE).hide()}bD(aE);d8=function(){var ed=null;if(a(this).data("full")===true){return}if(a(this).scrollTop()<=di&&!dI.isNearTheEnd(d4)){var ec=dY.children(".message:first");if(ec.length>0){ed=ec.attr("mid");az.trigger(dI.events.scrollRoomTop,[{name:d5,messageID:ed}])}}};dY.bind("scroll",d8);dY.data("scrollHandler",d8);cp=false;if(P.css(dT)==b4){P.css(dT,dU)}return true}function dE(){if(db){return}var dX=a.trim(ab.val()),dZ=bM(),dY=bV(dZ),dW,e=true;dI.removeNewMessagesDivider(dZ,dY);if(dX){if(dI.isCommand(dX)){if(!dI.confirmCommand(dX)){az.trigger(dI.events.sendMessage,[dX,null,true])}}else{if(dY.isHistory()){dI.addErrorToActiveRoom(dR.getLanguageResource("Chat_CannotSendLobby"));return false}dW=dR.encodeHtml(dX);dW=dI.processContent(dW);var d0={name:dI.getUserName(),avatar:dI.getUserAvatar(),message:dW,id:dR.newId(),date:new Date(),highlight:"",isMine:true,threadid:dZ,userid:bm};dI.addChatMessage(d0,dZ);az.trigger(dI.events.sendMessage,[dZ,dX,d0.id,false])}}ab.val("");ab.trigger("reset");ab.focus();dY.scrollToBottom();dY.removeSeparator()}function dq(dX,dW,e){de=1;dW.makeActive();P.hide();az.trigger(dI.events.openHistory,[dX]);az.trigger(dI.events.activeRoomChanged,[dX]);return true}function cx(d1,dY){var dW=a("#tabs-"+d1);var dZ=dI.selectors.threadTitle;var dX=dW.find(dZ).text();var e=false;var d0=(dY?F:ad)[0];if(dY){a(dZ,d0).each(function(){var d3=a(this).text();var d4=dX;if(d3.localeCompare(d4)>0){var d2=a(this).closest("li");a(dW).insertBefore(d2).show();e=true;return false}});if(!e){a(dW).appendTo(a(d0)).show()}}else{a(dW).prependTo(a(d0)).show()}dm()}dI={events:{closeRoom:"cfChat.ui.closeRoom",prevMessage:"cfChat.ui.prevMessage",openRoom:"cfChat.ui.openRoom",loadRoom:"cfChat.ui.loadRoom",openHistory:"cfChat.ui.openHistory",nextMessage:"cfChat.ui.nextMessage",activeRoomChanged:"cfChat.ui.activeRoomChanged",scrollRoomTop:"cfChat.ui.scrollRoomTop",scrollRoomHistoryBottom:"cfChat.ui.scrollRoomHistoryBottom",typing:"cfChat.ui.typing",sendMessage:"cfChat.ui.sendMessage",editMessage:"cfChat.ui.editMessage",deleteMessage:"cfChat.ui.deleteMessage",focusit:"cfChat.ui.focusit",blurit:"cfChat.ui.blurit",preferencesChanged:"cfChat.ui.preferencesChanged",loggedOut:"cfChat.ui.loggedOut",reloadMessages:"cfChat.ui.reloadMessages",fileUploaded:"cfChat.ui.fileUploaded",tabOrderChanged:"cfChat.ui.tabOrderChanged",changeStatus:"cfChat.ui.changeStatus",addRoom:"cfChat.ui.addRoom",updateRoom:"cfChat.ui.updateRoom",updateParticipants:"cfChat.ui.updateParticipants",notificationFocus:"cfChat.ui.notificationFocus",bodyLoaded:"cfChat.ui.bodyLoaded",markMessagesAsRead:"cfChat.ui.markMessagesAsRead",updateRoomClick:"cfChat.ui.updateRoomClick",addMorePeopleClick:"cfChat.ui.addMorePeopleClick",markThreadAsFavorite:"cfChat.ui.markThreadAsFavorite",enableCurentUserNotificationsSound:"cfChat.ui.enableCurentUserNotificationsSound",checkMessagesReadStatus:"cfChat.ui.checkMessagesReadStatus"},selectors:{message:".cl-message",messageUserAvatar:".cl-message-avatar",messageUserName:".cl-message-user",messageDeliveryStatus:".message-delivery-status",typingIndicator:"#ch-typingIndicator",peopleCount:".people-count",favoriteLink:".favorite-link",usersCountLink:".user-count-link",usersOnline:".users-online",time:".time",drop:".drop",historyContainer:"#messages-history",downloadLink:".file-download",updateRoom:".update-room",threadTitle:".msg-thread-name",messageContent:".content",failedMessage:".cl-message.failed",quoteLink:".quote",editMessageLink:".edit-message",deleteMessageLink:".delete-message",dropDownMenu:".dropdown-menu",dropDownToggle:".dropdown-toggle",skypeButton:".skype-button",createNewGroupLink:"#CreateNewGroupLink",addMorePeopleLink:"#AddMorePeopleLink",loadingRoom:".loading-room",messages:"#messages"},help:{shortcut:"shortcut",global:"global",room:"room",user:"user"},classes:{showLeftMenu:"show-left-menu",showRightMenu:"show-right-menu",failedMessage:"failed",reverse:"reverse"},addRoom:aI,isRoomLoaded:function(dX){var dW=bV(dX);var e=dW.isLoaded();return e},addHistory:aH,initialize:function(dW){az=a(this);var e=a.Deferred();a.get(dS+"/assets/chat/templates/body.html?v="+Communifire.cfVersion,function(d0){var d1="bodyTemplate";a.template(d1,d0);var dY={r:{LoadingPreviousMessagesText:bR("LoadingPreviousMessagesText"),GlobalCloseText:bR("GlobalCloseText"),FavoritesText:bR("FavoritesText"),RecentText:bR("RecentText"),ChatStatusOnline:bR("ChatStatusOnline"),ChatStatusAway:bR("ChatStatusAway"),ChatStatusDND:bR("ChatStatusDND"),ChatStatusInvisible:bR("ChatStatusInvisible"),HeaderLogoutText:bR("HeaderLogoutText"),ChatInputPlaceHolderText:bR("ChatInputPlaceHolderText"),GlobalDropFilesUploadText:bR("GlobalDropFilesUploadText"),StartANewChatText:bR("StartANewChatText"),GlobalTitleText:bR("GlobalTitleText"),ITTicketPeopleText:bR("ITTicketPeopleText"),GlobalSubmitText:bR("GlobalSubmitText"),GlobalCancelText:bR("GlobalCancelText"),UserControlSettingCamelText:bR("UserControlSettingCamelText"),ChatEditMessageText:bR("ChatEditMessageText"),GlobalSaveText:bR("GlobalSaveText"),InviteOthersToJoin:bR("ChatInviteOthers"),ChatFindPeopleTypeName:bR("ChatFindPeopleTypeName"),ChatStartConversation:bR("ChatStartConversation"),GlobalSearchText:bR("GlobalSearchText"),GlobalSearchResultHeaderText:bR("GlobalSearchResultHeaderText"),NoEmojiFoundText:bR("NoEmojiFoundText"),ChatConversationSettings:bR("ChatConversationSettings"),ConversationTitleTopic:bR("ConversationTitleTopic"),SpaceSaveSettingText:bR("SpaceSaveSettingText"),InboxAddPeopleText:bR("InboxAddPeopleText"),ChatAddOthers:bR("ChatAddOthers"),ChatAddPeopleTypeName:bR("ChatAddPeopleTypeName")},currentUserDisplayName:bd.currentUserDisplayName,logoutUrl:bd.logoutUrl,currentUserID:bd.currentUserID,currentUserPresenceClass:bd.currentUserPresenceClass,logoutUrl:bd.logoutUrl,currentUserAvatar:bd.currentUserAvatar,appLogoUrl:bd.appLogoUrl,appName:bd.appName,homeUrl:bd.homeUrl,isMobile:dR.isMobile};var dZ=a.tmpl(d1,dY),dX=a(dZ);a("body").prepend(dX);bD(dX);az.trigger(dI.events.bodyLoaded);dI.initializePost(dW);e.resolve()});return e},stopPropagation:function(dW){console.log("Stop propagation.");dW.stopPropagation()},hideTextbox:function(){bB.activeElement.blur();ab.blur()},initializePost:function(d2){c0=d2||{};m=a("#chat-area");au=a("#tabs, #tabs-dropdown");ad=a("#recent-threads");F=a("#favorite-threads");G=a(".favorite-thread-section-label");av=a("#threads-history");at=a("#send");ab=a("#new-message");ag=a("#room-actions");ax=a("#room-preferences .toast");ao=a("#room-preferences .sound");af=a("#room-preferences .richness");A=a("#room-preferences .download");y=a("#download-dialog");z=a("#download-dialog-button");B=a("#download-range");V=a("#preferences .logout");L=a("#preferences .help");w=a("#disconnect-dialog");bK=true;U=a("#room-filter-form");ai=a("#room-filter");n=a("#room-filter-closed");ay=a("#ch-typingIndicator");l=a(".ch-user-status li[data-status]");k=a("#chat-user-status");j=a("#brand");W=a("#LogoutLink");am=a("#SetNotifications");dH=dR.getLanguageResource("TypingText");bj=dR.getLanguageResource("ConnectionToServerEstablished");bk=dR.getLanguageResource("ConnectionToServerLost");bl=dR.getLanguageResource("ConnectionToServerTemporarilyLost");dQ=dR.getLanguageResource("UpdatingConversation");dy={userlist:"newUserListTemplate",user:"newUserTemplate",message:"newMessageTemplate",attachment:"newAttachmentTemplate",dateDivider:"newDateDividerTemplate",multiline:"newMultiLineContentTemplate",thread:"newThreadTemplate",threadHistory:"newThreadHistoryTemplate",threadHistoryMessage:"newThreadHistoryMessageTemplate",topic:"newTopicTemplate",historyTopic:"newHistoryTopicTemplate",loadingRoomIndicatorTemplate:"loadingRoomIndicatorTemplate",newMessagesDivider:"newMessagesDividerTemplate"};ac=dI.getNewMessagesDivider();cs=dI.selectors.messageDeliveryStatus,ae=a("#reloadMessageNotification");J=a(".upload-button");O=a("#hidden-file");I=a("#file-room");H=a("#file-connection-id");t=a("#connection-status");r=t.find(".connection-message");s=a("#connection-state-changed-popover");bi="#popover-content-icon";q=a("#connection-info-popover");p=a("#connection-info-content");bf="#connection-status";bg="#connection-transport";Q=a("#loadingRoomHistory");R=a("#load-more-rooms-item");T=a("#lobby-private");S=a("#lobby-other");aj=a("#room-loading");ap=a("#splash-screen");aA=a("#notification-unread-count");u=a("#create-room");ak=a("#rooms-menu-toggle");o=a("#close-right-menu");i=a("body");al=a("#romm-topics-container");aE=a("#ch-users");P=a("#ch-message-input");v=a("#create-room-modal");aw=a("#ThreadTitleTextBox");ar=a("#StartDiscussionUsersDropdownList");aq=a("#StartDiscussionButton");d=a("#add-people-modal");$addPeopleDropdownList=a("#AddPeopleDropdownList");b=a("#AddPeopleButton");h=a("#add-people-to-group-modal");g=a("#AddPeopleToGroupDropdownList");f=a("#AddPeopleToGroupButton");X=a("#ManageMessageThreadModal");aa=a("#ManageMessageThreadModalTitleTextBox");Y=a("#ManageMessageThreadModalParticipantsDropdownList");Z=a("#ManageMessageThreadModalSaveButton");D=a("#EditMessageModal");E=a("#EditMessageTextBox");C=a("#EditMessageButton");aQ(u,aT);if(dR.isMobile){x.on(bb,function(){dI.hideTextbox()});aF.on(aS,function(){dI.hideTextbox()});P.on(bb,dI.stopPropagation)}var e=function(d6){aG=d6;var d5=bV(d6);if(d5.isHistory()){az.trigger(dI.events.scrollRoomHistoryBottom,[d6,1]);dI.setActiveRoom(d6)}else{if(d5.isLoaded()){if(d5.isInitialized()){dI.setRoomLoading(false,d6)}else{dI.setRoomLoading(true,d6)}dI.setActiveRoom(d6)}else{var d4=bP();d4.makeInactive();d5.makeActive();az.trigger(dI.events.openRoom,[d6])}}i.removeClass(dI.classes.showLeftMenu)};var d1=function(d4){var d5=am;d5.attr(br,d4?cy:bI);d5.find("i").attr(a8,d4?bH:by);Communifire.CF_CHAT_NOTIFICATIONS_SOUND_ENABLED=d4};x.on("click","#tabs li, #tabs-dropdown li, #messages-history li",function(){var d4=a(this).data("name");e(d4)});function d0(d5){var d4=ab[0].value;if(d4.length===0||cj===d4){az.trigger(d5);return true}return false}ab.autoResize({MaxHeight:0.5});ab.keydown(function(d4){var d5=d4.keyCode||d4.which;switch(d5){case ci.Up:if(d0(dI.events.prevMessage)){d4.preventDefault()}break;case ci.Down:if(d0(dI.events.nextMessage)){d4.preventDefault()}break;case ci.Esc:a(this).val("");break;case ci.Enter:case ci.Return:if(!d4.shiftKey){if(aN){dE();d4.preventDefault();return false}}case ci.Space:if(a(this).val()==="/r"&&cm){dI.setMessage("/msg "+cm)}break}});ab.keypress(function(d4){var d5=d4.keyCode||d4.which;if(ab.val()[0]==="/"||d5===ci.Slash){return}switch(d5){case ci.Up:case ci.Down:case ci.Esc:case ci.Enter:break;default:az.trigger(dI.events.typing);break}});at.on(ba,function(d4){dE();d4.preventDefault();return false});if(!db){ab.focus()}l.on(ba,function(d4){d4.preventDefault();var d5=a(this),d6,d7=d5.find("i").attr(a8);k.find("i").attr(a8,d7);d6=d5.attr(bs);aV=d6;az.trigger(dI.events.changeStatus,[d6])});at.click(function(d4){dE();d4.preventDefault();return false});ak.click(function(d4){d4.preventDefault();i.toggleClass(dI.classes.showLeftMenu)});o.click(function(d4){d4.preventDefault();i.removeClass(dI.classes.showRightMenu)});u.on("touchstart",function(d4){d4.stopPropagation();d4.preventDefault();a(this).trigger("click")});u.on(ba,function(d4){d4.preventDefault();v.modal(du)});a(bB).on(ba,dI.selectors.updateRoom,cV);a(bB).on(ba,dI.selectors.addMorePeopleLink,cF);v.on(b4,cN);v.on(dv,cO);d.on(b4,cH);d.on(dv,cI);h.on(b4,cK);h.on(dv,cL);aq.on(ba,cU);b.on(ba,cG);f.on(ba,cJ);var dX={type:"GET",url:Communifire.buildApiUrl(b0),dataType:"json",minTermLength:2,afterTypeDelay:500,jsonTermKey:"searchText",keepTypingMsg:dR.getLanguageResource("KeepTypingText"),lookingForMsg:dR.getLanguageResource("SearchingText")};var dW=function(d4){results=[];a.each(d4.ResponseData,function(d5,d6){results.push({value:d6.UserID,text:d6.UserInfoDisplayName})});return results};var dY={placeholder_text_multiple:dR.getLanguageResource("TypeNamesText")};ar.ajaxChosen(dX,dW,dY);$addPeopleDropdownList.ajaxChosen(dX,dW,dY);g.ajaxChosen(dX,dW,dY);Y.ajaxChosen(dX,dW,dY);if(a(a7).length>0){a(a7).on("touchstart",function(d4){d4.stopPropagation();d4.preventDefault();a(this).trigger("mousedown")})}X.on(b4,cW);Z.on(ba,cS);aa.keydown(function(d5){var d4=d5.which;if(d4==13||d4==45){Z.trigger(ba)}});aF.blur(function(){bK=false;az.trigger(dI.events.blurit)});aF.focus(function(){var d4=bP();d4.makeActive();dI.updateTabOverflow();if(!d4.isHistory()){}dD()});a(bB).on("mousemove keydown click",function(){if(bK===false){dD()}});a(bB).on(ba,".thumbnail",function(d4){d4.preventDefault();var d5=a(this);var d6=d5.attr(b6);a.magnificPopup.open({items:{src:d6,},type:"image"})});D.on(dv,function(){E.focus()});E.keydown(function(d5){var d4=d5.which;if(d4==13||d4==45){if(!d5.shiftKey){C.trigger(ba)}}});C.on(ba,cQ);a(bB).on(ba,dI.selectors.deleteMessageLink,cP);a(bB).on(ba,dI.selectors.editMessageLink,cR);a(bB).on(ba,dI.selectors.quoteLink,cT);a(bB).on(ba,dI.selectors.createNewGroupLink,cM);a(bB).on(ba,dI.selectors.dropDownToggle,function(d7){var ea=a(this),d9=dI.selectors,d4=dI.classes,d8=ea.closest(d9.message),d6=d8.find(d9.dropDownMenu),eb=d8.attr(bt),d5=a("#messages-"+eb).height()-ea.offset().top;if(d5<50){d6.addClass(d4.reverse)}else{d6.removeClass(d4.reverse)}});a(bB).on(ba,dI.selectors.downloadLink,function(d4){d4.preventDefault();var d6=a(this),d5=d6.attr(bn);dV.location.href=d5;return false});function d3(){b8=b8+1;if(b8>5){bK=false}}a(this).mousemove(function(d4){b8=0});a(this).keypress(function(d4){b8=0});if(!aN){at.show()}if(dR.isElectronPresent()){j.on(ba,function(d4){d4.preventDefault()});W.on(ba,function(d4){d4.preventDefault();var d5=a(this).attr(b6);dV.location.href=dR.appendQueryString(d5,"RedirectToLoginPage","1")})}d1(Communifire.CF_CHAT_NOTIFICATIONS_SOUND_ENABLED);am.on(ba,function(d4){d4.preventDefault();var d6=am,d5=d6.find("i").attr(a8)==by;d1(d5);a(this).tooltip(b5);Communifire.CF_CHAT_NOTIFICATIONS_SOUND_ENABLED=d5;az.trigger(dI.events.enableCurentUserNotificationsSound,[d5])}).tooltip({placement:"top",container:"body"});az.bind(dI.events.notificationFocus,function(d4,d5){dV.focus();e(d5)});var dZ={confirmButtonText:dR.getLanguageResource("GlobalYesText"),cancelButtonText:dR.getLanguageResource("GlobalNoText")};a.confirm.defaults=a.extend({},a.confirm.defaults,dZ);bG.init("#new-message",dR)},setUserID:function(e){dI.id=parseInt(e,0)},getUserID:function(){return dI.id},getUserAvatar:function(){return dI.avatar},setUserAvatar:function(e){dI.avatar=e},setUserName:function(e){dI.name=e},getUserName:function(){return dI.name},handleUpdateRoomClick:function(e){var dW=e.ThreadID;aa.val(aW.htmlDecode(e.ThreadTitleOriginal));c2(Y,e.ParticipantsJsonString);X.attr(bt,dW);X.modal(du);aa.focus();dI.hideSplashScreen()},handleAddMorePeopleClick:function(e){var dW=e.ThreadID;c2(g,e.ParticipantsJsonString);h.attr(bt,dW);h.modal(du);bL(g);dI.hideSplashScreen()},handleMarkThreadAsFavorite:function(e,dX){var dW=e.find("i");c3(dW,dX)},setSelfStatus:function(dW){var e=dW.onlineChatStatus;k.find("i").attr(a8,"fa fa-circle "+dW.presenceClass);aV=e},setMessageStatus:function(e,dY){var dW=e.find(".status"),dX;if(dY==2){dX="fa fa-pencil"}else{if(dY==3){dX="fa fa-trash"}}if(dX){dW.html('<i class="'+dX+'"></i>')}},deleteMessage:function(dW,dX){var e=dI[bT](dW);e.find(".content").html(dX.message);dI.setMessageStatus(e,3);e.addClass("deleted")},overwriteMessage:function(dW,dX){if(dX.isDeleted){dI.deleteMessage(dW,dX);return}var e=dI[bT](dW);c5(dX);if(!dX.attachment){e.find(".content").html(dX.message)}e.find(".timestamp").text(dX.when);e.attr("id","m-"+dX.id);e.attr("mid",dX.messageID);if(dX.isEdited){dI.setMessageStatus(e,2)}e.find(cs).find(cd).attr(a8,dk)},replaceMessage:function(e){c5(e);a(ct+e.id).find(".content").html(e.message)},replaceMessageContent:function(dW){c6(dW);var e=a("#"+dW.id);dI.setMessageStatus(e,2);e.find(".content").html(dW.message)},messageExists:function(dW,e){e=e||bB;return a(ct+dW,e).length>0},getMessagesContainer:function(dX){var dW=bV(dX),e=dW.messages;return e},roomExists:function(dW){var e=bV(dW);return e.exists()},incrementRoomHistoryStartPage:function(){de=de+1},setUserTyping:function(d1,dZ){if(d1.id===dI.getUserID()){return}var e=this;if(dZ==bM()){var dX=ay;var dY=d1.name;var dW=d1.id;var d0=dH.replace("{0}",dY);if(dX.find("[data-user-id="+dW+"]").length==0){dX.append("<span data-user-id='"+dW+"'>"+d0+"</span>")}if(e.typingSignalTimeout){clearTimeout(e.typingSignalTimeout)}e.typingSignalTimeout=setTimeout(function(){dX.find("[data-user-id="+dW+"]").remove();dX.html("&nbsp;")},3000)}},markMessageAsUnread:function(dW,dX){var e=dI[bT](dW,dX);e.addClass(dJ)},addChatMessageContent:function(dZ,dY,d0){var dW=dI[bT](dZ),dX=dW.find(".middle"),e=dW.find(".content");if(dt(dY,d0)){dY=bc(dY)}if(dX.length===0){e.append("<p>"+dY+"</p>")}else{dX.append(dY)}},notifyRoom:function(e){if(aZ&&aV!=4&&Communifire.CF_CHAT_NOTIFICATIONS_SOUND_ENABLED){a1.play()}},updateRoomDate:dM,toastRoom:dB,addChatMessage:function(d1,d6,d9){var d5=bV(d6),dW=d5.messages,dX=d5.messages.children().last(),d4=null,d3=new Date().addDays(1),d8=true,dZ=d1.highlight,d0=d1.messageType===1;if(!d5.exists()){az.trigger(dI.events.loadRoom,[d6,d1]);return}if(dX.length>0){d4=dX.data("name");d3=new Date(dX.data("timestamp")||new Date())}if(d1.date.toDate().diffDays(d3.toDate())){d4=null}d8=d4!=d1.userid&&!d0;d1.showUser=d8;if(!d1.messageID){d1.messageDeliveryStatusClass=d1.messageDeliveryStatusClass||"fa fa-clock-o"}c5(d1,d6);if(d8===false){dX.addClass("continue")}if(d5.needsSeparator()){if(d5.hasSeparator()){d5.removeSeparator()}d5.addSeparator()}if(d0===true){var d2={id:d1.id,content:d1.message,img:d1.imageUrl,source:d1.source,encoded:true};dI.addMessage(d2,"postedNotification",d6)}else{if(d8===true){var dY=d5.getUser(d1.name),e=dY.find(".flag");d1.flagClass=e.attr("class");d1.flagTitle=e.attr("title")}if(!d1.attachment){this.appendMessage(a5.process(dy.message,d1),d5)}else{var d7=this;dh(function(){d7.appendMessage(a5.process(dy.attachment,d1),d5)},d6);dI.watchMessageScroll([d1.id],d6)}}if(d9){dI.markMessageAsUnread(d1.id,dW)}if(d1.htmlContent){dI.addChatMessageContent(d1.id,d1.htmlContent,d5.getName())}if(d5.isInitialized()){if(d1.userid!=bm){if(dZ){if(aO("hasSound",true)===true){dI.notify(true)}if(bK===false&&aO("canToast",true)===true){dI.toast(d1,true,d6)}}else{cE(d6,d1)}}}},notifyAndToast:cE,initializeConnectionStatus:function(e){},setMessageDeliveryStatus:function(dX,dW){var e=dI[bT](dX);e.find(cs).find(cd).not(da).attr(a8,dW)},messageDeliveredToAll:function(e,dW){dI.setMessageDeliveryStatus(e,bv)},messageReadByAll:function(e,dW){dI.setMessageDeliveryStatus(e,c9)},messageThreadRead:function(dZ,d0){var dY=bV(dZ);var dW=dY.messages.find("li[data-name="+bm+"]");var e=dW.find(cs).find(cd).not(da);var dX=a.map(e,function(d1,d2){return a(d1).closest("li.message").attr("mid")}).join(",");az.trigger(dI.events.checkMessagesReadStatus,dX)},messageThreadDeliveredToAll:function(dY){var dX=bV(dY);var dW=dX.messages.find("li[data-name="+bm+"]");var e=dW.find(cs).find(cd).not(da);e.attr(a8,bv)},showUpdateUI:function(){aB.modal();dV.setTimeout(function(){bB.location=bB.location.pathname},dO)},setReadOnly:function(e){},isCommand:function(e){return null},showStatus:function(e,dW){if(bh!==e){if(cY){clearTimeout(cY)}bh=e;t.hide();switch(e){case 0:dl(aL,bj,be);cY=setTimeout(function(){t.hide();cY=null},3000);break;case 1:dI[dn]();dl(aJ,bl,be);break;case 2:dI[dn]();dl(bz,bk,bA);break;case 3:dI[dn]();dl(aM,bl,be);break;case 4:dl(aK,dQ,dP)}}},clearRoom:function(dX){var dW=bW(dX);var e=bU(dW);e.html("")},setLastMessagesInCache:function(){var e=a(dx).find(co),dX,dW;a.each(e,function(dY,dZ){dX=a(dZ).attr(bq);if(dX){dW=dI[bS](dX);if(dW){cl[dX]=dW}}})},getLastMessageID:function(dZ){var dY=bV(dZ),dW=dY.messages,e=dY.messages.children().not(bJ).last(),dX=e.attr(cv);return dX},getLastMessageIDFromCache:function(dW){var e=cl[dW];return e},addNewMessagesDivider:function(d0){var dZ=bV(d0),dW=dZ.messages,e=dZ.messages.children().last(),dY=dI.getNewMessagesDivider(),dX=dW.find(cC);if(!dX.length){dY.insertAfter(e)}dZ.setNewMessagesStatus()},removeNewMessagesDivider:function(dZ,dY){var dX=dY||bV(dZ),e,dW;if(dX.hasNewMessages()){e=dX.messages;dW=e.find(cC);if(dW.length){dW.remove()}dX.removeNewMessagesStatus();e.find(dK).removeClass(dJ)}},setRoomLoading:dr,setActiveRoom:cz,hasFocus:function(){return bK},updateUsersWindow:function(dX){var dW=bV(dX),e=dW.tab;if(e.data("threadtype")=="1"){i.removeClass("hide-right-menu")}else{i.addClass("hide-right-menu")}},deleteTypedMessage:function(e){delete dG[e]},updateTypedMessage:aX,setActiveRoomCore:function(dY){var dX=bV(dY),dW=dX.isHistory();if(dX.isActive()&&!dW){P.show();az.trigger(dI.events.activeRoomChanged,[dY]);if(dX.isLoaded()){return true}}var e=bP();if(dX.exists()){if(e.exists()){aX(bM(),ab.val());e.makeInactive();if(e.isHistory()){P.show()}}if(dW){return dq(dY,dX,e)}if(dX.isUnread()){cq(dY)}dX.makeActive();ab.val(b1(dY));ab.trigger("reset");dI.toggleMessageSection(dX.isClosed());az.trigger(dI.events.activeRoomChanged,[dY]);dD();if(dX.isLoaded()){dr(false,dY)}return true}return false},setLoadingHistory:function(e){if(e){var dW=bP();Q.appendTo(dW.messages);Q.show()}else{Q.hide()}},setRoomTrimmable:function(dX,e){var dW=bV(dX);dW.setTrimmable(e)},prependChatMessages:function(dZ,d4){var d3=bV(d4),e=d3.messages,dX=e.children().first(),dW=null,d2=null,d1=new Date().addDays(1);if(dZ.length===0){e.data("full",true);return}if(dX.is(".list-header.date-header")){var d0=new Date(dX.text()).toDate();var dY=dZ[dZ.length-1].date.toDate();if(!dY.diffDays(d0)){dX.remove();dX=e.children().first()}}a.each(dZ,function(){c5(this,d4);if(dW){d2=dW.data("name");d1=new Date(dW.data("timestamp")||new Date())}if(this.date.toDate().diffDays(d1.toDate())){var d6=cw(this.date);dI.addMessageBeforeTarget(d6.format("dddd, MMMM Do YYYY"),"list-header",dX).addClass("date-header").find(".right").remove();d2=null}this.showUser=!d2||d2!==this.name;var d5=a5.process(dy.message,this);dX.before(d5);bD(d5);if(this.showUser===false){dW.addClass("continue")}dW=a(ct+this.id)});if(dX.is(".message")&&dX.data("name")===dW.data("name")){dX.find(dI.selectors.messageUserAvatar).children().not(".state").remove();dX.find(dI.selectors.messageUserName).remove();dW.addClass("continue")}dX[0].scrollIntoView()},appendChatMessages:function(dZ,d2){var d1=bV(d2),e=d1.messages,dX=e.children().last(),dW=null,dY=null,d0=new Date().addDays(1);if(dZ.length===0){e.data("full",true);return}a.each(dZ,function(){if(dW){d0=new Date(dW.data("timestamp")||new Date())}dY=a5.process(dy.threadHistoryMessage,this);e.append(dY);bD(dY);dp(dY,this.when);if(this.showUser===false){dW.addClass("continue")}dW=a(ct+this.id)});if(dX.is(".message")&&dX.data("name")===dW.data("name")){dX.find(dI.selectors.messageUserAvatar).children().not(".state").remove();dX.find(dI.selectors.messageUserName).remove();dW.addClass("continue")}if(dX.length>0){dX[0].scrollIntoView()}},toggleMessageSection:function(e){},toggleDownloadButton:function(e){},run:function(){a.history.init(function(e){var dW=bY(e);if(dW){if(dI.setActiveRoomCore(dW)===false){if(dW!=="history"){az.trigger(dI.events.openRoom,[dW])}}}});a.get(bQ);dm()},removeUser:function(d0,dY){var e=a(".user"+d0.id);var dZ=e.find("i");var dX="avatar-status ";dZ.attr("class",dX+"status-offline");var dW=a(".user-status"+d0.id);dW.text(dR.getLanguageResource("ChatStatusOffline"))},setUserActivity:function(dZ){var e=a(".user"+dZ.id);var dY=e.find("i");var dW=a(".user-status"+dZ.id);var dX=aR;if(dZ.active===true){dY.attr("class",dX+dZ.presenceClass);dW.text(dR.getPresenceText(dZ.presenceClass))}else{if(dZ.id==dV.currentUserID){bK=false}dY.attr("class",dX+"status-offline");dW.text(dR.getLanguageResource("ChatStatusOffline"))}},setRoomListStatuses:function(dW){var e=dW?bV(dW):bP();e.setListState(e.owners)},processContent:function(e){return dR.processContent(e,dy,dd)},setInitialized:function(dW){var e=dW?bV(dW):bP();e.setInitialized()},updateTabOverflow:function(){},updateUnread:function(dX,e,dY){if(dY==bm){return}var dW=dX?bV(dX):bP();if(dI.hasFocus()&&dW.isActive()){return}dW.updateUnread(e);dI.updateTabOverflow()},scrollToBottom:function(dW){var e=dW?bV(dW):bP();if(e.isActive()){e.scrollToBottom()}},getActiveRoomID:bM,watchMessageScroll:function(dX,d0){dX=a.map(dX,function(d2){return ct+d2});var dW=a(dX.join(",")),e=dW.expandableContent(),dZ=bV(d0),dY=dZ.messages.isNearTheEnd(),d1=dZ.messages.scrollTop();if(dY&&e.length>0){e.load(function(d2){if(!dZ.messages.isNearTheEnd()&&d1===dZ.messages.scrollTop()){dZ.scrollToBottom();d1=dZ.messages.scrollTop()}a(this).unbind(d2)})}},isNearTheEnd:function(dW){var e=dW?bV(dW):bP();return e.isNearTheEnd()},addMessageBeforeTarget:function(dX,dY,dW){var e=dI.prepareNotificationMessage(dX,dY);dW.before(e);return e},confirmMessage:function(e){dI[bT](e).removeClass(dI.classes.failedMessage).removeClass("loading")},failMessage:function(dW,dX){var e=dI[bT](dW);e.removeClass("loading");if(e.hasClass(dI.classes.failedMessage)===false&&e.hasClass("failed-command")===false){if(dX){e.addClass("failed-command")}else{e.addClass(dI.classes.failedMessage)}}},markMessagePending:function(dW){var e=dI[bT](dW);if(e.hasClass(dI.classes.failedMessage)===false&&e.hasClass("failed-command")===false){e.addClass("loading")}},resendFailedMessage:function(e){var dW=e.attr("id").slice(2),dY=e.attr(bt),dX=dI.processContent(e.find(dI.selectors.messageContent).text());e.removeClass(dI.classes.failedMessage);az.trigger(dI.events.sendMessage,[dY,dX,dW,false])},resendFailedMessages:function(){var e=a(dI.selectors.failedMessage);a.each(e,function(dW,dX){dI.resendFailedMessage(a(dX))})},changeRoomTopic:function(e){dN(e)},addMessage:function(dW,d0,dZ){var dY=dZ?bV(dZ):bP(),dX=dY.isNearTheEnd(),e=dI.prepareNotificationMessage(dW,d0);this.appendMessage(e,dY);if(d0==="notification"&&dY.isLobby()===false){dI.collapseNotifications(e)}if(dX){dI.scrollToBottom(dZ)}bD(e);return e},updateRoom:function(dX){var dY=dX.name,e=dX.roomDisplayName,dW=bV(dY);if(dW.exists()){dW.clearUserList();a.each(dX.users,function(){var dZ=dR.getUserViewModel(this);dI.addUser(dZ,dY);dI.setUserActivity(dZ)});dI.changeRoomTopic(dX);dW.tab.find(dI.selectors.threadTitle).html(e)}},getMessageItem:function(dW,e){e=e||bB;return a(ct+dW,e)},addUser:function(dY,dX){var dW=bV(dX),e=null;dW.users.find(".removing").remove();e=dW.getUser(dY.id);if(e.length){return false}e=a5.process(dy.user,dY);e.data("inroom",dX);e.data("active",dY.active);dW.addUser(dY,e);bD(e);return true},appendMessage:function(dZ,d0){var dW=a(dZ).is(".message");if(!a(dZ).is(".date-header")&&(dW||d0.hasMessages())){var dY=d0.messages.find("li[data-timestamp]").last(),dX=new Date(dY.data("timestamp")),d1=new Date(a(dZ).data("timestamp"));if(!dY.length||d1.toDate().diffDays(dX.toDate())){var e=cw(d1);dI.addMessage(e.format("dddd, MMMM Do YYYY"),"date-header list-header",d0.getName()).find(".right").remove()}}if(dW){d0.updateMessages(true)}a(dZ).appendTo(d0.messages);bD(a(dZ))},addNotification:function(e,dW){},getNewMessagesDivider:function(){return a(a5.process(dy.newMessagesDivider))},updateRoomTab:function(d2,d1,d0){var d3=dR.getRoomViewModel(d2),e=d0.tab,dX=a5.process(dy.thread,d3).data("name",d1),dY=d0.isActive(),d4=d2.When,dZ=dX.html();var dW=e.html(dZ);d0.setTab(dW);dp(dW,d4);if(dY){d0.makeActive()}bD(dW)},prepareNotificationMessage:function(dX,dY){if(typeof dX==="string"){dX={content:dX,encoded:false}}if(dY=="date-header list-header"||dY=="list-header"){var dW=new Date(),e={type:dY,date:dW,message:dX.encoded?dX.content:dI.processContent(dX.content)};return a5.process(dy.dateDivider,e)}else{}},getState:function(){return c0},showSplashScreen:function(){ap.show()},hideSplashScreen:function(){ap.hide()},hideConnectionStatus:function(){t.hide()}};if(!dV.chat){dV.chat={}}dV.chat.ui=dI})(window.jQuery,window,window.document,window.chat,window.chat.utility,window.Emoji,window.moment,window.chat.templates,window.Communifire);(function(a,e,g,c){var b=a(e),f=e.events,d=function(){var p=function(t){return a("div[data-qqfileid="+t+"]")},i="click",q=60,r=c.sizeLimit,h=c.allowedExtensions.split(","),o=document.getElementById("file-uploader"),k="#progress-bar",m=".filename",n="#progress-percentage",l="#progress-cancel-link",j='<div id="ax-file-progress">            <div id="progress-bar" style="width: 0%;" class="progress-bar"></div>            <div id="progress-text" class="progress-bar"><a id="progress-cancel-link" class="pull-right upload-cancel">'+g.getLanguageResource("GlobalCancelSmallText")+'</a><span id="progress_label">'+g.getLanguageResource("UploadingText")+' <strong class="filename upload-file"></strong> ...</span> <span id="progress-percentage" class="progress-percentage">0%</span> <span class="upload-size"></span><span class="upload-spinner"></span><span class="upload-retry"></span><span class="upload-status-text"></span><span class="upload-success"></span><span class="upload-fail"></span><span id="progress_queue"></span></div>        </div>';qq.CFChatAttachmentUploader=function(u){var v=!(navigator.appName=="Microsoft Internet Explorer");var w='<a class="chat-attachment-button btn" ref="#"><i class="fa fa-paperclip"></i></a><div class="qq-uploader hide"><div class="qq-upload-drop-area"><span>'+g.getLanguageResource("GlobalDragDropFilesText")+"</span></div>";if(v){w+='<div class="axero-files-upload-drag-label" >'+g.getLanguageResource("GlobalDragDropFilesText")+"</div>"}if(!v){w+='<button id="FakeAttachmentUploadButton" class="btn"  >'+g.getLanguageResource("GlobalSelectFilesText")+'</button><div class="qq-upload-button" style="display:none;" ></div><div class="axero-file-upload-window hide"><table class="width100"><tbody class="uploader-media-server-urls"></tbody></table></div></div>';a(function(){a("#FakeAttachmentUploadButton").on(i,function(x){a(".qq-upload-button").find("input[type=file]").click();return false})})}else{w+='<div class="qq-upload-button" >'+g.getLanguageResource("GlobalSelectFilesText")+'</div><div class="axero-file-upload-window hide"><table class="width100"><tbody class="uploader-media-server-urls"></tbody></table></div></div>'}var t={request:{endpoint:c.attachmentUploadUrl},callbacks:{},validation:{allowedExtensions:[],sizeLimit:1000000000,minSizeLimit:0,stopOnFirstInvalidFile:true},dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},showMessage:function(x){a.showMessageBar({message:x})},limit:20,maxConnections:999,sizeLimit:0,template:w,fileTemplate:j,classes:{button:"chat-attachment-button",list:"uploader-media-server-urls",progressBar:"progress-bar",file:"upload-file",spinner:"upload-spinner",size:"upload-size",cancel:"upload-cancel",retry:"upload-retry",statusText:"upload-status-text",success:"upload-success",fail:"upload-fail"},messages:{typeError:g.getLanguageResource("FileUploaderTypeErrorText"),sizeError:g.getLanguageResource("FileUploaderSizeErrorText"),minSizeError:g.getLanguageResource("FileUploaderMinSizeErrorText"),emptyError:g.getLanguageResource("FileUploaderEmptyErrorText"),onLeave:g.getLanguageResource("FileUploaderOnLeaveText"),limitError:g.getLanguageResource("PhotoLimitText")},onProgress:function(y,x,A,B,z){a(z).closest("table").closest("div.axero-file-upload-window").show()},onCompleteAll:function(){},debug:!c.isRelease};if(u.action){t.request.endpoint=u.action}if(u.params){t.request.params=u.params}if(u.sizeLimit){t.validation.sizeLimit=u.sizeLimit}if(u.allowedExtensions){t.validation.allowedExtensions=u.allowedExtensions}if(u.onComplete){t.callbacks.onComplete=u.onComplete}qq.extend(t,u);arguments[0]=t;qq.FineUploader.apply(this,arguments)};qq.extend(qq.CFChatAttachmentUploader.prototype,qq.FineUploader.prototype);qq.extend(qq.CFChatAttachmentUploader.prototype,{_find:function(u,v){if(!u){return}var t=qq(u).getByClass(this._options.classes[v])[0];return t},getItemByFileId:function(t){var u=this._listElement.firstChild;u=a("div[data-qqfileid="+t+"]");if(u.length==0){return[]}return u[0]},_clearList:function(){this.clearStoredFiles()},_uploadFile:function(t){var v=this._handler.add(t);var u=this._handler.getName(v);if(this._options.callbacks.onSubmit(v,u)!==false){this._onSubmit(v,u);var w=this;this._addToListCustom(v,e.getActiveRoomID(),u,t.size).done(function(x){if(w._options.autoUpload){w._handler.upload(v,w._options.request.params)}else{w._storeFileForLater(v)}})}},_onProgress:function(w,v,y,F){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var z;z=Math.round(y/F*100);var B=z+"%";var x,C,E,t,D,A,u;u=p(w);u.find(k).css("width",B);u.find(n).html(B)},_addToList:function(u,t){},_addToListCustom:function(x,A,u,v){var z=this;var t=a.Deferred();var y="0%";var w=a(j);w.attr({"data-qqfileid":x,"data-threadid":A});w.find(k).css("width",y);w.find(n).html(y);w.find(m).html(u);t.resolve();w.appendTo("body");return t},_onSubmit:function(u,t){qq.FineUploader.prototype._onSubmit.apply(this,arguments)},_bindCancelAndRetryEvents:function(){var u=this,t=this._listElement;a(document).on("click",l,function(w){w=w||window.event;var z=w.target||w.srcElement;if(qq(z).hasClass(u._classes.cancel)||qq(z).hasClass(u._classes.retry)){qq.preventDefault(w);var v=a(z).closest("div[data-qqfileid]");var y=v.attr("data-qqfileid");var x=v[0];if(qq(z).hasClass(u._classes.cancel)){u.cancel(y);qq(x).remove()}else{qq(x).removeClass(u._classes.retryable);u.retry(y)}}})},_bindCancelEvent:function(){var u=this,t=this._listElement;qq.attach(t,keys.click,function(v){v=v||window.event;var x=v.target||v.srcElement;if(qq.hasClass(x,u._classes.cancel)){qq.preventDefault(v);var w=x.parentNode.parentNode.parentNode;u._handler.cancel(w.qqFileId);qq.remove(w)}})},_onComplete:function(u,t,y){var v=this.getItemByFileId(u);qq(this._find(v,"statusText")).clearText();qq(v).removeClass(this._classes.retrying);qq(this._find(v,"progressBar")).hide();if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported()){qq(this._find(v,"cancel")).hide()}qq(this._find(v,"spinner")).hide();a(v).hide();var x=y.ResponseData;if(y.IsError==true){}else{var z=a(v).attr("data-threadid");var w="";var A={name:e.getUserName(),avatar:e.getUserAvatar(),attachment:g.getAttachmentViewModel(x),message:w,id:g.newId(),date:new Date(),highlight:"",isMine:true,threadid:z,userid:c.currentUserID};e.addChatMessage(A,z);b.trigger(e.events.sendMessage,[z,w,A.id,false,x])}this._filesInProgress--;if(this._filesInProgress==0){this._options.onCompleteAll()}},_validateFile:function(t){if(!this._isAllowedExtension(t.name)){alert(this._options.messages.typeError.replace("{0}",t.name).replace("{1}",h));return false}return true}});var s=new qq.CFChatAttachmentUploader({element:o,params:{entityTypeID:q},sizeLimit:r,allowedExtensions:h});s.addExtraDropzone(a(".drag-files-container")[0])};b.bind(f.bodyLoaded,function(h){d()})})(window.jQuery,window.chat.ui,window.chat.utility,window.Communifire);!(function(a,i,ar,ah,ap,N,h,O){var e=i.globalHub,o=h.currentUserID,n=h.currentUserDisplayName,m=h.currentUserAvatar,aq=h.whenConnectedToInternet,L=[],x=0,P=document.title,aj=0,F=false,H=false,f=false,ag=false,b=a(ah),ai=ah.events,M=1500,Q={},W=null,ab=0,ac=0,d=false,v=5,w=0,D=false,r=function(){return a.connection.hub.id},ak=[],af=true,q=false,C=h.isSignalRClientConnectionLoggingEnabled||q,B=h.isADEnabled,l=(B)?["longPolling"]:["webSockets","serverSentEvents","longPolling"],j={transport:l},k=a.connection.connectionState,X,Y=10000,c=CF_API_TOKEN;i.hub.logging=C;i.hub.qs={"Rest-Api-Key":c,version:h.cfVersion};function t(at){return{name:at.User.Name,message:at.HtmlEncoded?at.Content:ah.processContent(at.Content),htmlContent:at.HtmlContent,id:at.ID,messageID:at.MessageID,date:N.utc(at.When).toDate(),isMine:at.User.Name===e.state.name,imageUrl:at.ImageUrl,source:at.Source,messageType:at.MessageType,status:s(at.User).toLowerCase(),avatar:at.User.AvatarImageURL,attachment:at.Attachment,userid:at.User.UserID,threadid:at.ThreadID,isDeleted:at.IsDeleted,isEdited:at.IsEdited,messageDeliveryStatusClass:at.MessageDeliveryStatusClass}}function u(az){var ax=az.Name,aB=az.UserID,ay=az.RoomType,av=az.RoomDisplayName,au=az.Presence,aw=az.RoomImageUrl,aC=az.When,at=az.MessageBody,aA=az.UnreadMessageCount;return{id:ax,name:ax,userID:aB,roomType:ay,roomDisplayName:av,presenceClass:au,presenceText:ap.getPresenceText(au),roomImageUrl:aw,when:aC,message:at,unreadMessageCount:aA}}function ao(au,at,av,aw){if(ah.hasFocus()===false){F=(F||at);aj=aj+1}else{F=false;if(aw){e.server.markMessagesAsRead(au)}}ah.updateUnread(au,at,av);an()}function g(){F=false;var at;if(aj>0){at=true}aj=0;ao(ah.getActiveRoomID(),false,null,at)}function p(){for(var at in Q){if(Q.hasOwnProperty(at)){clearTimeout(Q[at]);ah.failMessage(at);delete Q[at]}}}function E(at){return at.id===o}function R(){var at=a.Deferred();return at.promise()}function K(){R().done(function(){})}function am(at){ah.updateRoom(ap.getRoomViewModel(at));ah.hideSplashScreen()}function al(at){e.server.getRoomInfo(at,null).done(function(au){i.hub.log("updateRoom.getRoomInfo.done("+au+")");am(au)}).fail(function(au){i.hub.log("updateRoom.getRoomInfo.failed("+at+", "+au+")");ah.hideSplashScreen()})}function U(ax,au){if(!ax){return}var ay=ax.Name,aw=ax.RecentMessages;ah.updateRoom(ap.getRoomViewModel(ax));if(aw.length>0){var av=[],az=[],at=ah.getMessagesContainer(ay);a.each(aw,function(){var aA=this.ID,aB;if(!ah.messageExists(aA,at)){aB=t(this);av.push(aB.id);az.push(aB)}});if(az.length>0){ah.addNewMessagesDivider(ay)}a.each(az,function(){var aA=this;i.hub.log(aA);ah.addChatMessage(aA,ay,af)});ah.setInitialized(ay);ah.scrollToBottom(ay);ah.setRoomListStatuses(ay);ah.watchMessageScroll(av,ay)}}function T(aw){if(!aw){return}var ax=aw.Name;a.each(aw.Users,function(){var az=ap.getUserViewModel(this);ah.addUser(az,ax);ah.setUserActivity(az)});ah.changeRoomTopic(ap.getRoomViewModel(aw));ah.clearRoom(ax);var av=[],ay,au,at=ah.getMessagesContainer(ax);a.each(aw.RecentMessages,function(){au=this.ID;if(!ah.messageExists(au,at)){ay=t(this);av.push(ay.id);ah.addChatMessage(ay,ax)}});ah.setInitialized(ax);ah.scrollToBottom(ax);ah.setRoomListStatuses(ax);ah.watchMessageScroll(av,ax)}function S(aw,at,av){var au=at||a.Deferred();i.hub.log("getRoomInfo("+aw+")");e.server.getRoomInfo(aw,av).done(function(ax){i.hub.log("getRoomInfo.done("+aw+")");if(av){U(ax,av)}else{T(ax)}au.resolveWith(e)}).fail(function(ax){i.hub.log("getRoomInfo.failed("+aw+", "+ax+")");w++;if(w<v){setTimeout(function(){S(aw,au)},1000)}else{au.rejectWith(e)}});return au.promise()}function V(at){i.hub.log("loadRooms("+at.join(", ")+")");e.server.loadRooms(at).done(function(){i.hub.log("loadRooms.done("+at.join(", ")+")")}).fail(function(au){i.hub.log("loadRooms.failed("+at.join(", ")+", "+au+")")}).always(function(au){ah.hideSplashScreen();e.server.updateActivity()})}function s(at){if(at.Status==="Active"&&at.IsAfk===true){return"Inactive"}return(at.Status||"Offline")}function an(){setTimeout(function(){if(aj===0){document.title=P}else{document.title=(F?"*":"")+"("+aj+") "+P}},200)}function ad(at,av){var au=ah.isNearTheEnd(av);at();if(au){ah.scrollToBottom(av)}}e.client.updateRoom=al;e.client.updateRoomCore=am;e.client.addUser=function(aw,av,au){var ax=ap.getUserViewModel(aw,au);var at=ah.addUser(ax,av);if(at){if(!E(aw)){ah.addNotification(ap.getLanguageResource("Chat_UserEnteredRoom",aw.Name,av),av)}}};e.client.markInactive=function(at){a.each(at,function(){var au=ap.getUserViewModel(this);ah.setUserActivity(au)})};e.client.changeStatus=function(at){at=ap.getUserViewModel(at);ah.setUserActivity(at);if(at.id==o){ah.setSelfStatus(at)}};e.client.updateActivity=function(at){var au=ap.getUserViewModel(at);ah.setUserActivity(au)};e.client.addMessageContent=function(au,at,av){ad(function(){ah.addChatMessageContent(au,at,av)},av);ao(av,false);ah.watchMessageScroll([au],av)};var aa=function(at,au,av){ah.confirmMessage(at);var aw=t(au);ad(function(){ah.overwriteMessage(at,aw)},av)};e.client.replaceMessage=function(at,au,av){aa(at,au,av)};e.client.addMessage=function(at,au){e.server.getMessage(at).done(function(aw){var ax=t(aw);ad(function(){if(ah.messageExists(ax.id)){ah.replaceMessage(ax)}else{ah.addChatMessage(ax,au);ah.updateRoomDate(au)}e.server.markMessageAsDelivered(ax.messageID,o);if(ah.hasFocus()===true){e.server.markMessageAsRead(ax.messageID,o);var ay=ak[au]||0;ak[au]=ay+1;i.hub.log("message read in focused mode")}else{i.hub.log("message just delivered not read in blur mode")}},au);var av=ax.highlight==="highlight";ao(au,av,aw.User.UserID)})};e.client.leave=function(au,at){au=ap.getUserViewModel(au);if(E(au)){ah.setRoomLoading(false,at);if(e.state.activeRoom===at){}}else{ah.removeUser(au,at);ah.addNotification(ap.getLanguageResource("Chat_UserLeftRoom",au.Name,at),at)}};e.client.reconnected=function(){i.hub.log("Client reconnected");e.server.joinHub(af).fail(function(at){i.hub.log("Error while joining hub after reconnect: "+at.message);R()})};e.client.logOnWithReconnect=function(ax){i.hub.log("logOnWithReconnect fired");ah.showStatus(4);var au;if(ax.length>0){au=ax[0].Name}a.each(ax,function(ay,az){ah.addRoom(az)});var aw=function(){var ay=[],az,aA,aB;a.each(ax,function(aC,aD){aB=aD.Name;if(e.state.activeRoom!==aB){az=ah.isRoomLoaded(aB);if(az){ay.push(aB)}}});ac=ay.length;a.each(ay,function(aC,aD){aA=ah.getLastMessageIDFromCache(aD);S(aD,null,aA).done(function(){ac--;if(ac===0){ah.hideConnectionStatus()}}).fail(function(aE){ac--;if(ac===0){ah.hideConnectionStatus()}console.error("Error while populating room: ",aE.message)})})};var at=this.state.activeRoom||au,av;if(at){this.state.activeRoom=at;ah.setActiveRoom(at);av=ah.getLastMessageIDFromCache(at);S(at,null,av).done(function(){aw();if(ac===0){ah.hideConnectionStatus()}}).fail(function(ay){ah.hideConnectionStatus();console.error("Error while populating room: ",ay.message);ac=ac-1})}else{ah.hideConnectionStatus()}};var J=function(aw,av,ax){e.currentUserID=e.state.id;W=av;var at;if(aw.length>0){at=aw[0].Name}var au=function(){var ay=[];a.each(aw,function(az,aA){if(e.state.activeRoom!==aA.Name){ay.push(aA.Name)}});ab=ay.length;V(ay)};a.each(aw,function(ay,az){ah.addRoom(az)});ah.setUserID(o);ah.setUserName(n);ah.setUserAvatar(m);ah.run();e.state.activeRoom=h.activeRoom;ah.setActiveRoom(h.activeRoom);ah.hideSplashScreen();ah.addHistory()};e.client.roomLoaded=function(at){T(at);if(ab===1){ah.hideSplashScreen()}else{if(ab===0){ah.hideSplashScreen()}else{ab=ab-1}}};e.client.setTyping=function(au,at){var av=ap.getUserViewModel(au);ah.setUserTyping(av,at)};function I(av,au){try{e.server.getRoomInfo(av,null).done(function(ax){var aw=ah.addRoom(ax,true);if(aw){S(ax.Name).done(function(){if(au){ah.notifyAndToast(av,au)}})}}).fail(function(aw){i.hub.log("loadRoom.failed("+av+", "+aw+")")})}catch(at){i.hub.log("loadRoom.failed("+av+", "+at+")")}}function G(au){if(au){var av=au.Name;ah.setRoomLoading(true,av);var at=ah.addRoom(au,true);ah.setActiveRoom(av);if(!ah.isRoomLoaded(av)){S(av).done(function(){ah.setRoomLoading(false,av);ah.hideSplashScreen()})}else{ah.setRoomLoading(false,av);ah.hideSplashScreen()}if(au.UnreadMessageCount>0){e.server.markMessagesAsRead(av)}}else{ah.setRoomLoading(false,av);ah.hideSplashScreen()}}e.client.joinRoom=G;e.client.forceUpdate=function(){ah.showUpdateUI()};e.client.messageDeliveredToAll=function(at,au){ah.messageDeliveredToAll(at,au)};e.client.messageReadByAll=function(at,au){ah.messageReadByAll(at,au)};e.client.messageThreadDelivered=function(at,au){ah.messageThreadDelivered(at,au)};e.client.messageThreadRead=function(at,au){ah.messageThreadRead(at,au)};e.client.testMessageToClient=function(at){i.hub.log("TestMessageToClient: "+at)};e.client.testMessageToRoom=function(at){i.hub.log("TestMessageToRoom: "+at)};e.client.outOfSync=function(){ah.showStatus(1,"");ar.location.reload()};e.client.exceptionHandler=function(at){i.hub.log("SignalR Exception:"+at)};b.bind(ai.changeStatus,function(at,au){e.server.changeStatus(au)});b.bind(ai.checkMessagesReadStatus,function(at,au){e.server.checkMessagesReadStatus(au)});b.bind(ai.typing,function(){if(!e.state.activeRoom){return}if(f===false&&ag===false){ag=true;try{ah.setRoomTrimmable(e.state.activeRoom,ag);e.server.typing(e.state.activeRoom)}catch(at){i.hub.log("Failed to send via websockets")}ar.setTimeout(function(){ag=false},3000)}});b.bind(ai.deleteMessage,function(at,av,au){e.server.deleteMessage(av,au)});b.bind(ai.editMessage,function(at,aw,av,au){e.server.editMessage(aw,av,au)});b.bind(ai.sendMessage,function(aw,aD,aA,aB,ay,at){g();var ax=aB||ap.newId(),aC=aD,au={id:ax,content:aA,roomID:aD,attachment:at},az=null;if(!ay){az=ar.setTimeout(function(){if(a.connection.hub.state===a.connection.connectionState.reconnecting){ah.failMessage(ax)}else{ah.markMessagePending(ax)}},M);Q[ax]=az;ah.updateTypedMessage(aC,null)}try{e.server.send(au).done(function(){if(az){clearTimeout(az);delete Q[ax]}ah.confirmMessage(ax)}).fail(function(aE){ay=aA.match(/^\/[A-Za-z0-9?]+?/)!==null;ah.failMessage(ax,ay);if(aE.source==="HubException"){ah.addErrorToActiveRoom(aE.message)}})}catch(av){i.hub.log("Failed to send via websockets");clearTimeout(Q[ax]);ah.failMessage(ax)}L.push(aA);x=L.length});b.bind(ai.focusit,function(){g();try{i.hub.log("Calling chat.server.updateActivity()");e.server.updateActivity()}catch(at){i.hub.log("updateActivity failed")}});b.bind(ai.enableCurentUserNotificationsSound,function(au,at){e.server.enableCurentUserNotificationsSound(at)});b.bind(ai.markMessagesAsRead,function(at,au){e.server.markMessagesAsRead(au)});b.bind(ai.updateRoomClick,function(at,au){e.server.getChatRoom(au).done(function(av){ah.handleUpdateRoomClick(av)}).fail(function(av){ah.hideSplashScreen()})});b.bind(ai.markThreadAsFavorite,function(au,aw,av,at){e.server.markThreadAsFavorite(aw,av).done(function(){ah.handleMarkThreadAsFavorite(at,av)}).fail(function(ax){})});b.bind(ai.addMorePeopleClick,function(at,au){e.server.getChatRoom(au).done(function(av){ah.handleAddMorePeopleClick(av)}).fail(function(av){ah.hideSplashScreen()})});b.bind(ai.loadRoom,function(at,av,au){I(av,au)});b.bind(ai.addRoom,function(au,av){ah.showSplashScreen();try{e.server.addRoom(av).done(G).fail(function(aw){i.hub.log("addRoom.failed("+aw+")");ah.hideSplashScreen()})}catch(at){i.hub.log("addRoom.failed("+at+")")}});b.bind(ai.updateParticipants,function(au,aw,av){ah.showSplashScreen();try{e.server.updateParticipants(aw,av).done(am).fail(function(ax){i.hub.log("updateParticipants.failed("+ax+")");ah.hideSplashScreen()})}catch(at){i.hub.log("updateParticipants.failed("+at+")")}});b.bind(ai.updateRoom,function(au,aw,ax,av){ah.showSplashScreen();try{e.server.updateRoom(aw,ax,av).done(am).fail(function(ay){i.hub.log("updateRoom.failed("+ay+")");ah.hideSplashScreen()})}catch(at){i.hub.log("updateRoom.failed("+at+")")}});b.bind(ai.openRoom,function(au,av){try{e.server.getRoomInfo(av,null).done(G).fail(function(aw){i.hub.log("getRoom.failed("+av+", "+aw+")");ah.setRoomLoading(false,av)})}catch(at){i.hub.log("getRoom.failed("+av+", "+at+")")}});b.bind(ai.activeRoomChanged,function(at,au){if(au==="Lobby"){e.state.activeRoom=undefined}else{e.state.activeRoom=au}ah.updateUsersWindow(au);ah.scrollToBottom(au)});b.bind(ai.blurit,function(){an()});b.bind(ai.scrollRoomTop,function(au,av){if(H===true){return}H=true;try{ah.setLoadingHistory(true);ah.setRoomTrimmable(av.name,false);i.hub.log("getPreviousMessages("+av.name+")");e.server.getPreviousMessages(av.messageID).done(function(aw){i.hub.log("getPreviousMessages.done("+av.name+")");ah.prependChatMessages(a.map(aw,t),av.name);ar.setTimeout(function(){H=false},1000);ah.setLoadingHistory(false)}).fail(function(aw){i.hub.log("getPreviousMessages.failed("+av.name+", "+aw+")");ar.setTimeout(function(){H=false},1000);ah.setLoadingHistory(false)})}catch(at){i.hub.log("getPreviousMessages failed");ah.setLoadingHistory(false)}});b.bind(ai.scrollRoomHistoryBottom,function(au,av,aw){if(H===true){return}H=true;if(aw==1){ah.showSplashScreen();a(ah.selectors.historyContainer).empty()}try{ah.setLoadingHistory(true);ah.setRoomTrimmable(av,false);i.hub.log("getRoomsHistory("+av+")");e.server.getRoomsHistory(aw).done(function(ax){i.hub.log("getRoomsHistory.done("+av+")");ah.incrementRoomHistoryStartPage();ah.appendChatMessages(a.map(ax,u),av);ar.setTimeout(function(){H=false},1000);ah.setLoadingHistory(false);ah.hideSplashScreen()}).fail(function(ax){i.hub.log("getRoomsHistory.failed("+av+", "+ax+")");ar.setTimeout(function(){H=false},1000);ah.setLoadingHistory(false);ah.hideSplashScreen()})}catch(at){i.hub.log("getRoomsHistory failed");ah.setLoadingHistory(false)}});var ae={},z=true,A=false;X=function(at){aq().then(function(){if(e.connection.state===k.disconnected||at){ah.showStatus(1,"");i.hub.start(j).done(function(){ah.hideConnectionStatus();i.hub.log("Connection re-established after get disconnected. Connection connected with id: "+r());e.server.joinHub(A).fail(function(au){i.hub.log("Error while joining hub: "+au.message);R()});A=true}).fail(function(au){i.hub.log("SignalR connection failed: "+au)})}else{if(e.connection.state===k.connected){ah.hideConnectionStatus()}}})};function Z(){if(i.hub.state!==k.connected){X()}}function y(){i.hub.logging=C;i.hub.qs={"Rest-Api-Key":c,version:Communifire.cfVersion};i.hub.start(j).done(function(){i.hub.log("Connection started with id: "+r());e.server.joinHub().fail(function(at){i.hub.log("joinHub.failed("+at+")");R()});A=true}).fail(function(at){i.hub.log("SignalR connection failed: "+at)});i.hub.stateChanged(function(at){switch(at.newState){case k.reconnecting:p();if(!D){ah.showStatus(1,"")}break;case k.connected:if(!z){ah.setReadOnly(false);ah.resendFailedMessages();i.hub.log("Connection state changed. Connection connected with id: "+r())}else{ah.initializeConnectionStatus(a.connection.hub.transport.name)}z=false;break;case k.disconnected:z=false;i.hub.log("Connection state changed. Connection disconnected with id: "+r());break}});i.hub.disconnected(function(){i.hub.log("Connection state changed. Connection disconnected");if(A===true){i.hub.log("Dropped the connection from the server. Restarting in 5 seconds.");p()}if(!D){ah.showStatus(2,"")}ah.setReadOnly(true)});i.hub.error(function(at){console.error("Error in connection hub: ",at.message);p()});b.bind(ai.focusit,function(){if(i.hub.state===k.disconnected){X()}})}ah.initialize(ae.preferences).done(function(){if(h.rooms){J(h.rooms);T(h.activeRoomInforCore);e.state.activeRoom=h.activeRoom;ah.hideSplashScreen()}y()});ar.addEventListener("offline",function(at){ah.showStatus(1,"")});ar.addEventListener("online",function(at){X(af)});setInterval(Z,Y);ar.onbeforeunload=function(at){D=true;e.connection.stop()};ar.getActiveConnectionID=r})(window.jQuery,window.jQuery.connection,window,window.chat.ui,window.chat.utility,window.moment,window.Communifire,window.Offline);